<apex:page standardController="Service_Assignment__c" extensions="ServiceAssignmentExt" standardStylesheets="true" sidebar="false" tabStyle="ESD_Home__tab" showheader="true">
    <apex:stylesheet value="{!$Resource.pbscardcss}" />
    <apex:includeScript value="{!URLFOR($Resource.jquery, '/js/jquery-1.7.2.min.js')}" />
    <apex:includeScript value="{!URLFOR($Resource.jquery, 'js/jquery-ui-1.8.21.custom.min.js')}" />
    <apex:stylesheet value="{!URLFOR($Resource.jquery, 'css/custom-theme/jquery-ui-1.8.21.custom.css')}" />
    <apex:includeScript value="{!URLFOR($Resource.ServiceAssignmentFS)}" />
    <apex:includeScript value="{!URLFOR($Resource.CommonJS)}" />
    <apex:stylesheet value="{!URLFOR($Resource.datetimepicker,  'datetimepicker/jquery.datetimepicker.css')}" />
    <apex:includeScript value="{!URLFOR($Resource.datetimepicker, 'datetimepicker/jquery.datetimepicker.js')}" />
    <apex:includeScript value="{!URLFOR($Resource.momentJs)}" />

    <apex:variable value="{!$ObjectType.Action_Plan_Worksheet__c.accessible}" var="vfVarCanAccessWS" />
    <apex:variable value="{!$User.Operating_Group__c == 'Cambridge'}" var="vfVarIsCB" />
    <apex:variable value="{!$User.Operating_Group__c == 'Redwood'}" var="vfVarIsRW" />
    <apex:variable value="{!$User.Operating_Group__c == 'Redwood' && (Service_Assignment__c.Admission__r.State__c =='MN' || Service_Assignment__c.Admission__r.State__c =='IA' || Service_Assignment__c.Admission__r.State__c =='OH')}" var="vfVarIsRwExtraItems" />
    <apex:variable value="{!$User.Operating_Group__c == 'Redwood' && Service_Assignment__c.Admission__r.State__c =='CA'}" var="vfVarIsRwCA" />
    <apex:variable value="{!$User.Operating_Group__c == 'CareMeridian' || $User.Operating_Group__c == 'Care Meridian'}" var="vfVarIsCM" />
    <apex:variable value="{!$User.Operating_Group__c == 'NeuroRestorative' || $User.Operating_Group__c == 'Neuro Restorative'}" var="isNR" />
    <apex:variable value="{!theServAssign.Flavor__c == 'Adult Day Health'}" var="isADH" />
    <apex:variable value="{!theServAssign.Flavor__c == 'CA FSS'}" var="isCAFSS" />
    <apex:variable value="{!theServAssign.Flavor__c == 'Ludlow'}" var="isLudlow" />

    <style type="text/css">
        .custPopup{
            background-color: white;
            border-width: 2px;
            border-style: solid;
            z-index: 9999;
            left: 38%;
            padding:10px;
            position: absolute;
            width: 800px;
            margin-left: -250px;
            top:100px;
            position:fixed !important;
        }
        .popupBackground{
            background: #eeeeee url(images/ui-bg_diagonals-thick_90_eeeeee_40x40.png) 50% 50% repeat;
            opacity: .80;
            position: absolute;
              top: 0;
              left: 0;

            filter: alpha(opacity = 20);
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: 9998;
        }
        .dateFormat{display: none;}
        .thinking{
            opacity:0.8;
            background-color:#ccc;
            position:fixed;
            width:100%;
            height:100%;
            top:0px;
            left:0px;
            z-index:1000;
        }
        .thinkingwheel{
            position:absolute; left:50%; top:50%; background-color: white; border: 2px solid gray; padding: 2px;
        }
        .timePastNoon{
            background: lightblue;
        }
    </style>


    <style>
        .dialogLoadingSpinner {
            margin-left: 5px;
        }
        #fundingMessages {
            margin-bottom: 10px;
        }
        #fundingMessages,
        #evaluationMessages .error {
            color: red;
        }
        #fundingMessages .success {
            color: green;
        }
        .warning{
            border: 1px solid;
            margin: 10px 0px;
            padding:15px 10px 15px 50px;
            background-repeat: no-repeat;
            background-position: 10px center;
            color: #9F6000;
            background-color: #FEEFB3;
        }
        .modalDialog {
            max-height: 500px;
            overflow: auto;
        }
        .modalDialog .modalSubheader {
            font-weight: bold;
        }
        .modalDialog .pbHeader {
            font-size: 0.9em;
        }
        .pbButton {
            float: right;
        }
        .editcol {
            width: 50px;
        }
        a .datecol {
            width: 250px;
        }
        .serviceLocation:hover {
            /*BG color is a must for IE6*/
            background: #ffffff;
            text-decoration: none;
        }
        .serviceLocation div > div {
            display: none;
            padding: 2px 3px;
            margin-left: 8px;
            min-width: 350px;
        }
        .serviceLocation:hover div > div {
            display: inline;
            position: absolute;
            background: #FFC;
            border: 1px solid #cccccc;
            color: #000000;
            cursor: text;
        }
        #seizureMessages .success {
            color: green;
        }
        #seizureMessages .error {
            color: red;
        }
        .grandtotalwarning{
            background-color: rgb(224, 102, 102);
        }
    </style>

    <c:PersonalRecord pbsId="{!admission.Person_Being_Served__c}" servAssignId="{!theServAssign.Id}" parentPage="ServAssign" servAssignNew="{!newSA}" admId="{!admissionId}" />
    <script>
        j$ = jQuery.noConflict();

        function SetHiddenPhase(thePhase) {
            j$('input[id$=phaseToSave]').val(thePhase);
        }

        openModalDialogSA = function (dialogId, tagType, titleString, dClass, width) {
            if (!width) {
                width = 800;
            }
            if (!dClass) {
                dClass = 'fixed-dialog';
            }
            selector = tagType + '[id$=' + dialogId + ']';
            if (j$(selector).dialog("isOpen") !== true) {
                j$(selector).dialog({
                    dialogClass: dClass,
                    title: titleString,
                    modal: true,
                    width: width,
                    resizable: false,
                    minHeight: 0,
                    dialogClass: 'modalDialog',
                    zIndex: 200, // so that datepickers appear on top of the dialogs
                    closeOnEscape: false,
                    position: {
                        my: "center top",
                        at: "center top"
                    },
                    open: function () {
                        // Don't allow "background" to be scrollable when dialogs
                        // are open.
                        j$("body").css("overflow", "hidden");
                    }
                }).parent().appendTo(j$('form[id$=myFRM]'));
                j$(selector).parent().find('a.ui-dialog-titlebar-close').remove();
            }
        };
        closeModalDialogSA = function (dialogId, tagType) {
            selector = tagType + '[id$=' + dialogId + ']';
            j$(selector).dialog('destroy');
            // Allow "background" to be scrollable when dialogs are closed.
            j$("body").css("overflow", "auto");
        };

        fundingSourceSave = function (isClose) {
            // We cant use Visualforce functions/variables in a Static Resource JS file, so we have to pass it in here.
            closeFundingSource = isClose;
            fundingSourceSaveHelper('{!JSENCODE(fundingSourceRecordType)}');
        }

        fundingSourceFinalize = function(){
             var tUnits = totalauthTherapyUnits(j$('[id$=receivedRate]').val(),'{!serviceLocation.Room_and_Board_Rate__c}','{!serviceLocation.PRN_DS_Per_Hour__c}',
                    j$('[id$=hoursExpected]').val(),j$('[id$=dmeperDay]').val(),j$('[id$=otherPerDay').val(),j$('[id$=medicationperDay]').val(),
                    j$('[id$=nutritionalPerDay]').val(),'{!serviceLocation.Per_Productive_Unit__c}');

            fundingSourceFinalizeHelper('{!JSENCODE(fundingSourceRecordType)}', tUnits, 'totalAuthUnits');
        }

        fundingCaltotalUnitsButton = function(){
            var authUnitErrors = validateAuthCalculations();
             if (authUnitErrors.length > 0) {
                j$('#fundingMessages').html('');
                j$.each(authUnitErrors, function (index, error) {
                    j$('#fundingMessages').append('<li class="error">' + error + '</li>');
                });
                fundingSourceScrollToTop();
            }else{
                j$('#fundingMessages').html('');
                var tUnits = totalauthTherapyUnits(j$('[id$=receivedRate]').val(),'{!serviceLocation.Room_and_Board_Rate__c}','{!serviceLocation.PRN_DS_Per_Hour__c}',
                    j$('[id$=hoursExpected]').val(),j$('[id$=dmeperDay]').val(),j$('[id$=otherPerDay').val(),j$('[id$=medicationperDay]').val(),
                    j$('[id$=nutritionalPerDay]').val(),'{!serviceLocation.Per_Productive_Unit__c}');

                j$('[id$=totalAuthUnits]').val(tUnits);

                    if(tUnits < parseFloat(j$('[id$=authGrandTotalUnits]').val())){
                        j$('[id$=authGrandTotalUnits]').addClass("grandtotalwarning");
                    }else{
                        j$('[id$=authGrandTotalUnits]').removeClass("grandtotalwarning");
                    }

            }
        }


        inactivateFunding = function(){
            if(window.confirm('You will not be able to edit the funding source once you inactivate it. Do you want to proceed?')){
                fundingSourceInactivate();
            }else{
                return null;
            }

        }

        function loadFundingSource(fundingId) {
            // This provides backward-compatibility with code the Appirio wrote
            showEditFundingSource(fundingId);
        }

        function fundingSourceAllowedEdit() {
            fundingSourceClearMessages();
            j$('[id*=FundingSourceModal] input[id*=saveFundingSource]').show();
            j$('[id*=FundingSourceModal] input[id*=saveAndNewFundingSource]').show();
            var fsTerminationDate = j$('[id*=FundingSourceModal] input[id*=fsTerminationDate]');
            if ((new Date(fsTerminationDate.val()).getTime() < new Date(getToday()).getTime())) {
                j$('#fundingMessages').append('<li class="success">Edits are not allowed past the funding source termination date.</li>');
                j$('[id*=FundingSourceModal] input[id*=saveFundingSource]').hide();
                j$('[id*=FundingSourceModal] input[id*=saveAndNewFundingSource]').hide();
            }
        }


        function getToday() {
            var today = new Date();
            var dd = today.getDate();
            var mm = today.getMonth() + 1; //January is 0!
            var yyyy = today.getFullYear();
            if (dd < 10) {
                dd = '0' + dd
            }
            if (mm < 10) {
                mm = '0' + mm
            }
            today = mm + '/' + dd + '/' + yyyy;
            return today;
        }

        seizureSave = function (isClose) {
            closeSeizure = isClose;
            seizureClearMessages();
            validateSeizure();
        }

        function loadSeizure(seizureId) {
            showEditSeizure(seizureId);
        }
        function setStatusDefaults(){
        if(j$('[id$=highEduAtEnd]').val() == '')
            j$('[id$=highEduAtEnd]').val( j$('[id$=highEduAtStart]').val() );

        }
        validateSeizure = function () {
            var seizureErrors = [];
            var startValue = j$('[id$=seizureEntry_startDateTime]').val();
            var formatStart = new Date(moment(new Date(startValue)).format());
            var endValue = j$('[id$=seizureEntry_endDateTime]').val();
            var formatEnd = new Date(moment(new Date(endValue)).format());
            var formatNow = new Date(moment(new Date(Date.now())).format());
            console.log(formatNow);

            j$('#seizureMessages').html('');
            if (startValue == '' && endValue == '') {
                seizureErrors.push('The Date must contain a valid value. Please enter the date of the Seizure event.');
            }
            else if (startValue == '') {
                seizureErrors.push('The Start Time must contain a valid value. Please enter a Start Time of the Seizure event.');
            }
            else if (endValue == '') {
                seizureErrors.push('The End Time must contain a valid value. Please enter an End Time of the Seizure event.');
            }
            else if (formatStart >= formatEnd) {
                seizureErrors.push('The End Time must come AFTER your Start Time. Please adjust the Start and End times.');
            }
            if (startValue.substring(0,10) > getToday()) {
                seizureErrors.push('The Start Time cannot be in the future. Please adjust the Start Time of the Seizure event.');
            }
            if (endValue.substring(0,10) > getToday()) {
                seizureErrors.push('The End Time cannot be in the future. Please adjust the End Time of the Seizure event.');
            }
            if (formatStart  > formatNow ) {
                seizureErrors.push('The Start Time cannot be in the future. Please adjust the Start Time of the Seizure event.');
            }
            if (formatEnd  > formatNow ) {
                seizureErrors.push('The End Time cannot be in the future. Please adjust the End Time of the Seizure event.');
            }
            if (j$('[id$=seizureEntry_observedBy]').val() == '') {
                seizureErrors.push('The Observed By field must contain a value. Please enter the name of the individual who observed the event of the Seizure event.');
            }
            if (j$('[id$=seizureEntry_medAdmPreSeizure]').val() == '') {
                seizureErrors.push('Medication Administered pre-seizure is a required field.');
            }
            if (j$('[id$=seizureEntry_medAdmPostSeizure]').val() == '') {
                seizureErrors.push('Medication Administered post-seizure is a required field.');
            }
            if ((j$('[id$=seizureEntry_medAdmPreSeizure]').val() == 'Yes' || j$('[id$=seizureEntry_medAdmPostSeizure]').val() == 'Yes') && j$('[id$=seizureEntry_medDetail]').val() == '') { 
                seizureErrors.push('Medication Detail is a required field.');
            }

            if (seizureErrors.length > 0) {
                seizureScrollToTop();
                j$.each(seizureErrors, function (index, error) {
                    j$('#seizureMessages').append('<li class="error">' + error + '</li>');
                });
            } else {
                Visualforce.remoting.Manager.invokeAction(
                    '{!$RemoteAction.ServiceAssignmentExt.findDuplicateSeizure}',
                    startValue,
                    endValue,
                    '{!Service_Assignment__c.Id}',
                    j$('[id$=seizureEntry_Id]').val(),
                    function(result, event){
                        if (event.status) {
                                if(result && ! j$('[id$=seizureEntry_duplicateEntry]').is(":checked") ){
                                    j$('[id$=seizure-dialog-confirm]').dialog( "open" );
                                } else {
                                    saveSeizure();
                                }
                        } else if (event.type === 'exception') {
                            document.getElementById("seizureMessages").innerHTML = event.message;
                        } else {
                            document.getElementById("seizureMessages").innerHTML = event.message;
                        }
                    },
                    {escape: true}
                );
            }
        }


        seizureScrollToTop = function (isSuccess) {
            if (isSuccess && jQuery('.errorMsg').length == 0 ) {
                j$('#seizureMessages').append('<li class="success">Save successful!</li>');
            }
            j$('[id$=seizureTrackingModal].ui-dialog-content').parent().animate({
                scrollTop: 0
            }, 200);
        }
        seizureClearMessages = function () {
            j$('#seizureMessages').html('');
        }


        j$(function() {
            j$('[id$=seizure-dialog-confirm]').dialog({
                resizable:false,
                height:180,
                modal:true,
                autoOpen:false,
                buttons: { Yes: function() { j$(this).dialog( "close" ); saveSeizure(); },
                            No : function() { j$(this).dialog( "close" ); }
                         }
            });
        });

        jQuery(document).ready(function ($) {
                setUpFields = function () {
                    $('body input').on("change", function (event) {
                        applyRulesToField(event.target);
                        applyShowHideRulesToField(event.target);
                    });
                    $('body select').on("change", function (event) {
                        applyRulesToField(event.target);
                        applyShowHideRulesToField(event.target);
                    });
                    $('body input').each(function (_, target) {
                        applyRulesToField(target);
                        applyShowHideRulesToField(target);
                    });
                    $('body select').each(function (_, target) {
                        applyRulesToField(target);
                        applyShowHideRulesToField(target);
                    });
                }
                setUpFields();

            });   //end "
            
		<!-- PRD9 Percent Complete: Configure Storage of Values in iServe -->

		var fetchCompScore = function(){
		var cScore = jQuery('span#compScore');
		var cScoreTxt = cScore.text();
		var posOne = cScoreTxt.indexOf('/') + 1;
		var posTwo = cScoreTxt.indexOf('/');
		var posThree = cScoreTxt.indexOf('(');
		var compFields = cScoreTxt.substring(0,posTwo);
		var totFields = cScoreTxt.substring(posOne,posThree);
		var fpm = new SObjectModel.pm();
		console.log('Values to obtain completion score:\n'+
		            '\n'+
		            'cScore=='+cScore.valueOf()+'\n'+
		            'cScoreTxt=='+cScoreTxt+'\n'+
		            'posOne=='+posOne+'\n'+
		            'posTwo=='+posTwo+'\n'+
		            'posThree=='+posThree+'\n'+
		            'compFields=='+Number(compFields)+'\n'+
		            'totFields=='+Number(totFields)+'\n'+
					'Completed items value from class=='+{!itemsCompleted});
		if (compFields=={!itemsCompleted}){
			console.log('Nothing to do, completed values match!')
		}
		else{            
			fpm.retrieve({where: {WhatId__c: {eq:'{!Service_Assignment__c.Id}'}},limit: 1}, function(err, records, event){
				if(err){
					console.log('An Error Has Occured! >>> ERROR MSG:['+err.message+']');
					alert('An Error Has Occured! >>> ERROR MSG:['+err.message+']');
				}
				else{
					console.log('fpm [retrieve] log: '+fpm.log());
					console.log('records return:\n'+
					            '\n'+
					            'records length: '+records.length+'\n'+
					            'records value: '+records.valueOf());
					if(records.length > 0){
						records.forEach(function(record){
							console.log('record value: '+record.valueOf());
							var wid = record.get("WhatId__c");
							var rid = record.get("Id");
							console.log('Record id values for update:\n'+
							            '\n'+
							            'wid[whatId]=='+wid+'\n'+
							            'rid==[recordId]'+rid);
							var ufpm = new SObjectModel.pm();
							ufpm.update([rid],
							            {Items_Complete__c: Number(compFields),
							            Total_Items__c: Number(totFields),
							            Progress_Text__c: cScoreTxt},
							            function(err){
								if(err){
									console.log('An Error Has Occured! >>> ERROR MSG:['+err.message+']');
									alert('An Error Has Occured! >>> ERROR MSG:['+err.message+']');
								}							
								});
							console.log('ufpm [update] log: '+ufpm.log());
						});
					}
					else{
						var cfpm = new SObjectModel.pm();
						cfpm.create({WhatId__c: '{!Service_Assignment__c.Id}',
						            WhatID_Object__c: 'Service_Assignment__c',
						            Items_Complete__c: Number(compFields),
						            Total_Items__c: Number(totFields),
						            Progress_Text__c: cScoreTxt},
						            function(err){
							if(err){
								console.log('An Error Has Occured! >>> ERROR MSG:['+err.message+']');
								alert('An Error Has Occured! >>> ERROR MSG:['+err.message+']');
							}
						});
						console.log('cfpm [create] log: '+cfpm.log());
					}
				}
			});
		}		
		};       
	    
	    window.onload = function(){
	        fetchCompScore();
	    };
		<!-- End PRD9 -->

    </script>
    <apex:pagemessages id="msgs" />

     <br />
    <c:NursesShiftDocAddModal uniqueId="1" parentId="{!theServAssign.Id}" onShowRerender="msgs, evaluations2" status="{!$Component.myFRM.residentAssessmentShiftDocBlock2.addShiftDocStatus}" />
    <c:NursesShiftDocAddModal uniqueId="2" parentId="{!theServAssign.Id}" shiftType="CNA Workbook" onShowRerender="msgs, evaluationscna" status="{!$Component.myFRM.CNABlock.AddCNAStatus}" />
    <apex:form id="myFRM">
        <c:FormCompletionControl viewMode="true"/>
        <apex:actionFunction name="finalizeFundingSource" action="{!finalizeFundingSource}" status="fundingSouceModalStatus" rerender="fundingSources,fundingSourcePayerDetailEntry,fundingSourceRedFlagsEntry,
                    fundingSourceEntry,msgs,costperdayBlock,CandTblock,therapyAuthorizationBlock,therapyApprovalBlock,fundingSourceAuthorizationDetailEntry,fundingbuttonsBlock"
                    oncomplete="closeModalDialogSA('FundingSourceModal', 'span');" />
        <apex:actionFunction name="fundingSourceInactivate" action="{!inactivateFundingSource}" status="fundingSouceModalStatus" rerender="fundingSources,fundingSourcePayerDetailEntry,fundingSourceRedFlagsEntry,fundingSourceEntry,msgs,costperdayBlock,CandTblock,therapyAuthorizationBlock,therapyApprovalBlock,fundingSourceAuthorizationDetailEntry,fundingbuttonsBlock"
                oncomplete="closeModalDialogSA('FundingSourceModal', 'span');" />
        <apex:actionFunction name="saveFundingSource" action="{!saveFundingSource}" status="fundingSouceModalStatus"
                oncomplete="fundingSourceScrollToTop(true); if (closeFundingSource) closeModalDialogSA('FundingSourceModal', 'span');" rerender="fundingSources,fundingSourcePayerDetailEntry,fundingSourceRedFlagsEntry,fundingSourceEntry,msgs,costperdayBlock,CandTblock,therapyAuthorizationBlock,therapyApprovalBlock,fundingSourceAuthorizationDetailEntry,fundingbuttonsBlock, authList" />
        <apex:actionFunction name="showAddFundingSource" status="fundingSouceModalStatus" action="{!showAddFundingSource}"
                oncomplete="openModalDialogSA('FundingSourceModal', 'span', 'Add Funding Source', null, 1000, 'myFRM'); fundingSourceScrollToTop(); fundingSourceClearMessages();" rerender="fundingSources,fundingSourcePayerDetailEntry,fundingSourceRedFlagsEntry,fundingSourceEntry,msgs,costperdayBlock,CandTblock,therapyAuthorizationBlock,therapyApprovalBlock,fundingSourceAuthorizationDetailEntry,fundingbuttonsBlock" />
<!--         <apex:actionFunction name="callcheckFullyDischarge" status="SaveStatus1" action="{!checkFullyDischarge}" rerender="myFRM" />oncomplete="dispdischargePopup();"/ -->
        <!--<apex:param name="bool" value="" assignTo="{!disregardSA}" />
        </apex:actionFunction>-->
        <apex:actionFunction name="callSaveMethod" action="{!SaveServAssign}" status="SaveStatus1" rerender="savestatus1,msgs" onComplete="setUpCompletionMonitor();bindAutoComplete();saStartDateTime.intializeDateTimePicker(jQuery('input[id$=startdate]'));"/>

        <apex:actionFunction name="showEditFundingSource" action="{!showEditFundingSource}" oncomplete="openModalDialogSA('FundingSourceModal', 'span', 'Add Funding Source', null, 1000, 'myFRM'); fundingSourceAllowedEdit();" rerender="fundingSources,fundingSourcePayerDetailEntry,fundingSourceRedFlagsEntry,fundingSourceEntry,msgs,costperdayBlock,CandTblock,therapyAuthorizationBlock,therapyApprovalBlock,fundingSourceAuthorizationDetailEntry,fundingbuttonsBlock" status="fundingSouceModalStatus" rendered="{! (vfVarIsCM ) || isNR || isADH}">
            <apex:param name="fundingId" value="" assignTo="{!fundingSource.Id}" />
        </apex:actionFunction>
        <apex:inputhidden value="{!dischargePopup}" id="hiddendischargePopup" />
        <apex:inputhidden value="{!locationSetting}" id="hiddenLocationSetting" /><!--html-data-visibility-rules="{&quot;Outpatient&quot;: [&quot;{!$Component.myFRM:SAblock:saStartSectionEdit:pbSecLocSetting:lblchildperm}&quot;,&quot;{!$Component.myFRM:SAblock:saStartSectionEdit:pbSecLocSetting:childPermGoalStart}&quot;] }" />
        <!----><apex:actionFunction action="{!updatelocation}" name="rerenderPanel" rerender="dummy">
            <apex:param name="locationSetting" value="" assignTo="{!locationSetting}" />
        </apex:actionFunction>
    <apex:actionFunction action="{!changeToModel}" name="changeToModel" rerender="ContractAssoc, ProgAssoc, msgs" status="SaveStatus1" />
        <apex:inputhidden value="{!theServAssign.Person_Being_Served__c}" rendered="{!canEditSA}" />
        <!-- To set focus on Top -->
        <input id="hiddenElementId" type="hidden" />
        <apex:inputhidden id="phaseToSave" value="{!theServAssign.Phase__c}" rendered="{!canEditSA}" />

        <!-- Sa Diag Junction -->
        <apex:actionFunction name="savesadiagJo" action="{!savesadiagJo}"  rerender="_sadiagJoSection_Alt1_Header,sadiagJoEntry,msgs, completeCheck" onComplete="setUpFields(); setUpCompletionMonitor(); return false; " />
        <apex:actionFunction name="showAddsadiagJo" action="{!showAddsadiagJo}" rerender="_sadiagJoSection_Alt1_Header,sadiagJoEntry,msgs" oncomplete="openModalDialogSA('saDiagModal', 'span', 'Associate Diagnosis','none', '700'); setUpFields(); return false;" status="pageProcessing"/>
        <apex:actionFunction name="showEditsadiagJo" action="{!showEditsadiagJo}"  rerender="sadiagJoEntry,msgs" oncomplete="openModalDialogSA('saDiagModal', 'span', 'Associate Diagnosis','none', '700'); setUpFields(); setABIDiagnosis(); setInjuryDate(); return false;"  status="pageProcessing" >
            <apex:param name="sadiagJoId" value="" />
        </apex:actionFunction>
         <!-- Sa Diag Junction End-->

        <apex:actionFunction name="showAddLocation" action="{!showAddLocation}" immediate="true" rerender="serviceLocationEntry,locationDisplay, msgs" oncomplete="openDialog('serviceLocationModal', 'span', 'Add/Edit Location'); " />
        <apex:actionFunction name="setEffectiveDate" action="{!setEffectiveDate}" rerender="ProgAssocViewNEW, ProgAssoc,ProgramSelect,ServCodeSelect" immediate="true">
            <apex:param name="effstart" value="" assignTo="{!effDate}" />
            <apex:param name="effend" value="" assignTo="{!effEnd}" />
        </apex:actionFunction>

        <!-- start seizure actions-->
        <!--<apex:actionFunction name="showAddSeizure" status="AddEditSeizureStatus" action="{!showAddSeizure}" oncomplete="openModalDialogSA('seizureTrackingModal', 'div', 'Add Seizure', null, 600); seizureScrollToTop(); seizureClearMessages();" rerender="seizureEntry,seizureMessages" /> -->
        <apex:actionFunction name="saveSeizure" action="{!saveSeizure}" status="saveSeizureStatus" oncomplete="seizureScrollToTop(true); if (closeSeizure && jQuery('.errorMsg').length == 0) closeModalDialogSA('seizureTrackingModal', 'div');" rerender="SeizureTrackingList,seizureEntry,seizureMessages" />
        <apex:actionFunction name="showEditSeizure" action="{!showEditSeizure}" status="AddEditSeizureStatus" oncomplete="openModalDialogSA('seizureTrackingModal', 'div', 'Add Seizure', null, 600);seizureScrollToTop(); seizureClearMessages();" rerender="seizureEntry, seizureMessages">
            <apex:param name="seizureId" value="" />
        </apex:actionFunction>
        <!-- end seizure actions-->

        <!-- Discharge popup-->
        <apex:outputPanel id="tstpopupAfterEsign" style="display:none; dispaly: block; height: 500px;">
        <apex:outputPanel styleClass="popupBackground" layout="block" rendered="true"/>
            <!--<apex:outputPanel styleClass="custPopup" layout="block" ><!--rendered="{!displayPopUp}">
            </apex:outputpanel>-->
            <apex:pageBlock id="blockAfterEsign" >
                <apex:pageBlockButtons location="bottom">
                    <apex:commandButton value="Yes" action="{!gotoAdmissionEditPage}"/>
                    <apex:commandButton value="No" action="{!gototServAssignViewPage}" />
                </apex:pageBlockButtons>
            </apex:pageBlock>
            <br/><br/>
        </apex:outputPanel>

        <!--  Discharge popup ends-->




        <!--  STANDARD SERVICE ASSIGNMENT BLOCK  -->
        <apex:pageBlock id="SAblock" mode="maindetail"  >
            <apex:pageBlockSection id="_Alt1_Header" title="Service Assignment" collapsible="false">
            </apex:pageBlockSection>
            <apex:pageBlockButtons location="top">
                <div class="blockbtns">
                    <apex:outputPanel layout="none" rendered="{!(AND(vfVarIsRW,BEGINS($UserRole.DeveloperName, 'IA')))}">
                        <a class="btn" href="#" onClick="window.open('/apex/PlanOfCarePdf?Id=' + '{!admission.Person_Being_Served__c}' , 'PlanOfCare'); window.open('/apex/PlanOfCareAddendum?Id=' + '{!admission.Person_Being_Served__c}' , 'PlanOfCareAddendum'); return false;" id="PlanOfCare">Plan Of Care</a>
                        <a class="btn" href="#" onClick="openModalDialogSA('IowaDailyDataSummaryDialog', 'div', 'Generate Daily Data Summary and Progress Note', null, 700);" id="IowaDailyDataSummaryGenerate">Create Daily Data Summary</a>
                    </apex:outputPanel>
                    <apex:commandButton value="Edit" action="{!EditServAssign}" rendered="{!canEditSA}" />
                </div>
            </apex:pageBlockButtons>

            <apex:pageBlockSection id="ServAssignDetail" collapsible="true" title="Service Assignment Detail" rendered="{!!AssessmentOnly}">
                <apex:outputField value="{!theServAssign.Admission__c}" />
                 <apex:pageBlockSectionItem helpText="Status 'Created in Error' is only to be used if the wrong program was selected or if the person never received services. This option is only available if services have not been provided.">
                    <label for="pStatus" >Service Assignment Status</label>
                    <apex:outputPanel >
                        <apex:outputField value="{!theServAssign.Status__c}" />
                        <!-- used in Progress score -->
                        <input id="pStatus" value="{!theServAssign.Status__c}" style="display: none;"  data-countInFormProgress="1" />
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>

                <apex:outputField value="{!theServAssign.Name}" />

                <apex:outputField value="{!theServAssign.Specify_Error__c}" rendered="{!theServAssign.Status__c == 'Created in Error'}" />
                <apex:pageBlockSectionItem rendered="{!theServAssign.Status__c == 'Created in Error'}">
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem >
                    <label for="pStartDate">Start Date</label>
                    <apex:outputPanel >
                        <apex:outputText value="{!saStrStartDateTime}" />
                        <!-- used in Progress score -->
                        <input id="pStartDate" value="{!saStrStartDateTime}" style="display: none;"  data-countInFormProgress="1" />
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>

                <apex:outputField value="{!theServAssign.Medical_Record_Number__c}" />
                <apex:outputField value="{!theServAssign.Projected_Treatment_End_Date__c}"/>
                <apex:pageblocksectionitem >
                    <apex:outputlabel value="Location of Service" for="locationDisplay" />
                    <apex:outputPanel id="locationDisplay" layout="inline" rendered="{! serviceLocation != null}">
                        <table>
                            <tr>
                                <td>
                                    <apex:outputlabel value="Alias" styleclass="labelCol" />
                                </td>
                                <td>
                                    <apex:outputField id="slAlias" value="{!serviceLocation.Name}" />
                                    <br/>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <apex:outputlabel value="Program Code" styleclass="labelCol" />
                                </td>
                                <td>
                                    <apex:outputField value="{!serviceLocation.ProgramID__c}" />
                                    <br/>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <apex:outputlabel value="Location Nickname" styleclass="labelCol" />
                                </td>
                                <td>
                                    <apex:outputField value="{!serviceLocation.Location_Nickname__c}" />
                                    <br/>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <apex:outputLabel value="Address" styleclass="labelCol" />
                                </td>
                                <td>
                                    <c:AddressDisplay City="{!serviceLocation.City__c}" State="{!serviceLocation.State__c}"/>
<!--                                     <apex:outputText value="{!serviceLocation.Phone__c}" /> -->
                                </td>
                            </tr>
                             <tr>
                                <td>
                                    <apex:outputlabel value="Physical Location" styleclass="labelCol" />
                                </td>
                                <td>
                                    <apex:outputField value="{!serviceLocation.Physical_Location__c}" />
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <apex:outputlabel value="Service Type" styleclass="labelCol" />
                                </td>
                                <td>
                                    <apex:outputField value="{!serviceLocation.Service_Type__c}" />
                                </td>
                            </tr>
                             <tr>
                                <td>
                                    <apex:outputlabel value="Network Service Line Offering" styleclass="labelCol" />
                                </td>
                                <td>
                                    <apex:outputField value="{!serviceLocation.Network_Offering__c}" />
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <apex:outputlabel value="TMN Scope" styleclass="labelCol" />
                                </td>
                                <td>
                                    <apex:outputField value="{!serviceLocation.TMN_Scope__c}" />
                                    <br/>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <apex:outputlabel value="Population Served" styleclass="labelCol" />
                                </td>
                                <td>
                                    <apex:outputField value="{!serviceLocation.Population_Served__c}" />
                                </td>
                            </tr>
                        </table>
                    </apex:outputPanel>
                </apex:pageblocksectionitem>
                <apex:outputField value="{!theServAssign.End_Date__c}"/>

                <apex:outputField value="{!theServAssign.Program_Detail__c}"/>

                <apex:outputField value="{!theServAssign.Episode__c}" rendered="{!!((vfVarIsCM && !isLudlow) || isNR || isADH) }" />
                <apex:outputfield value="{!theServAssign.Clinician__c}" rendered="{!(vfVarIsCB || isCAFSS)}" />

                <apex:pageblocksectionitem rendered="{! !(vfVarIsCB || isCAFSS)}" />
                <apex:pageBlockSectionItem rendered="{! !showLocation && !vfVarIsCM && !isNR && !isADH}">
                    <label for="pModel" >Model</label>
                    <apex:outputPanel >
                        <apex:outputField value="{!theservAssign.Model__c}"  />
                        <!-- used in Progress score -->
                        <input id="pModel" value="{!theservAssign.Model__c}" style="display: none;"  data-countInFormProgress="1" />
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>
            </apex:pageBlockSection>

            <apex:pageBlockSection id="AOServAssignDetail" collapsible="true" title="Service Assignment Detail" rendered="{!AssessmentOnly}">
                <apex:outputField value="{!theServAssign.Admission__c}" />

                <apex:pageBlockSectionItem helpText="Status 'Created in Error' is only to be used if the wrong program was selected or if the person never received services. This option is only available if services have not been provided.">
                    <label for="pStatus" >Service Assignment Status</label>
                    <apex:outputPanel >
                        <apex:outputField value="{!theServAssign.Status__c}" />
                        <!-- used in Progress score -->
                        <input id="pStatus" value="{!theServAssign.Status__c}" style="display: none;"  data-countInFormProgress="1" />
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>

                <apex:outputField value="{!theServAssign.Name}" />
                <apex:outputField value="{!theServAssign.Specify_Error__c}" rendered="{!theServAssign.Status__c == 'Created in Error'}" />
                <apex:pageBlockSectionItem rendered="{!theServAssign.Status__c == 'Created in Error'}">
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem >
                    <label for="pStartDate" >Start Date</label>
                    <apex:outputPanel >
                        <apex:outputText value="{!saStrStartDateTime}" />
                        <!-- used in Progress score -->
                        <input id="pStartDate" value="{!saStrStartDateTime}" style="display: none;"  data-countInFormProgress="1" />
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>

                <apex:outputField value="{!theServAssign.Medical_Record_Number__c}" />

                <apex:outputField value="{!theServAssign.Projected_Treatment_End_Date__c}" />

                <apex:pageblocksectionitem >
                    <apex:outputlabel value="Location of Service" for="locationDisplay" />
                    <apex:outputPanel id="locationDisplay" layout="inline" rendered="{! serviceLocation != null}">
                          <table>
                            <tr>
                                <td>
                                    <apex:outputlabel value="Alias" styleclass="labelCol" />
                                </td>
                                <td>
                                    <apex:outputField id="slAlias" value="{!serviceLocation.Name}" />
                                    <br/>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <apex:outputlabel value="Program Code" styleclass="labelCol" />
                                </td>
                                <td>
                                    <apex:outputField value="{!serviceLocation.ProgramID__c}" />
                                    <br/>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <apex:outputlabel value="Location Nickname" styleclass="labelCol" />
                                </td>
                                <td>
                                    <apex:outputField value="{!serviceLocation.Location_Nickname__c}" />
                                    <br/>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <apex:outputLabel value="Address" styleclass="labelCol" />
                                </td>
                                <td>
                                    <c:AddressDisplay City="{!serviceLocation.City__c}" State="{!serviceLocation.State__c}"/>
<!--                                     <apex:outputText value="{!serviceLocation.Phone__c}" /> -->
                                </td>
                            </tr>
                             <tr>
                                <td>
                                    <apex:outputlabel value="Physical Location" styleclass="labelCol" />
                                </td>
                                <td>
                                    <apex:outputField value="{!serviceLocation.Physical_Location__c}" />
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <apex:outputlabel value="Service Type" styleclass="labelCol" />
                                </td>
                                <td>
                                    <apex:outputField value="{!serviceLocation.Service_Type__c}" />
                                </td>
                            </tr>
                             <tr>
                                <td>
                                    <apex:outputlabel value="Network Service Line Offering" styleclass="labelCol" />
                                </td>
                                <td>
                                    <apex:outputField value="{!serviceLocation.Network_Offering__c}" />
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <apex:outputlabel value="TMN Scope" styleclass="labelCol" />
                                </td>
                                <td>
                                    <apex:outputField value="{!serviceLocation.TMN_Scope__c}" />
                                    <br/>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <apex:outputlabel value="Population Served" styleclass="labelCol" />
                                </td>
                                <td>
                                    <apex:outputField value="{!serviceLocation.Population_Served__c}" />
                                </td>
                            </tr>
                        </table>
                    </apex:outputPanel>
                </apex:pageblocksectionitem>

                <apex:outputField value="{!theServAssign.End_Date__c}"  />
                <apex:outputField value="{!theServAssign.Program_Detail__c}" />

                <apex:outputField value="{!theServAssign.Episode__c}" rendered="{!!isNR && !isADH}" />
                <apex:outputField value="{!theServAssign.Outcomes__c}" rendered="{!!isNR && !isADH}" />

                <apex:pageBlockSectionItem rendered="{! !showLocation && !vfVarIsCM  && !isNR && !isADH}">
                    <label for="pModel" >Model</label>
                    <apex:outputPanel >
                        <apex:outputField value="{!theservAssign.Model__c}"  />
                        <!-- used in Progress score -->
                        <input id="pModel" value="{!theservAssign.Model__c}" style="display: none;"  data-countInFormProgress="1" />
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>

                <!--  EB-526 -->
                <apex:outputfield value="{!theServAssign.Clinician__c}" rendered="{!(vfVarIsCB || isCAFSS)}" />
                <apex:outputText value="" rendered="{! (vfVarIsCB || isCAFSS)}" />
            </apex:pageBlockSection>
            <apex:pageBlockSection title="Contract Association" showHeader="true" columns="3" collapsible="true" id="ContractAssoc" rendered="{!!showLocation && !AssessmentOnly && !vfVarIsCM && !isNR && !isADH }">
               
                <apex:pageBlockSectionItem rendered="{!!isNR}">
                    <apex:outputLabel value="Contract" />
                    <apex:outputText value="{!associatedContractName}" />
                </apex:pageBlockSectionItem>
            </apex:pageBlockSection>

            <apex:pageBlockSection title="Program Association" showHeader="true" columns="1" collapsible="true" id="ProgAssocViewNEW" rendered="{!!showLocation && (vfVarIsCB || isCAFSS)}">
                <hr />
                <apex:outputText id="saProgram" value="{!theServAssign.Program__c}" />
                <apex:outputPanel id="ProgAssocPanelView2NEW" layout="block" styleClass="col" rendered="{!!showLocation }">
                    <apex:pageBlockTable value="{!programRows}" var="pR" id="ProgramAssocTableNEW" rendered="{!theServAssign.Program__c=='IFCS'}" headerClass="tbl-header" rowClasses="tmn-row-odd, tmn-row-even" >
                        <apex:column headerValue="Selected">
                            <apex:outputPanel rendered="{!(pR.paPhase<>999 && pR.paPhase==theServAssign.Phase__c)}">
                                <input type="radio" name="phaseRadio" checked="checked" disabled="disabled" />
                            </apex:outputPanel>
                            <apex:outputPanel rendered="{!(pR.paPhase<>999 && pR.paPhase<>theServAssign.Phase__c)}">
                                <input type="radio" name="phaseRadio" disabled="disabled" />
                            </apex:outputPanel>
                        </apex:column>
                        <apex:column headerValue="Phase of Treatment">
                            {!IF(pR.paPhase==999,"Total",pR.paPhase)}
                        </apex:column>
                        <apex:column headerValue="# Docs Received" value="{!pR.paNumDocsReceived}" />
                        <apex:column headerValue="# Docs Expected" value="{!pR.paNumDocsExpected}" />
                        <apex:column headerValue="% Complete" value="{!pR.paPhasePercentage}" />
                        <apex:column headerValue="Start Date">
                            <apex:outputField value="{!theServAssign.Phase_1_Start_Date__c}" rendered="{!pR.paPhase==1}" />
                            <apex:outputField value="{!theServAssign.Phase_2_Start_Date__c}" rendered="{!pR.paPhase==2}" />
                            <apex:outputField value="{!theServAssign.Phase_3_Start_Date__c}" rendered="{!pR.paPhase==3}" />
                            <apex:outputField value="{!theServAssign.Phase_4_Start_Date__c}" rendered="{!pR.paPhase==4}" />
                        </apex:column>
                        <apex:column headerValue="End Date">
                            <apex:outputField value="{!theServAssign.Phase_1_End_Date__c}" rendered="{!pR.paPhase==1}" />
                            <apex:outputField value="{!theServAssign.Phase_2_End_Date__c}" rendered="{!pR.paPhase==2}" />
                            <apex:outputField value="{!theServAssign.Phase_3_End_Date__c}" rendered="{!pR.paPhase==3}" />
                            <apex:outputField value="{!theServAssign.Phase_4_End_Date__c}" rendered="{!pR.paPhase==4}" />
                        </apex:column>
                    </apex:pageBlockTable>
                </apex:outputPanel>
            </apex:pageBlockSection>

            <apex:outputPanel style="display:none">
                <apex:actionregion >
                    <apex:inputText id="currentProgramID" value="{!currentProgramID}">
                        <apex:actionsupport event="onchange" action="{!loadAvailableCodesByID}" rerender="ServCodeSelect" />
                    </apex:inputText>
                </apex:actionregion>
            </apex:outputPanel>
            <apex:outputpanel rendered="{!showCodes}">
                <hr />
            </apex:outputpanel>
            <apex:pageBlockSection title="Service Code Selection" showHeader="true" columns="2" collapsible="true" id="ServCodeSelect" rendered="{!showCodes}">

                <apex:outputPanel layout="block" styleClass="col" rendered="{! effDate= null || currentProgramID=''}">
                    You must select a Location of Service and Start Date before you can select a Service Code.
                </apex:outputPanel>
                <apex:outputPanel layout="block" styleClass="col" rendered="{!AND(effDate!= null,currentProgramID!='')}">
                    <apex:actionStatus id="addStatus">
                        <apex:facet name="start">
                            <div class="waitingHolder" style="display: inline; margin-left: 5px; position: relative; top: 5px;">
                                <img class="waitingImage" src="/img/loading.gif" title="Please Wait..." /> <span class="waitingDescription"></span>
                            </div>
                        </apex:facet>
                        <apex:facet name="stop">
                            <apex:pageBlockTable value="{!AvailableCodes}" var="aCodes" id="avServCodesId" headerClass="tbl-header" rowClasses="tmn-row-odd, tmn-row-even" >

                                <apex:column headerValue="Available Service Codes" value="{!AvailableCodes[aCodes].Service_Value__c}" />
                                <apex:column headerValue="Program" value="{!AvailableCodes[aCodes].Program__c}" />
                                <apex:column headerValue="Start Date">
                                    <apex:outputText value="{0, date, MM/dd/yyyy}">
                                        <apex:param value="{!AvailableCodes[aCodes].Start_Date__c}" />
                                    </apex:outputText>
                                </apex:column>
                                <apex:column headerValue="End Date">
                                    <apex:outputText value="{0, date, MM/dd/yyyy}">
                                        <apex:param value="{!AvailableCodes[aCodes].End_Date__c}" />
                                    </apex:outputText>

                                    <!-- used to inspect source code to get the ID of the record being displayed, display should be none;-->
                                    <apex:outputPanel style="display: none;">{!AvailableCodes[aCodes].id}</apex:outputPanel>
                                </apex:column>

                            </apex:pageBlockTable>
                        </apex:facet>
                    </apex:actionStatus>
                </apex:outputPanel>
                <apex:outputPanel layout="block" styleClass="col" rendered="{!AND(effDate!= null,currentProgramID!='')}">
                    <apex:actionStatus id="removeStatus">
                        <apex:facet name="start">
                            <div class="waitingHolder" style="display: inline; margin-left: 5px; position: relative; top: 5px;">
                                <img class="waitingImage" src="/img/loading.gif" title="Please Wait..." /> <span class="waitingDescription"></span>
                            </div>
                        </apex:facet>
                        <apex:facet name="stop">
                            <apex:pageBlockTable value="{!SelectedCodes}" var="Code" id="selServCodesId" headerClass="tbl-header" rowClasses="tmn-row-odd, tmn-row-even" >
                                <apex:column headerValue="Selected Service Codes" value="{!SelectedCodes[Code].Service_Value__c}">
                                </apex:column>
                                <apex:column headerValue="Start Date">
                                    <apex:outputText value="{0, date, MM/dd/yyyy}">
                                        <apex:param value="{!SelectedCodes[Code].Start_Date__c}" />
                                    </apex:outputText>
                                </apex:column>
                                <apex:column headerValue="End Date">
                                    <apex:outputText value="{0, date, MM/dd/yyyy}">
                                        <apex:param value="{!SelectedCodes[Code].End_Date__c}" />
                                    </apex:outputText>

                                    <!-- used to inspect source code to get the ID of the record being displayed, display should be none;-->
                                    <apex:outputPanel style="display: none;">Service Code ID {!SelectedCodes[Code].Id}</apex:outputPanel>
                                    <apex:outputPanel style="display: none;">JO ID {!SelectedCodes[Code].id}</apex:outputPanel>

                                </apex:column>
                            </apex:pageBlockTable>
                        </apex:facet>
                    </apex:actionStatus>
                </apex:outputPanel>
            </apex:pageBlockSection>

            <apex:pageBlockSection title="Service Assignment Start" id="saStartSectionRead" collapsible="true" columns="2" showHeader="true" >

                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="Was this a transfer from another Service Assignment?" />
                    <apex:outputField value="{!theServAssign.Was_this_transfer_frm_another_ServAssig__c}" />
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem helpText="This person's service is beginning because the company providing their services was purchased by The MENTOR Network after 2016" >
                    <label for="pServBeginAqu" >Service Began via Acquisition Company (as of 2016)?</label>
                    <apex:outputPanel >
                        <apex:outputField value="{!theServAssign.Service_Began_via_Acquisition_Company__c}" />
                        <!-- used in Progress score -->
                        <input id="pServBeginAqu" value="{!theServAssign.Service_Began_via_Acquisition_Company__c}" style="display: none;"  data-countInFormProgress="1" />
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem rendered="{!(vfVarIsRW || isLudlow || vfVarIsCB) && Service_Assignment__c.Service_location__r.Network_Offering__c == 'ARY'}" >
                    <label for="pChldGoalAtStart" >Child Service Goal at Start of Service</label>
                    <apex:outputPanel >
                        <apex:outputField value="{!theServAssign.Child_Service_Goal__c}" />
                        <!-- used in Progress score -->
                        <input id="pChldGoalAtStart" value="{!theServAssign.Child_Service_Goal__c}" style="display: none;"  data-countInFormProgress="{!if(theServAssign.Child_Permanency_Goal__c ==null,'1','0')}" />
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem rendered="{!((vfVarIsRW || isLudlow || vfVarIsCB) && (Service_Assignment__c.Service_location__r.Network_Offering__c == 'ARY'  && Service_Assignment__c.Service_location__r.TMN_Scope__c == 'Residential'))}" >
                    <label for="pChldPermGoal" >Child Permanency Goal at Start of Service</label>
                    <apex:outputPanel >
                        <apex:outputField value="{!theServAssign.Child_Permanency_Goal__c}" />
                        <!-- used in Progress score -->
                        <input id="pChldPermGoal" value="{!theServAssign.Child_Permanency_Goal__c}" style="display: none;"  data-countInFormProgress="{!if(theServAssign.Child_Service_Goal__c ==null,'1','0')}" />
                    </apex:outputPanel>

                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem rendered="{!vfVarIsCB || isNR || vfVarIsRW || isLudlow}" >
                    <label for="pEduInvlStart" >Educational Involvement at Start of Service</label>
                    <apex:outputPanel >
                        <apex:outputField value="{!theServAssign.Educational_Involvement_at_Start__c}" />
                        <!-- used in Progress score -->
                        <input id="pEduInvlStart" value="{!theServAssign.Educational_Involvement_at_Start__c}" style="display: none;"  data-countInFormProgress="1" />
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem rendered="{!!isADH}">
                    <label for="pHighestEduStart" >Highest Level of Education at Start of Service</label>
                    <apex:outputPanel >
                        <apex:outputField value="{!theServAssign.Highest_Level_of_Education_at_Start__c}" />
                        <!-- used in Progress score -->
                        <input id="pHighestEduStart" value="{!theServAssign.Highest_Level_of_Education_at_Start__c}" style="display: none;"  data-countInFormProgress="{! if(vfVarIsCM && !isLudlow,'0','1') }" />
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem rendered="{!vfVarIsCB && Service_Assignment__c.Service_location__r.Network_Offering__c == 'ARY' && (Service_Assignment__c.Service_location__r.Physical_Location__c == 'Host Home' || Service_Assignment__c.Service_location__r.Service_Type__c == 'FCT - Family Centered Treatment')}" >
                    <label for="outofhomeplace" >Number of Out-of-Home Placements Pre-Service</label>
                    <apex:outputPanel >
                        <apex:outputField value="{!theServAssign.Number_of_Out_of_Home_Placements_Pre_Ser__c}" />
                        <input id="outofhomeplace" value="{!theServAssign.Number_of_Out_of_Home_Placements_Pre_Ser__c}" style="display: none;"  data-countInFormProgress="1" />
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem rendered="{!isNR}">
                    <label for="pRanchoScore" >Rancho Score at Start of Service</label>
                    <apex:outputPanel >
                        <apex:outputField value="{!theServAssign.Rancho_Score__c}" />
                        <!-- used in Progress score -->
                        <input id="pRanchoScore" value="{!theServAssign.Rancho_Score__c}" style="display: none;"  data-countInFormProgress="1" />
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>
                
                <apex:pageBlockSectionItem rendered="{!(vfVarIsCB || vfVarIsRW) && Service_Assignment__c.Service_location__r.Physical_Location__c == 'Host Home'}">
                    <apex:outputLabel value="Emergency Placement" />
                    <apex:outputField value="{!theServAssign.Emergency_Placement__c}" />
                </apex:pageBlockSectionItem>
            </apex:pageBlockSection>

            <apex:pageBlockSection title="Service Assignment End" id="saEndSectionRead" collapsible="true" columns="2" showHeader="true" >

                <apex:pageBlockSectionItem rendered="{!theServAssign.Status__c == 'Inactive'}">
                    <apex:outputLabel value="Is this a transfer to another Service Assignment?" />
                    <apex:outputField value="{!theServAssign.Is_this_transfer_to_another_ServAssign__c}" />
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem helpText="This person's service is ending because The Network no longer owns this operation" rendered="{!theServAssign.Status__c == 'Inactive'}" >
                    <apex:outputLabel value="Service Ended via Business Divested?" />
                    <apex:outputField value="{!theServAssign.Service_Ended_via_Business_Divested__c}" />
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem rendered="{!theServAssign.Status__c == 'Inactive' && Service_Assignment__c.Service_location__r.Network_Offering__c == 'ARY' && (vfVarIsRW || vfVarIsCB || isLudlow)}" >
                    <apex:outputLabel value="Was Child Service or Permanency Goal met at End of Service?" />
                    <apex:outputField value="{!theServAssign.Was_Child_Service_or_Permanency_Goal_met__c}" />
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem rendered="{!theServAssign.Status__c == 'Inactive' && (vfVarIsCB || isNR || vfVarIsRW || isLudlow)}" >
                    <apex:outputLabel value="Educational Involvement at End of Service" />
                    <apex:outputField value="{!theServAssign.Educational_Involvement_at_End_of_Servic__c}" />
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem rendered="{!theServAssign.Status__c == 'Inactive' && (vfVarIsCB || isNR || vfVarIsRW || isLudlow)}" >
                    <apex:outputLabel value="Highest Level of Education at End of Service" />
                    <apex:outputField value="{!theServAssign.Highest_Level_of_Education_at_End_of_Ser__c}" />
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem rendered="{!theServAssign.Status__c == 'Inactive' && vfVarIsCB && Service_Assignment__c.Service_location__r.Physical_Location__c == 'Host Home'}" >
                    <apex:outputLabel value="Total Number of Internal Moves During Service" />
                    <apex:outputField value="{!theServAssign.Total_no_of_Internal_moves_during_Servic__c}" />
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem rendered="{!(theServAssign.Status__c == 'Inactive' && (!vfVarIsCM || isLudlow) && ((Service_Assignment__c.Service_location__r.Network_Offering__c == 'ARY' && theServAssign.Was_Child_Service_or_Permanency_Goal_met__c =='No')  || Service_Assignment__c.Service_location__r.Network_Offering__c != 'ARY'))}" >
                    <apex:outputLabel value="End of Service Circumstances" />
                    <apex:outputField value="{!theServAssign.End_of_Service_Circumstances__c}" />
                </apex:pageBlockSectionItem>

                <!-- removed for PRI- 301
                <apex:pageBlockSectionItem rendered="{!(theServAssign.Status__c == 'Inactive' && isNR)}" >
                    <apex:outputLabel value="End of Service Status" />
                    <apex:outputField value="{!theServAssign.End_of_Service_Status__c}" />
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem rendered="{!(theServAssign.Status__c == 'Inactive' && isNR && theServAssign.End_of_Service_Status__c =='Other')}" >
                    <apex:outputLabel value="Specify Other" />
                    <apex:outputField value="{!theServAssign.Specify_Other__c}" />
                </apex:pageBlockSectionItem> -->

                <apex:pageBlockSectionItem rendered="{!theServAssign.Status__c == 'Inactive'}" >
                    <apex:outputLabel value="Was dissatisfaction the reason for service ending?" />
                    <apex:outputField value="{!theServAssign.Was_dissatisfaction_reason_for_service_e__c}" />
                </apex:pageBlockSectionItem>

                <apex:pageBlockSectionItem rendered="{!theServAssign.Status__c == 'Inactive' && theServAssign.Was_dissatisfaction_reason_for_service_e__c=='Yes'}" >
                    <apex:outputLabel value="Who was dissatisfied?" />
                    <apex:outputField value="{!theServAssign.Who_was_dissatisfied__c}" />
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem rendered="{!theServAssign.Status__c == 'Inactive' && theServAssign.Was_dissatisfaction_reason_for_service_e__c=='Yes'}" >
                    <apex:outputLabel value="Primary Reason for Dissatisfaction" />
                    <apex:outputField value="{!theServAssign.Primary_Reason_for_Dissatisfaction__c}" />
                </apex:pageBlockSectionItem>


            </apex:pageBlockSection>

            <apex:pageBlockSection title="System Information" showHeader="true" columns="2" collapsible="true" id="ServAssignSystemInfo">
                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="Created By" for="CreatedByLink" />

                    <apex:outputPanel >
                        <apex:outputLink id="CreatedByLink" value="/{!Service_Assignment__c.CreatedBy.Id}">{!Service_Assignment__c.CreatedBy.Name}</apex:outputLink>
                        <apex:outputText value=", " rendered="{!Service_Assignment__c.CreatedDate!=null}" />
                        <apex:outputText value=" {!Service_Assignment__c.CreatedDate}" />
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="Last Modified By" for="LastModifiedByLink" />

                    <apex:outputPanel >
                        <apex:outputLink id="LastModifiedByLink" value="/{!Service_Assignment__c.LastModifiedBy.Id}">{!Service_Assignment__c.LastModifiedBy.Name}</apex:outputLink>
                        <apex:outputText value=", " rendered="{!Service_Assignment__c.LastModifiedDate!=null}" />
                        <apex:outputText value=" {!Service_Assignment__c.LastModifiedDate}" />
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>
            </apex:pageBlockSection>

            <!-- START:  Uncomment to have the element collapsed by default
    <script>
        twistSection(document.getElementById('{!$Component.block1.section1}').getElementsByTagName('img')[0])
    </script>

END: Uncomment to have the element collapsed by default -->

        </apex:pageBlock>
        <!--  END STANDARD SERVICE ASSIGNMENT BLOCK  -->
        <apex:pageBlock rendered="false">
            <apex:pageBlockSection id="AOServAssignDetail" columns="1" collapsible="true" title="Service Assignment Detail" rendered="{!AssessmentOnly}">
                <apex:outputField value="{!theServAssign.Admission__c}" />
                <apex:outputField value="{!theServAssign.Name}" />
                <apex:outputField value="{!theServAssign.Status__c}"  />
                <apex:outputField value="{!theServAssign.Start_Date__c}" />
                <apex:outputField value="{!theServAssign.Projected_Treatment_End_Date__c}" />
                <apex:outputField value="{!theServAssign.End_Date__c}" />
                <apex:outputField value="{!theServAssign.Outcomes__c}" />
            </apex:pageBlockSection>
            <hr />
            <apex:pageBlockSection title="Program Association" showHeader="true" columns="1" collapsible="true" id="ProgAssoc" rendered="{!!showLocation}">
                <apex:outputPanel id="ProgAssocPanelView" layout="block" styleClass="col">
                    <apex:outputLabel for="ProgramField" title="Program" value="Program " style="font-weight:bold" />
                    <apex:outputField id="ProgramField" value="{!theServAssign.Program__c}" />
                    <br />
                    <apex:outputLabel for="LocationField" title="Program" value="Location " style="font-weight:bold;" />
                    <apex:outputField id="LocationField" value="{!theServAssign.Location_Region__c}" />
                    <br />
                    <apex:outputLabel for="ServLineField" title="Program" value="Service Line " style="font-weight:bold;" />
                    <apex:outputField id="ServLineField" value="{!theServAssign.Service_Line__c}" />
                </apex:outputPanel>
            </apex:pageBlockSection>
            <apex:outputpanel rendered="{!showCodes}">
                <hr />
            </apex:outputpanel>

            <apex:pageBlockSection title="Service Code Selection" showHeader="true" columns="2" collapsible="true" id="ServCodeSelect" rendered="{!showCodes}">
                <apex:outputPanel layout="block" styleClass="col" rendered="{!OR(currentProgram=='',currentLocation=='',currentServiceLine=='')}">
                    You must select a Program, Location, and Service Line for this Service Assignment before you can select a Service Code.
                </apex:outputPanel>
                <apex:outputPanel layout="block" styleClass="col" rendered="{!AND(currentProgram!='',currentLocation!='',currentServiceLine!='')}">
                    <apex:actionStatus id="addStatus">
                        <apex:facet name="start">
                            <div class="waitingHolder" style="display: inline; margin-left: 5px; position: relative; top: 5px;">
                                <img class="waitingImage" src="/img/loading.gif" title="Please Wait..." /> <span class="waitingDescription"></span>
                            </div>
                        </apex:facet>
                        <apex:facet name="stop">
                            <apex:pageBlockTable value="{!AvailableCodes}" var="aCodes" headerClass="tbl-header" rowClasses="tmn-row-odd, tmn-row-even" >
                               
                                <apex:column headerValue="Available Service Codes" value="{!AvailableCodes[aCodes].Service_Value__c}" />
                                <apex:column headerValue="Program" value="{!AvailableCodes[aCodes].Program__c}" />
                                <apex:column headerValue="Start Date">
                                    <apex:outputText value="{0, date, MM/dd/yyyy}">
                                        <apex:param value="{!AvailableCodes[aCodes].Start_Date__c}" />
                                    </apex:outputText>
                                </apex:column>
                                <apex:column headerValue="End Date">
                                    <apex:outputText value="{0, date, MM/dd/yyyy}">
                                        <apex:param value="{!AvailableCodes[aCodes].End_Date__c}" />
                                    </apex:outputText>

                                    <!-- used to inspect source code to get the ID of the record being displayed, display should be none;-->
                                    <apex:outputPanel style="display: none;">{!AvailableCodes[aCodes].id}</apex:outputPanel>
                                </apex:column>

                            </apex:pageBlockTable>
                        </apex:facet>
                    </apex:actionStatus>
                </apex:outputPanel>
                <apex:outputPanel layout="block" styleClass="col" rendered="{!AND(currentProgram!='',currentLocation!='',currentServiceLine!='')}">
                    <apex:actionStatus id="removeStatus">
                        <apex:facet name="start">
                            <div class="waitingHolder" style="display: inline; margin-left: 5px; position: relative; top: 5px;">
                                <img class="waitingImage" src="/img/loading.gif" title="Please Wait..." /> <span class="waitingDescription"></span>
                            </div>
                        </apex:facet>
                        <apex:facet name="stop">
                            <apex:pageBlockTable value="{!SelectedCodes}" var="Code" headerClass="tbl-header" rowClasses="tmn-row-odd, tmn-row-even" >
                                <apex:column headerValue="Selected Service Codes" value="{!SelectedCodes[Code].Service_Value__c}">
                                </apex:column>
                                <apex:column headerValue="Start Date">
                                    <apex:outputText value="{0, date, MM/dd/yyyy}">
                                        <apex:param value="{!SelectedCodes[Code].Start_Date__c}" />
                                    </apex:outputText>
                                </apex:column>
                                <apex:column headerValue="End Date">
                                    <apex:outputText value="{0, date, MM/dd/yyyy}">
                                        <apex:param value="{!SelectedCodes[Code].End_Date__c}" />
                                    </apex:outputText>

                                    <!-- used to inspect source code to get the ID of the record being displayed, display should be none;-->
                                    <apex:outputPanel style="display: none;">Service Code ID {!SelectedCodes[Code].Id}</apex:outputPanel>
                                    <apex:outputPanel style="display: none;">JO ID {!SelectedCodes[Code].id}</apex:outputPanel>

                                </apex:column>
                            </apex:pageBlockTable>
                        </apex:facet>
                    </apex:actionStatus>
                </apex:outputPanel>
            </apex:pageBlockSection>
            <apex:outputPanel rendered="{!!showLocation}">
                <hr />
            </apex:outputPanel>
            <apex:pageBlockSection title="System Information" showHeader="true" columns="2" collapsible="true" id="ServAssignSystemInfo">
                <apex:outputPanel >
                    <apex:outputLabel value="Created By" for="CreatedByLink" style="font-size: 75%;font-family: 'Arial','Helvetica',sans-serif; font-weight:bold;" />&nbsp;&nbsp;
                    <apex:outputLink id="CreatedByLink" value="/{!Service_Assignment__c.CreatedBy.Id}">{!Service_Assignment__c.CreatedBy.Name}</apex:outputLink>
                    <apex:outputText value=", " rendered="{!Service_Assignment__c.CreatedDate!=null}" />
                    <apex:outputText value=" {!Service_Assignment__c.CreatedDate}" />
                </apex:outputPanel>
                <apex:outputPanel >
                    <apex:outputLabel style="font-size: 75%;font-family: 'Arial','Helvetica',sans-serif; font-weight:bold;" value="Last Modified By" for="LastModifiedByLink" />&nbsp;&nbsp;
                    <apex:outputLink id="LastModifiedByLink" value="/{!Service_Assignment__c.LastModifiedBy.Id}">{!Service_Assignment__c.LastModifiedBy.Name}</apex:outputLink>
                    <apex:outputText value=", " rendered="{!Service_Assignment__c.LastModifiedDate!=null}" />
                    <apex:outputText value=" {!Service_Assignment__c.LastModifiedDate}" />
                </apex:outputPanel>
            </apex:pageBlockSection>

        </apex:pageBlock>
        
        <!-- Add Section for Oregon Flavor -->
        <a id="Associate_Diagnosis"></a>
        <apex:actionFunction name="showEditPa" action="{!showeditPa}" reRender="msgs,pAgentModalBlock" status="pageProcessing" oncomplete="openModalDialogSA('pAgentmodal', 'span', 'Add/Edit Personal Agent','none', '700'); setTodateforPa(); return false;" >
            <apex:param name="paId" value="" />
        </apex:actionFunction>
<!--        <apex:actionFunction name="showAddPa" action="{!showAddpa}" rerender="msgs,pAgentModalBlock" status="pageProcessing" oncomplete="openModalDialogSA('pAgentmodal', 'span', 'Add/Edit Personal Agent','none','700'); return false;" /> -->
        <apex:pageBlock id="pAgentdisplayBlock" mode="maindetail" rendered="{! !newSA && (Service_Assignment__c.Service_location__r.name  == '038020' || Service_Assignment__c.Service_location__r.name  == '038025') }" >
            <apex:pageBlockButtons location="top">
                <div class="blockbtns">
                    <apex:commandButton value="Add Personal Agent" id="addPaButton"  action="{!showAddpa}" rerender="msgs,pAgentModalBlock" status="pageProcessing" oncomplete="openModalDialogSA('pAgentmodal', 'span', 'Add/Edit Personal Agent','none','700'); setTodateforPa(); return false;" />
                </div>
            </apex:pageBlockButtons>
              <apex:pageBlockSection title="Personal Agents" columns="1" collapsible="true" id="_pAgentSection_Alt1_Header" >
                <apex:pageBlockTable value="{!paList}" var="pa" id="pAgentTable">
                    <apex:column headerValue="Action"><a href="#Diag" onclick="showEditPa('{!pa.id}'); return false;">Edit</a>
                    </apex:column>
                    <apex:column value="{!pa.Personal_Agent__r.Name}" />
                    <apex:column value="{!pa.Status__c}" />
                    <apex:column value="{!pa.From_Date__c}" headerValue="From" />
                    <apex:column value="{!pa.To_Date__c}" headerValue="To" />
                </apex:pageBlockTable>
              </apex:pageBlockSection>
        </apex:pageBlock>
        <!-- End Personal Agent Section -->
        
        <!-- Sa Diagnosis Junction Section -->
        <a id="Associate_Diagnosis"></a>
         <apex:outputPanel id="completeCheck" >
         <div style="display: none;">
         <label for="DiagPerc">At least one Diagnosis</label>
         <input id="DiagPerc" value="{! if (sadiagJOList.size >0,'True','') }"  data-countInFormProgress="1" />
         </div>
         </apex:outputPanel>
        <apex:pageBlock id="pbsadiagBlock" mode="maindetail" rendered="{! !newSA }" >
             <apex:pageBlockButtons location="top">
                <div class="blockbtns">
                    <apex:commandButton value="Associate Diagnosis" id="addsadiagJo" onClick="showAddsadiagJo(); return false;" rendered="{! !RWL1}" />
                </div>
            </apex:pageBlockButtons>
             <apex:pageBlockSection title="Diagnosis" columns="1" collapsible="true" id="_sadiagJoSection_Alt1_Header">
                <apex:pageblockTable value="{!sadiagJOList}" var="jo" rendered="{!sadiagJOList != null && (sadiagJOList.size>0)}"  headerClass="tbl-header" rowClasses="tmn-row-odd, tmn-row-even" >
                    <apex:column headerValue="Action"><a href="#Diag" onclick="showEditsadiagJo('{!jo.id}'); return false;">Edit</a>
                    </apex:column>
                    <apex:column headerValue="Diagnosis">
                        {!jo.Diagnosis__r.ICD__r.Name} - {!jo.Diagnosis__r.ICD__r.Icd_Description__c}
                    </apex:column>
<!--                     <apex:column value="{!jo.Status__c}" /> -->
                    <apex:column value="{!jo.Ranking__c}" />
                    <apex:column value="{!jo.Billable__c}" />
                    <apex:column value="{!jo.ABI_Diagnosis__c}" rendered="{!!isADH}"/>
                    <apex:column value="{!jo.Injury_Type__c}" rendered="{!isNR || vfVarIsCM}"/>
                    <apex:column value="{!jo.Injury_Type_Other__c}" rendered="{!isNR || vfVarIsCM }" />
                    <apex:column value="{!jo.Date_of_Injury__c}" rendered="{!!isADH}"/>
                    <apex:column value="{!jo.Glasgow_Coma_Score_at_Injury__c}" rendered="{!isNR}" />
                    <apex:column value="{!jo.Glasgow_Coma_Scale_Severity__c}" rendered="{!isNR}" />
                </apex:pageblockTable>
<!--                 <apex:inputHidden value="{!hasPrimaryDiagJo}" /> -->
<!--                 <apex:inputHidden value="{!primaryDiagJoId}" /> -->
                <apex:outputText value="No diagnoses to display" rendered="{!(sadiagJOList.size=0)}" />
             </apex:pageBlockSection>
        </apex:pageBlock>


        <!--  Seizure section -->
        <!-- Add Seizure Tracking modal. -->
        <apex:outputPanel id="seizureTrackingModal" layout="block" style="display:none;" rendered="{!!newSA}">
            <span class="ui-helper-hidden-accessible"><input type="text"/></span>
            <div id='seizureMessages'></div>
            <apex:pageBlock mode="maindetail">
                <apex:pageBlockSection columns="2" id="seizureEntry">
                    <apex:pageBlockSectionItem >
                        <apex:outputLabel Value="Start Time"/>
                        <apex:outputPanel >
                        <div class="requiredInput">
                            <div class="requiredBlock"></div>
                            <c:MilitaryDateTimeWithSeconds edit="true" shiftTop="20" hiddenFieldId="seizureEntry_startDateTime" dateTimeVal="{! IF(seizure.Start_DateTime__c==null, NOW(), seizure.Start_DateTime__c) }" datetimepickerid="seizureEntry_startDateTimeInput"/>
                        </div>
                        </apex:outputPanel>
                    </apex:pageBlockSectionItem>
                    <apex:inputField value="{!seizure.Medication_Administered_pre_seizure__c}" id="seizureEntry_medAdmPreSeizure" rendered="{!vfVarIsRwCA}"/>
                    <apex:pageBlockSectionItem rendered="{!vfVarIsRwExtraItems || (vfVarIsCM && !isLudlow)}" />
                    <apex:pageBlockSectionItem >
                        <apex:outputLabel Value="End Time"/>
                        <apex:outputPanel >
                        <div class="requiredInput">
                            <div class="requiredBlock"></div>
                            <c:MilitaryDateTimeWithSeconds edit="true" shiftTop="20" hiddenFieldId="seizureEntry_endDateTime" dateTimeVal="{! IF(seizure.End_DateTime__c==null, NOW(), seizure.End_DateTime__c) }" datetimepickerid="seizureEntry_endDateTimeInput"/>
                        </div>
                        </apex:outputPanel>
                    </apex:pageBlockSectionItem>
                    <apex:pageBlockSectionItem rendered="{!vfVarIsRwExtraItems ||(vfVarIsCM && !isLudlow)}" />
                    <apex:inputField value="{!seizure.Medication_Administered_post_seizure__c}" id="seizureEntry_medAdmPostSeizure" rendered="{!vfVarIsRwCA}"/>
                    <apex:pageBlockSectionItem >
                        <apex:outputLabel Value="Observed By"/>
                        <apex:outputPanel >
                        <div class="requiredInput">
                            <div class="requiredBlock"></div>
                            <apex:inputField value="{!seizure.Observed_By__c}" id="seizureEntry_observedBy"/>
                        </div>
                        </apex:outputPanel>
                    </apex:pageBlockSectionItem>
                    <apex:pageBlockSectionItem rendered="{!vfVarIsRwExtraItems || (vfVarIsCM && !isLudlow)}" />
                    <apex:inputField value="{!seizure.Medication_Detail__c}" id="seizureEntry_medDetail" rendered="{!vfVarIsRwCA}"/>


                    <apex:inputField value="{!seizure.Seizure_Description__c}" id="seizureEntry_Desc" rendered="{!vfVarIsRwExtraItems || vfVarIsRwCA}"/>
                    <apex:pageBlockSectionItem rendered="{!vfVarIsRwExtraItems || vfVarIsRwCA}" />
                    <apex:inputField value="{!seizure.Pre_seizure_phase__c}" id="seizureEntry_preSeizurePhase" rendered="{!vfVarIsRwExtraItems || vfVarIsRwCA}"/>
                    <apex:pageBlockSectionItem rendered="{!vfVarIsRwExtraItems || vfVarIsRwCA}" />
                    <apex:inputField value="{!seizure.Post_seizure_phase__c}" id="seizureEntry_postSeizurePhase" rendered="{!vfVarIsRwExtraItems || vfVarIsRwCA}"/>
                    <apex:pageBlockSectionItem rendered="{!vfVarIsRwExtraItems || vfVarIsRwCA}" />
                    <apex:inputField value="{!seizure.Comments__c}" id="seizureEntry_comments" />
                    <apex:pageBlockSectionItem rendered="{!vfVarIsRwExtraItems || vfVarIsRwCA || (vfVarIsCM && !isLudlow)}" />
                    <apex:inputField value="{!seizure.Duplicate_Entry__c}" id="seizureEntry_duplicateEntry" />
                    <apex:inputHidden value="{!seizure.Id}" id="seizureEntry_Id" />
                </apex:pageBlockSection>
                
                    <apex:inputHidden value="{!seizureStart_DateTime}" id="seizureEntry_startDateTime" />
                    <apex:inputHidden value="{!seizureEnd_DateTime}" id="seizureEntry_endDateTime" />
                <apex:pageblockButtons location="bottom">
                    <apex:actionStatus id="saveSeizureStatus">
                        <apex:facet name="start">
                            <apex:image height="16px" value="/img/loading32.gif" styleClass="dialogLoadingSpinner" />
                        </apex:facet>
                        <apex:facet name="stop">
                            <apex:outputPanel >
                                <apex:commandButton id="saveSeizure" value="Save" onclick="seizureSave(true);return false;" />
                                <apex:commandButton id="saveAndNewSeizure" value="Save & New" onclick="seizureSave(false); return false;" />
                                <apex:commandButton value="Cancel" onclick="closeModalDialogSA('seizureTrackingModal', 'div');j$('#seizureMessages').html('');return false;" />
                            </apex:outputPanel>
                        </apex:facet>
                    </apex:actionStatus>
                </apex:pageblockButtons>
            </apex:pageBlock>
        </apex:outputPanel>
        <apex:outputPanel id="seizure-dialog-confirm" title="Confirm save" layout="block" style="display:none">
            <apex:outputPanel layout="inline">
            <apex:outputPanel layout="inline" styleClass="ui-icon ui-icon-alert" style="float:left; margin:0 7px 20px 0;" />
                There is already an existing Seizure for the overlapping time, this could be a duplicate entry. Do you still want to Save?
            </apex:outputPanel>
        </apex:outputPanel>

        <a id="Seizure_Tracking"></a>
        <apex:pageBlock id="SeizureTrackingList" mode="maindetail" rendered="{! (!vfVarIsCB && !newSA && !vfVarIsRW && !isLudlow  && !isNR && !isADH && !isCAFSS) ||  (vfVarIsRwExtraItems && !isCAFSS) || (vfVarIsRwCA && !isCAFSS)}">
            <apex:pageBlockButtons location="top">
                <div class="blockbtns">
    <!--             <apex:actionStatus id="AddSeizureStatus"> -->
    <!--                 <apex:facet name="start"> -->
    <!--                     <apex:image height="16px" value="/img/loading32.gif" styleClass="dialogLoadingSpinner" /> -->
    <!--                 </apex:facet> -->
    <!--                 <apex:facet name="stop" > -->
    <!--                <apex:commandButton value="Add Seizure" onclick="showAddSeizure(); return false;" /> -->
                        <apex:actionFunction name="refreshSeizure" action="{!newSeizure}" rerender="seizureTrackingModal" status="pageProcessing" oncomplete="openModalDialogSA('seizureTrackingModal', 'div', 'Add Seizure', null, 600); seizureScrollToTop(); seizureClearMessages();" />

                        <input type="button" class="btn" value="Add Seizure"  onclick="refreshSeizure();"/>
    <!--                <input type="button" class="btn" value="Add Seizure" onclick="showAddSeizure(); return false;"/> -->
                        <input type="button" class="btn" value="Seizure Report" onclick="window.open('/apex/SeizureTrackingRpt?saId={!Service_Assignment__c.Id}', '_self'); return false;" />
    <!--                 </apex:facet> -->
    <!--             </apex:actionStatus> -->
                </div>
            </apex:pageBlockButtons>
            <apex:pageBlockSection id="_Alt1_Header" title="Seizures" collapsible="true" columns="1">
                <apex:outputText value="No seizures to display" rendered="{!seizures.size==0}" />
                <apex:outputPanel rendered="{!seizures.size > 5}">Showing 5 most recent Records. Click <a href="/apex/SeizureListView?saId={!Service_Assignment__c.Id}" style="color: blue;">here</a>&nbsp;to view All </apex:outputPanel>

    <!--             <apex:actionStatus id="editSeizureStatus"> -->
    <!--                 <apex:facet name="start"> -->
    <!--                     <apex:image height="16px" value="/img/loading32.gif" styleClass="dialogLoadingSpinner" /> -->
    <!--                 </apex:facet> -->
    <!--                 <apex:facet name="stop"></apex:facet> -->
    <!--             </apex:actionStatus> -->

                <apex:pageBlockTable value="{!seizures}" var="seizure" rendered="{!seizures.size>0}" rows="5" headerClass="tbl-header" rowClasses="tmn-row-odd, tmn-row-even" >
                    <apex:column headerValue="Action" width="12%">
                         <a href="#" onclick="loadSeizure('{!seizure.Id}');return false; ">Edit</a>
                    </apex:column>
                    <apex:column headerValue="Seizure Start Time" width="16%"><c:MilitaryDateTimeWithSeconds dateTimeVal="{!seizure.Start_DateTime__c}"/></apex:column>
                    <apex:column headerValue="Seizure End Time" width="16%"><c:MilitaryDateTimeWithSeconds dateTimeVal="{!seizure.End_DateTime__c}"/></apex:column>
                    <apex:column value="{!seizure.Observed_By__c}" width="16%"/>
                    <apex:column value="{!seizure.Comments__c}" width="40%"/>
                    <apex:column value="{!seizure.Duplicate_Entry__c}" width="5%"/>
                </apex:pageBlockTable>
            </apex:pageBlockSection>
        </apex:pageBlock>

        <apex:actionStatus id="AddEditSeizureStatus" >
            <apex:facet name="start">
                    <style>
                    .thinkingwheel{position: fixed; left:50%; top:50%; background-color: white; border: 2px solid gray; padding: 2px; z-index: 2000;}
                .foggy{
                    opacity:0.8;
                    background-color:#ccc;
                    position:fixed;
                    width:100%;
                    height:100%;
                    top:0px;
                    left:0px;
                    z-index:1000;
                }
                </style>

                <div class="foggy" />
                <div class="thinkingwheel" >
                    <span><img class="waitingImage" src="/img/loading.gif" title="Please Wait..." /> Processing . . . </span>
                </div>
            </apex:facet>
            <apex:facet name="stop"> </apex:facet>
        </apex:actionStatus>
        <!-- end Seizures section-->

    <!-- Restraint Events Start -->
        <a name="Assessment_res" id="Assessment_res"></a>
        <apex:pageBlock mode="maindetail" id="Assessment_res" rendered="{! (vfVarIsCM && !isLudlow) && $Setup.SystemSettings__c.Referral_ConvertCMEnabled__c}">
            <apex:pageBlockButtons location="top">
                <div class="blockbtns">
                    <apex:commandButton value="New Restraint Event"  action="{!addrestraintEvent}" reRender="msgs" status="AddResidentAssessmentStatus" rendered="{!Service_Assignment__c.Status__c != 'Inactive' && canAddShiftDoc}"/>
                    <apex:commandButton value="Restraint Reduction Report" onclick="openModalDialogSA('restraintReportModal', 'span', 'Generate Restraint Reduction Report'); return false; " />
                </div>
            </apex:pageBlockButtons>
            <apex:pageBlockSection id="assess_Alt1_Header" title="Restraint Events" collapsible="true" columns="1">
                <apex:pageBlockTable value="{!restraintEvents}" var="event" rendered="{!restraintEvents.size > 0}" headerClass="tbl-header" rowClasses="tmn-row-odd, tmn-row-even" >
    <!--                <apex:column headerValue="Action"><apex:outputLink value="/apex/EvaluationEdit?id={!event.Id}" rendered="{!!event.Is_Signed__c}">Edit</apex:outputLink> -->
    <!--                </apex:column> -->
                    <apex:column headerValue="Name">
                        <apex:outputLink value="/apex/EvaluationView?id={!event.Id}">{!event.Name}</apex:outputLink>
                    </apex:column>
                    <apex:column headerValue="Restraint Status">
                        <apex:outputText value="{!event.Status__c}" />
                    </apex:column>
                    <apex:column headerValue="Restraint Event Start Time" >
                        <c:MilitaryDatetime dateTimeVal="{!event.Shift_Start_Time__c}" />
                    </apex:column>
                    <apex:column headerValue="Restraint Event End Time" >
                        <c:MilitaryDatetime dateTimeVal="{!event.Shift_End_Time__c}" />
                    </apex:column>
                    <apex:column headerValue="Owner Name">
                        <apex:outputText value="{!event.Owner.Name}" />
                    </apex:column>
                    <apex:column headerValue="Last Modified">
                        <apex:outputText value=" {!event.LastModifiedDate}" />
                    </apex:column>
    <!--                <apex:column headerValue="Event End At"> -->
    <!--                    <apex:outputfield value=" {!event.Signed_At__c}" /> -->
    <!--                </apex:column> -->
                </apex:pageBlockTable>
                <apex:outputText value="No Restraint Events to display" rendered="{!restraintEvents.size=0 || restraintEvents == null}" />
                <apex:outputPanel rendered="{!restraintEvents.size>0}">Showing 5 most recent Records. Click <a href="/apex/CMShiftAssessmentListView?saId={!Service_Assignment__c.Id}&recType=Restraint Event" style="color: blue;">here</a>&nbsp;to view All </apex:outputPanel>
            </apex:pageBlockSection>
        </apex:pageBlock>
<!--        End -->

        <!-- Isolation Events Start -->
        <a id="isolation"></a>
        <apex:pageBlock mode="maindetail" rendered="{! (vfVarIsCM && !isLudlow)}" >
            <c:EvaluationResponseTable saParentId="{!Service_Assignment__c.Id}"
                                       type="Isolation Event"
                                       formId="{!$Component.myFRM}"
                                       uniqueId="Isolation_Event"
                                       showTitle="true"
                                       rules="{&quot;Isolation_Type__c&quot;: {&quot;Other&quot;: [&quot;Other__c&quot;]}}"
                                       cols="1"
                                       rows="5"
                                       showDisregard="false"
                                       eSign="false"
                                       addEnabled="true"
                                       editEnabled="true"
                                       showAddNew="false"
                                       collapsible="true" />
        </apex:pageBlock>
        <!-- Isolation Events End -->

        <!--  Plan section -->
        <apex:actionFunction name="makeNewPlan" action="{!NewPlan}" rerender="" status="planstatus" />
        <a name="Plan" id="Plan"></a>
        <!--  Added isNR by Amruth for EB-434 -->
        <apex:pageBlock id="Plan" mode="maindetail" rendered="{! (!AssessmentOnly || isNR) }">
            <apex:pageBlockButtons location="top">
                <div class="blockbtns">
                    <apex:actionStatus id="planstatus">
                        <apex:facet name="stop">
                        <!--  Added isNR by Amruth for EB-434 -->
                        <apex:commandButton value="New Plan" rendered="{!(plans.size=0) && canCreatePlan && !isNR && !isADH}" immediate="true" onclick="this.disabled='disabled'; makeNewPlan(); return false;" />
                        </apex:facet>
                        <apex:facet name="start">
                            <apex:commandButton value="Loading..." disabled="true" />
                        </apex:facet>
                    </apex:actionStatus>
                    <apex:commandButton onclick="window.open('/{!Ack_Overview}?pv0={!Service_Assignment__c.Name}', '_self'); return false;" rendered="{! plans.size!=0}" value="Acknowledgment Overview" />

                </div>
            </apex:pageBlockButtons>
            <apex:pageBlockSection id="ap_Alt1_Header" title="Action Plans" columns="1" collapsible="true" rendered="{!(!isNR && !isADH)}">

                <apex:pageblockTable value="{!plans}" var="pl" rendered="{!(plans.size>0) }" headerClass="tbl-header" rowClasses="tmn-row-odd, tmn-row-even" >

                    <apex:column headerValue="Action" styleClass="editcol" rendered="{!canEditPlan}">
                        <a href="/{!pl.ID}">Edit</a>
                    </apex:column>
                    <apex:column headerValue="Name">
                        <apex:outputLink value="/{!pl.id}">
                            <apex:outputField value="{!pl.name}" /></apex:outputLink>
                    </apex:column>
                    <apex:column value="{!pl.status__c }" />
                    <apex:column value="{!pl.effective_date__c }" />
                    <apex:column value="{!pl.target_date__c }" />
                </apex:pageblockTable>
                <apex:outputText value="No plans to display" rendered="{!(plans.size=0)}" />

            </apex:pageBlockSection>
        </apex:pageBlock>

        <!--  SkillWorksheet section -->
        <a name="SkillWorksheet" id="SkillWorksheetAnchor"></a>
        <apex:pageBlock id="SkillWorksheet" mode="maindetail" rendered="{! showWorksheetBlocks && vfVarCanAccessWS}">
            <apex:pageBlockButtons location="top">
                <div class="blockbtns">
                    <apex:outputPanel onclick="j$('[id *=newswsbtn]').toggle();" styleclass="btn">New Skill Worksheet</apex:outputPanel>
                </div>
            </apex:pageBlockButtons>
            <apex:outputPanel id="newswsbtn" layout="block" style="display: none; border: 1px solid black;width:600px;-webkit-columns:120px 4;columns:150px 4">
                <apex:repeat value="{!uncheckedWeeks}" var="week">
                    <apex:commandLink action="{!newSkillWorksheet}" value="{!week.UserDate}" status="{!$Component.SkillWorksheet.skillworksheetStatus}" rerender="none">
                        <apex:param assignTo="{!worksheetStartDate}" value="{!week.ParsableDate}" name="week" />
<!--                        <apex:actionStatus  -->
                    </apex:commandLink>
                    <br/>
                </apex:repeat>
                <apex:actionStatus id="skillworksheetStatus" >
                    <apex:facet name="start">
                    <div style="opacity:0.8; background-color:#ccc; position:fixed; width:100%; height:100%; top:0px; left:0px; z-index:100;"/>
                    <div style="position: fixed; left:50%; top:50%; background-color: white; border: 2px solid gray; padding: 2px; z-index: 200;">
                        <span><img class="waitingImage" src="/img/loading.gif" title="Please Wait..." /> Processing . . . </span>
                    </div>
                    </apex:facet>
                    <apex:facet name="stop" />
                </apex:actionStatus>
            </apex:outputPanel>

            <apex:pageBlockSection id="skillWS_Alt1_Header" title="Active Skill Worksheets" columns="1" collapsible="true">

                <apex:pageblockTable value="{!SkillWorksheets}" var="skillWorksheet" rendered="{!(SkillWorksheets.size>0)}" headerClass="tbl-header" rowClasses="tmn-row-odd, tmn-row-even" >

                    <apex:column headerValue="Action" styleClass="editcol"><a href="/apex/WeeklySkillTracking?id={!skillWorksheet.Id}">Edit</a>
                    </apex:column>
                    <apex:column styleClass="datecol" headerValue="Start Date">
                        <a href="/apex/WeeklySkillTracking?id={!skillWorksheet.Id}">Week of&nbsp;<apex:outputField value="{!skillWorksheet.start_date__c }"/></a>
                    </apex:column>
                    <apex:column headerValue="Action Plan Name">
                        <apex:outputLink value="/{!skillWorksheet.Action_Plan__c}">
                            <apex:outputField value="{!skillWorksheet.Action_plan__r.name}" /></apex:outputLink>
                    </apex:column>

                </apex:pageblockTable>
                <apex:outputText value="No worksheets to display" rendered="{!(SkillWorksheets.size=0)}" />

            </apex:pageBlockSection>
        </apex:pageBlock>
        <!--  BehaviorWorksheet section -->
        <a name="BehaviorWorksheet" id="BehaviorWorksheetAnchor"></a>
        <apex:pageBlock id="BehaviorWorksheet" mode="maindetail" rendered="{! showWorksheetBlocks && vfVarCanAccessWS}">
            <apex:pageBlockButtons location="top">
                <div class="blockbtns">
                    <apex:outputPanel layout="panel" onclick="j$('[id *=newbwsbtn]').toggle();" styleclass="btn">New Behavior Worksheet</apex:outputPanel>
                </div>
            </apex:pageBlockButtons>
            <apex:outputPanel id="newbwsbtn" layout="block" style="display: none; border: 1px solid black;width:600px;-webkit-columns:120px 4;columns:150px 4">
                <apex:repeat value="{!BehaviorMonthsAvailable}" var="week">
                    <apex:commandLink action="{!newBehaviorWorksheet}" value="{!week.UserDate}" rerender="none" status="{!$Component.BehaviorWorksheet.behaviorworksheetStatus}">
                        <apex:param assignTo="{!worksheetStartDate}" value="{!week.ParsableDate}" name="week" />
                    </apex:commandLink>
                    <br/>
                </apex:repeat>
                <apex:actionStatus id="behaviorworksheetStatus" >
                    <apex:facet name="start">
                    <div style="opacity:0.8; background-color:#ccc; position:fixed; width:100%; height:100%; top:0px; left:0px; z-index:100;"/>
                    <div style="position: fixed; left:50%; top:50%; background-color: white; border: 2px solid gray; padding: 2px; z-index: 200;">
                        <span><img class="waitingImage" src="/img/loading.gif" title="Please Wait..." /> Processing . . . </span>
                    </div>
                    </apex:facet>
                    <apex:facet name="stop" />
                </apex:actionStatus>
            </apex:outputPanel>
            <apex:pageBlockSection id="behWS_Alt1_Header" title="Active Behavior Worksheets" columns="1" collapsible="true">

                <apex:pageblockTable value="{!BehaviorWorksheets}" var="behaviorWorksheet" rendered="{!(BehaviorWorksheets.size>0)}" headerClass="tbl-header" rowClasses="tmn-row-odd, tmn-row-even" >

                    <apex:column headerValue="Action" styleClass="editcol"><a href="/apex/BehaviorTracking?id={!behaviorWorksheet.Id}">Edit</a>
                    </apex:column>
                    <apex:column styleClass="datecol" headerValue="Start Date">
                        <a href="/apex/BehaviorTracking?id={!behaviorWorksheet.Id}">
                            <apex:outputField value="{!behaviorWorksheet.start_date__c }" />
                        </a>
                    </apex:column>
                    <apex:column headerValue="Action Plan Name">
                        <apex:outputLink value="/{!behaviorWorksheet.Action_Plan__c}">
                            <apex:outputField value="{!behaviorWorksheet.Action_plan__r.name}" /></apex:outputLink>
                    </apex:column>

                </apex:pageblockTable>
                <apex:outputText value="No worksheets to display" rendered="{!(BehaviorWorksheets.size=0)}" />

            </apex:pageBlockSection>
        </apex:pageBlock>

        <a id="shiftSummaries" />
    <apex:pageBlock mode="maindetail" rendered="{!AND(OR(vfVarIsRW, vfVarIsCM, isLudlow), $ObjectType.Action_Summary__c.accessible)}" >
        <apex:pageBlockButtons location="top" rendered="{! !RWL1}">
            <div class="blockbtns">
                <input type="button" class="btn" value="New Action Plan Summary" onclick="window.open('/apex/ActionPlanSummaryNew?saID={!Service_Assignment__c.id}', '_self'); return false;" />
            </div>
        </apex:pageBlockButtons>
        <apex:pageBlockSection id="summary_Alt1_Header" title="Action Plan Summaries" collapsible="true" columns="1">
            <!-- <apex:relatedList list="Action_Summaries__r" /> -->
            <apex:pageBlockTable value="{!Service_Assignment__c.Action_Summaries__r}" var="summary" headerClass="tbl-header" rowClasses="tmn-row-odd, tmn-row-even" >
                <apex:column headerValue="Action" width="70px"><a href="/{!summary.ID}">Edit</a></apex:column>
                <apex:column headerValue="Name"><a href="/{!summary.ID}">{!summary.name}</a></apex:column>
                <apex:column value="{!summary.Status__c}"></apex:column>
                <apex:column value="{!summary.CreatedDate}"></apex:column>
            </apex:pageBlockTable>
        </apex:pageBlockSection>
    </apex:pageBlock>

        <a id="smokingAssessment"></a>
        <apex:pageBlock mode="maindetail" rendered="{! vfVarIsRW && isLudlow && (Service_Assignment__c.Admission__r.State__c =='IA' || Service_Assignment__c.Admission__r.State__c =='MN' || Service_Assignment__c.Admission__r.State__c =='IN')}">
            <apex:pageBlockButtons location="top">
                <div class="blockbtns">
                    <apex:outputLink styleClass="btn" value="/apex/Assessment_Smoking_Form?SAid={!Service_Assignment__c.Id}" rendered="{! SmokingAssessments.size == 0 && $ObjectType.Evaluation__c.createable}">New Smoking Assessment</apex:outputLink>
                </div>
            </apex:pageBlockButtons>
            <apex:pageBlockSection id="resAssess_Alt1_Header" title="Smoking Assessment" collapsible="true" columns="1">
                <apex:pageBlockTable styleclass="pcBody-list" value="{!SmokingAssessments}" var="evs"  id="smokingAssess" headerClass="tbl-header" rowClasses="tmn-row-odd, tmn-row-even"  rendered="{! SmokingAssessments.size != 0}" >
                        <apex:column width="50px">
                             <apex:facet name="header">Action</apex:facet>
                            <apex:outputLink value="/apex/Assessment_Smoking_Form?id={!evs.Id}">Edit</apex:outputLink>
                        </apex:column>
                        <apex:column >
                             <apex:facet name="header">Name</apex:facet>
                            <apex:outputLink value="/apex/Assessment_Smoking_Form?id={!evs.Id}">{!evs.Name}</apex:outputLink>
                        </apex:column>
                        <apex:column >
                             <apex:facet name="header">Status</apex:facet>
                             <apex:outputText >{!evs.Status__c}</apex:outputText>
                        </apex:column>
                        <apex:column >
                             <apex:facet name="header">Last Modified Date</apex:facet>
                             <c:MilitaryDatetime dateTimeVal="{!evs.lastmodifiedDate}" />
                        </apex:column>
                </apex:pageBlockTable>

                <apex:outputText value="No assessments to display" rendered="{!(SmokingAssessments.size=0)}" />
            </apex:pageBlockSection>
        </apex:pageBlock>
        <a id="residentAssessment"></a>
        <apex:pageBlock mode="maindetail" rendered="{!(vfVarIsCM && !isLudlow) && $Setup.SystemSettings__c.Referral_ConvertCMEnabled__c}" id="residentAssessmentShiftDocBlock">
            <apex:pageBlockButtons location="top">
                <div class="blockbtns">
                    <apex:CommandButton value="Add Resident Assessment" rendered="{! AND(Service_Assignment__c.Status__c != 'Inactive', showResAsmt, canAddShiftDoc)}" action="{!addResAsmt}" status="AddResidentAssessmentStatus" rerender="none,msgs" id="residentAsmtButton" />
                        <apex:actionStatus id="AddResidentAssessmentStatus" >
                            <apex:facet name="start">
                                <div style="opacity:0.8; background-color:#ccc; position:fixed; width:100%; height:100%; top:0px; left:0px; z-index:100;"/>
                                <div style="position: fixed; left:50%; top:50%; background-color: white; border: 2px solid gray; padding: 2px; z-index: 200;">
                                    <span><img class="waitingImage" src="/img/loading.gif" title="Please Wait..." /> Processing . . . </span>
                                </div>
                            </apex:facet>
                            <apex:facet name="stop" />
                        </apex:actionStatus>
                </div>
            </apex:pageBlockButtons>
            <apex:pageBlockSection id="resAssess_Alt1_Header" title="Resident Assessment" collapsible="true" columns="1">
                <apex:pageBlockTable styleclass="pcBody-list" value="{!residentAssessments}" var="evs"  rendered="{!residentAssessments.size > 0}" id="evaluations" headerClass="tbl-header" rowClasses="tmn-row-odd, tmn-row-even" >
                        <apex:column >
                             <apex:facet name="header">Action</apex:facet>
                            <apex:outputLink value="/apex/EvaluationEdit?id={!evs.Id}" rendered="{!!evs.Is_Signed__c && canAddShiftDoc}">Edit</apex:outputLink>
                        </apex:column>
                        <apex:column >
                             <apex:facet name="header">Name</apex:facet>
                            <apex:outputLink value="/apex/EvaluationView?id={!evs.Id}">{!evs.Name}</apex:outputLink>
                        </apex:column>
                        <apex:column >
                             <apex:facet name="header">Status</apex:facet>
                             <apex:outputText >{!evs.Status__c}</apex:outputText>
                        </apex:column>
                        <apex:column headerValue="Signed At" >
                            <apex:outputfield value=" {!evs.Signed_At__c}" />
                        </apex:column>
                        <apex:column value="{!evs.Owner.Name}" headerValue="Owner Name"/>
                        <apex:column headerValue="Last Modified" value="{!evs.LastModifiedDate}" />
                </apex:pageBlockTable>
                <apex:outputText value="No records to display"  rendered="{!residentAssessments.size=0 || residentAssessments == null}"/>
                <apex:outputPanel rendered="{!residentAssessments.size > 0}" >Showing 5 most recent Records. Click <a href="/apex/CMShiftAssessmentListView?saId={!Service_Assignment__c.Id}&recType=Residential" style="color: blue;">here</a>&nbsp;to view all</apex:outputPanel>
            </apex:pageBlockSection>
        </apex:pageBlock>

        <a name="ShiftAssessments" id="ShiftAssessments"></a>
        <apex:pageBlock mode="maindetail" rendered="{! (vfVarIsCM && !isLudlow) && $Setup.SystemSettings__c.Referral_ConvertCMEnabled__c}" id="residentAssessmentShiftDocBlock2">
            <apex:pageBlockButtons location="top">
                <div class="blockbtns">
                    <apex:commandButton value="Add Nurses Shift Documentation" onclick="showAddShiftDoc1(); return false;" status="AddShiftDocStatus" reRender="msgs,none" rendered="{!AND(Service_Assignment__c.Status__c != 'Inactive', canAddShiftDoc) }" />
                    <apex:actionStatus id="AddShiftDocStatus">
                        <apex:facet name="start">
                            <div style="opacity:0.8; background-color:#ccc; position:fixed; width:100%; height:100%; top:0px; left:0px; z-index:100;"/>
                            <div style="position: fixed; left:50%; top:50%; background-color: white; border: 2px solid gray; padding: 2px; z-index: 200;">
                                <span><img class="waitingImage" src="/img/loading.gif" title="Please Wait..." /> Processing . . . </span>
                            </div>
                        </apex:facet>
                        <apex:facet name="stop" />
                    </apex:actionStatus>
                </div>
            </apex:pageBlockButtons>
            <apex:pageBlockSection id="shiftAssess_Alt1_Header" title="Nurses Shift Documentation" collapsible="true" columns="1">
                <apex:pageBlockTable styleclass="pcBody-list" value="{!shiftAssessments}" var="evs" rendered="{!shiftAssessments.size > 0}" id="evaluations2" headerClass="tbl-header" rowClasses="tmn-row-odd, tmn-row-even" >
                    <apex:column headerValue="Action"><apex:outputLink value="/apex/EvaluationEdit?id={!evs.Id}" rendered="{!!evs.Is_Signed__c && canADdShiftDoc}">Edit</apex:outputLink>
                    </apex:column>
                    <apex:column headerValue="Name">
                        <apex:outputLink value="/apex/EvaluationView?id={!evs.Id}">{!evs.Name}</apex:outputLink>
                    </apex:column>
                    <apex:column headerValue="Shift Start Time" >
                        <c:MilitaryDatetime dateTimeVal="{!evs.Shift_Start_Time__c}" />
                    </apex:column>
                    <apex:column headerValue="Shift End Time" >
                        <c:MilitaryDatetime dateTimeVal="{!evs.Shift_End_Time__c}" />
                    </apex:column>
                    <apex:column headerValue="Head to Toe Status">
                        <apex:outputText value="{!evs.Head_to_Toe_Status__c}" />
                    </apex:column>
                    <apex:column headerValue="Signed At" >
                        <apex:outputfield value=" {!evs.Head_to_Toe_Signed_At__c}" />
                    </apex:column>
                    <apex:column headerValue="Shift Status">
                        <apex:outputText value="{!evs.Status__c}" />
                    </apex:column>
                    <apex:column headerValue="Signed At">
                        <apex:outputfield value=" {!evs.Signed_At__c}" />
                    </apex:column>
                    <apex:column value="{!evs.Owner.Name}" headerValue="Owner Name"/>
                    <apex:column headerValue="Last Modified" value="{!evs.LastModifiedDate}" />
                </apex:pageBlockTable>
                <apex:outputText value="No records to display" rendered="{!shiftAssessments.size=0 || shiftAssessments == null}" />
                <apex:outputPanel rendered="{!shiftAssessments.size>0}">Showing 5 most recent Records. Click <a href="/apex/CMShiftAssessmentListView?saId={!Service_Assignment__c.Id}&recType=Nurses Shift Documentation" style="color: blue;">here</a>&nbsp;to view all</apex:outputPanel>
            </apex:pageBlockSection>
        </apex:pageBlock>
        <apex:pageBlock mode="maindetail" rendered="{!(vfVarIsCM && !isLudlow) && $Setup.SystemSettings__c.Referral_ConvertCMEnabled__c}" id="CNABlock">
            <apex:pageBlockButtons location="top">
                <div class="blockbtns">
                    <apex:commandButton value="Add CNA Workbook" onclick="showAddShiftDoc2(); return false;" status="AddCNAStatus" reRender="msgs,none" rendered="{!AND(Service_Assignment__c.Status__c != 'Inactive', canAddCNA)}" />
                    <apex:actionStatus id="AddCNAStatus">
                        <apex:facet name="start">
                            <div style="opacity:0.8; background-color:#ccc; position:fixed; width:100%; height:100%; top:0px; left:0px; z-index:100;"/>
                            <div style="position: fixed; left:50%; top:50%; background-color: white; border: 2px solid gray; padding: 2px; z-index: 200;">
                                <span><img class="waitingImage" src="/img/loading.gif" title="Please Wait..." /> Processing . . . </span>
                            </div>
                        </apex:facet>
                        <apex:facet name="stop" />
                    </apex:actionStatus>
                </div>
            </apex:pageBlockButtons>
            <apex:pageBlockSection id="cnaWB_Alt1_Header" title="CNA Workbooks" collapsible="true" columns="1">
                <apex:pageBlockTable styleclass="pcBody-list" value="{!cnaWorkbooks}" var="evs" rendered="{!cnaWorkbooks.size > 0}" id="evaluationscna" headerClass="tbl-header" rowClasses="tmn-row-odd, tmn-row-even" >
                    <apex:column headerValue="Action"><apex:outputLink value="/apex/EvaluationEdit?id={!evs.Id}" rendered="{!!evs.Is_Signed__c && canAddCNA}">Edit</apex:outputLink>
                    </apex:column>
                    <apex:column headerValue="Name">
                        <apex:outputLink value="/apex/EvaluationView?id={!evs.Id}">{!evs.Name}</apex:outputLink>
                    </apex:column>
                    <apex:column headerValue="Shift Start Time" >
                        <c:MilitaryDatetime dateTimeVal="{!evs.Shift_Start_Time__c}" />
                    </apex:column>
                    <apex:column headerValue="Shift End Time" >
                        <c:MilitaryDatetime dateTimeVal="{!evs.Shift_End_Time__c}" />
                    </apex:column>
                    <apex:column headerValue="Status">
                        <apex:outputText value="{!evs.Status__c}" />
                    </apex:column>
                    <apex:column headerValue="Signed At" >
                        <apex:outputfield value=" {!evs.Signed_At__c}" />
                    </apex:column>
                    <apex:column value="{!evs.Owner.Name}" headerValue="Owner Name"/>
                    <apex:column headerValue="Last Modified" value="{!evs.LastModifiedDate}" />
                </apex:pageBlockTable>
                <apex:outputText value="No records to display" rendered="{!cnaWorkbooks== null || cnaWorkbooks.size=0 }" />
                <apex:outputPanel rendered="{!cnaWorkbooks.size>0}">Showing 5 most recent records. Click <a href="/apex/CMShiftAssessmentListView?saId={!Service_Assignment__c.Id}&recType=CNA Workbook" style="color: blue;">here</a>&nbsp;to view all </apex:outputPanel>
            </apex:pageBlockSection>
        </apex:pageBlock>

        <!--  Time Log section - IADAY-10 -->

        <a name="TimeLog" id="TimeLog"></a>
        <apex:pageBlock id="TimeLog" mode="maindetail" rendered="{! AND(OperatingGroup == 'Redwood',BEGINS($UserRole.DeveloperName, 'IA'))}">
                <div class="tmn-h1">Time Log Entries</div>
                
                <c:EvaluationResponseTable saParentId="{!Service_Assignment__c.Id}"
                                           type="Time Log"
                                           formId="{!$Component.myFRM}"
                                           uniqueId="Time_Log"
                                           cols="2"
                                           rows="10"
                                           showtitle="false"
                                           showDisregard="true"
                                           eSign="false"
                                           finalize="true"
                                           addEnabled="true"
                                           editEnabled="true"
                                           customLabels="[{&quot;field&quot;:&quot;TMN_User__c&quot;, &quot;label&quot;:&quot;Accompanied By&quot;}]" />

            <apex:outputPanel >Showing the 10 most recent entries. Click&nbsp;<apex:outputLink value="/apex/EvalResp_ShowAllList?PBS={!theServAssign.Person_Being_Served__c}&SA={!Service_Assignment__c.Id}&FS=Time Log" >here</apex:outputLink>&nbsp;to view all</apex:outputPanel>
            </apex:pageBlock>



        <!--  end time log section  -->

        <a name="caseManagementNotes" id="caseManagementNotes"></a>
        <apex:pageBlock id="CaseManagementNotes" mode="maindetail" rendered="{!OperatingGroup == 'Care Meridian'}">
            <div class="pbHeaderButton">
                <apex:commandButton onclick="window.open('/apex/Notes_Case_Management?saId={!Service_Assignment__c.id}', '_self'); return false;" value="New Case Management Note" rendered="{!canCreateCaseManagementNote}" />
            </div>
            <apex:pageBlockSection columns="1" title="Case Management Notes" id="casenotes_Alt1_Header" collapsible="true">
                <apex:pageblockTable value="{!caseManagementNotes}" var="note" rendered="{!(caseManagementNotes != null && caseManagementNotes.size>0)}">
                    <apex:column headerValue="Name">
                        <apex:outputLink value="/apex/Notes_Case_Management?id={!note.id}">
                            <apex:outputField value="{!note.name}" />
                        </apex:outputLink>
                    </apex:column>
                    <apex:column value="{!note.CreatedDate }" />
                    <apex:column value="{!note.Status__c }" />
                    <apex:column headerValue="Owner">
                        <a href="/{!note.CreatedBy.Id}">{!note.CreatedBy.Name}</a>
                    </apex:column>
                </apex:pageblockTable>
                <apex:outputText value="No notes to display" rendered="{!caseManagementNotes.size=0}" />
                <apex:outputPanel rendered="{!caseManagementNotes.size!=0}">
                    Showing the 10 most recent notes click <a href="/apex/Notes_Case_Management_List?saId={!Service_Assignment__c.id}" style="color: blue; ">here</a>&nbsp;to view all
                </apex:outputpanel>
            </apex:pageBlockSection>
        </apex:pageBlock>

        <!--  Notes section -->
        <a name="Notes" id="Notes"></a>
        <apex:pageBlock id="Notes" mode="maindetail" rendered="{!!isADH}" >
            <apex:pageBlockButtons location="top">
                <div class="blockbtns">
                    <!--  <apex:commandButton action="{!NewNote}" value="New Note" />-->
                    <apex:commandButton onclick="window.open('/apex/ActionPlan_GoalObjective_rpt?ID={!Service_Assignment__c.id}', '_self'); return false;" rendered="{! notes.size!=0 && !(vfVarIsCB || isNR || (vfVarIsCM && !isLudlow))}" value="Goal/Objective Documentation" />
                    <apex:commandButton rendered="{!ActivePlan.size = 1  && (!vfVarIsCM || isLudlow) && canCreateNote}" value="New Note" onclick="window.open('{!$Page.Notes_ProgressNote_Create}?plan={!ActivePlan[0].id}&service_assignment={!Service_Assignment__c}&admission={!Service_Assignment__c.Admission__c}&person={!Service_Assignment__c.Admission__r.Person_Being_Served__c}&state={!Service_Assignment__c.Admission__r.State__c}&retURL={!$CurrentPage.URL}', '_self'); return false;" />
                    <apex:commandButton rendered="{! ((vfVarIsCM && !isLudlow) || isNR) && canCreateNote}" value="New Note" onclick="window.open('{!$Page.Notes_ProgressNote_Create}?service_assignment={!Service_Assignment__c}&admission={!Service_Assignment__c.Admission__c}&person={!Service_Assignment__c.Admission__r.Person_Being_Served__c}&state={!Service_Assignment__c.Admission__r.State__c}&retURL={!$CurrentPage.URL}', '_self'); return false;" />
                </div>
            </apex:pageBlockButtons>
            <apex:pageBlockSection id="notes_Alt1_Header" title="Notes" collapsible="true" columns="1">
                <apex:pageblockTable value="{!notes}" var="note" rendered="{!(notes != null && notes.size>0)}" headerClass="tbl-header" rowClasses="tmn-row-odd, tmn-row-even" >

                    <apex:column headerValue="Action" styleClass="editcol" rendered="{!!((vfVarIsCM && !isLudlow) || isNR)}"><a href="/{!note.ID}/e">Edit</a>
                    </apex:column>
                    <apex:column headerValue="Action" styleClass="editcol" rendered="{!isNR}">
                    <apex:outputPanel id="test" rendered="{!!note.Locked__c || note.Status__c!='Final'}">
                    <a href="/apex/Notes_Progressnote_therapy?id={!note.ID}&Mode=Inlineedit">Edit</a>
                    </apex:outputPanel>
                    </apex:column>
                    <apex:column headerValue="Name">
                        <apex:outputLink value="/{!note.id}">
                            <apex:outputField value="{!note.name}" /></apex:outputLink>
                    </apex:column>
                    <apex:column headerValue="Action Plan" rendered="{!(!vfVarIsCM || isLudlow)}">
                        <apex:outputLink value="/{!note.Action_Plan__c}">{!note.action_plan__r.name }</apex:outputLink>
                    </apex:column>
                    <apex:column value="{!note.Start_time__c }" rendered="{! (!vfVarIsCM ||isLudlow) }"/>
                    <apex:column value="{!note.End_Time__c }" rendered="{! (!vfVarIsCM || isLudlow) }"/>
            <apex:column value="{!note.Clinician__c}" rendered="{! (vfVarIsCB || isCAFSS) && (Service_Assignment__c.Admission__r.State__c == 'MD' || Service_Assignment__c.Admission__r.State__c == 'MA')}" />
                    <apex:column value="{!note.createddate }" />
                    <apex:column value="{!note.createdby.name }" />
                </apex:pageblockTable>
                <apex:outputText value="No notes to display" rendered="{!(notes.size=0)}" />
                <apex:outputPanel rendered="{!notes.size!=0 && ($Setup.SystemSettings__c.AZ_OPT_Enabler__c == False || ($Setup.SystemSettings__c.AZ_OPT_Enabler__c && OperatingGroup != 'Redwood'))}">Showing the 10 most recent notes click&nbsp;
                    <apex:outputLink value="/a0L?id={!Service_Assignment__c.id}&rlid=00NU00000036mQ0&lsr=0">here</apex:outputLink>&nbsp;to view all</apex:outputpanel>
                <apex:outputPanel rendered="{!notes.size!=0 && $Setup.SystemSettings__c.AZ_OPT_Enabler__c && OperatingGroup == 'Redwood'}" >Showing the 10 most recent notes click&nbsp;
                    <apex:outputLink value="/apex/Progress_Notes_Log?saID={!theServAssign}&saname={!theServAssign.Name}&admission={!theServAssign.Admission__c}&pbsID={!theServAssign.Person_Being_Served__c}">here</apex:outputLink>&nbsp;to view all</apex:outputpanel>
            </apex:pageBlockSection>
        </apex:pageBlock>

        <!-- Start FAD Assessments -->
        <a name="Assessments_fad" id="assess_fad"></a>
        <apex:pageBlock id="Assessments_FAD" mode="maindetail" rendered="{! Service_Assignment__c.Program__c ='IFCS' }">
            <apex:pageBlockButtons location="top">
                <div class="blockbtns">
                    <!--  <apex:commandButton action="{!NewNote}" value="New Note" />-->
                    <apex:commandButton action="{!createFadAssess}" value="New FAD Assessment Summary" />
                </div>
            </apex:pageBlockButtons>
            <apex:pageBlockSection id="fad_Alt1_Header" title="FAD Assessment Summaries" collapsible="true" columns="1">
                <apex:outputText value="No FAD Assessment Summaries to display" rendered="{!(Assessments_Fad.size=0)}" />
                <apex:pageBlockTable value="{!Assessments_Fad}" var="assess" rendered="{!(Assessments_Fad.size!=0)}" headerClass="tbl-header" rowClasses="tmn-row-odd, tmn-row-even" >
                    <apex:column headerValue="Action" styleClass="editcol">
                        <a href="/apex/Assessment_FAD_Form?id={!assess.ID}&edit=1">Edit</a>
                    </apex:column>
                    <apex:column headerValue="Name">
                        <a href="/apex/Assessment_FAD_Form?id={!assess.ID}">{!assess.name}</a>
                    </apex:column>
                    <apex:column value="{!Assess.Assessment_Date__c}" headerValue="Date of Admistration" />
                    <apex:column value="{!Assess.Phase__c}" />
                    <apex:column value="{!Assess.Status__c}" />
                    <apex:column value="{!Assess.Disregard__c }" />
                </apex:pageBlockTable>
            </apex:pageBlockSection>
        </apex:pageBlock>
        <!-- end FAD Assessments -->

        <!-- Incidents Section -->
        <a name="Incidents" id="incidents"></a>
        <apex:pageblock id="incidentsBlock" mode="maindetail" rendered="false">
            <apex:pageBlockButtons location="top">
                <div class="blockbtns" rendered="{!$ObjectType.Incident__c.createable}">
                    <apex:commandButton value="Create Incident" action="{!createIncident}" status="fundingSouceModalStatus" rerender="none"/>
                </div>
            </apex:pageBlockButtons>
            <apex:pageBlockSection id="Inc_Alt1_Header" title="Incidents" collapsible="true" columns="1">
                <apex:outputText value="No Incidents to display" rendered="{!(incidents.size=0)}" />
                <apex:pageblockTable value="{!incidents}" var="i" rendered="{!(incidents.size!=0)}" headerClass="tbl-header" rowClasses="tmn-row-odd, tmn-row-even" >
                    <apex:column headerValue="Action" rendered="{!$ObjectType.Incident__c.updateable}">
                        <a href="/apex/Incident_Form_CreateEdit?Id={!i.Id}">Edit</a>
                    </apex:column>
                    <apex:column headerValue="Incident Number" >
                            <a href="/{!i.id}" >{!i.Name}</a>
                    </apex:column>
                    <apex:column value="{!i.Recordtype.Name}" headerValue="Incident Type"/>
                </apex:pageblockTable>
            </apex:pageBlockSection>
        </apex:pageblock>

        <!-- End Incidents Section -->


        <!--  Funding Sources section -->
        <!-- Add Funding Source modal. -->
        <apex:outputPanel id="FundingSourceModal" style="display:none">
            <script>
              jQuery(document).ready(function ($) {
                  setUpFields();
                });   //end "

            </script>
            <div id='fundingMessages'></div>
            <apex:pageBlock title="Add Funding Source" mode="maindetail" rendered="{!fundingSourceRecordType != 'CareMeridian' && fundingSourceRecordType != 'Adult Day Health' && fundingSourceRecordType != 'NeuroRestorative' && fundingSourceRecordType != null}">
                <apex:pageBlockSection columns="1" id="fundingSourceEntry">
                    <apex:inputField value="{!fundingSource.Funding_Source__c}" id="fundingEntry_Source" />
                    <apex:inputField value="{!fundingSource.Funding_Source_ID__c}" id="fundingEntry_SourceId" />
                    <apex:inputField value="{!fundingSource.Service_Being_Funded__c}" id="fundingEntry_Service" rendered="{!fundingSourceRecordType!='CareMeridian'}" />
                    <apex:inputField value="{!fundingSource.Payor__c}" id="fundingEntry_Payor" rendered="{!fundingSourceRecordType=='CareMeridian'}" />
                    <apex:inputField value="{!fundingSource.Status__c}" id="fundingEntry_Status" />
                    <apex:inputField value="{!fundingSource.Comment__c}" id="fundingEntry_comment" />
                    <apex:inputHidden value="{!fundingSource.Id}" id="fundingEntry_Id" />
                </apex:pageBlockSection>
            </apex:pageBlock>
            <apex:pageBlock title="Payer Detail" id="fundingSourcePayerDetailEntry" mode="maindetail" rendered="{!fundingSourceRecordType == 'CareMeridian' || fundingSourceRecordType == 'NeuroRestorative' || fundingSourceRecordType == 'Adult Day Health'}">
                <apex:pageBlockSection columns="2" rendered="{!fundingSourceRecordType == 'CareMeridian'}">
                    <apex:outputField value="{!theServAssign.Person_Being_Served__r.Name}" />
                    <!-- <apex:outputField value="{!personBeingRefRecord.Date_of_Birth__c}" /> -->
                    <apex:outputText label="Date of Birth" value="{0, date, MM/dd/yyyy} ({!age})">
                        <apex:param value="{!theServAssign.Person_Being_Served__r.Birthdate}" />
                    </apex:outputText>
                    <apex:inputField value="{!fundingSource.Type_of_Coverage__c}" />
                    <apex:inputField id="contractused" value="{!fundingSource.CM_Contract_Used_Lookup__c}" />
                    <apex:inputField value="{!fundingSource.Payer_Name__c}" />
                    <apex:inputField value="{!fundingSource.Payer_Phone__c}" />
                    <apex:inputField value="{!fundingSource.TPA__c}" />
                    <apex:inputField value="{!fundingSource.TPA_Phone__c}" />
                    <apex:inputField value="{!fundingSource.Primary_Med_Ind_Phys_Group__c}" />
                    <apex:inputField value="{!fundingSource.Primary_Med_Ind_Phys_Group_Phone__c}" />
                    <apex:inputField value="{!fundingSource.Network__c}" />
                    <apex:inputField value="{!fundingSource.Network_Phone__c}" />
                    <apex:inputField value="{!fundingSource.Verified_By__c}" />
                    <apex:inputField value="{!fundingSource.Payer_Verification_Date__c}" />
                    <apex:inputField value="{!fundingSource.Verified_With__c}" />
                    <apex:inputField value="{!fundingSource.Representing__c}" />
                    <apex:inputField value="{!fundingSource.Funding_Source__c}" label="Payer Type" />
                    <apex:inputField value="{!fundingSource.Call_Reference_Number__c}" />
                    <apex:inputField value="{!fundingSource.Policy_Type__c}" />
                    <apex:inputField value="{!fundingSource.Policy_Number__c}" />
                    <apex:inputField value="{!fundingSource.Group_Name__c}" />
                    <apex:inputField value="{!fundingSource.Group_Number__c}" />
                    <apex:inputField value="{!fundingSource.Policy_Holder__c}" />
                    <apex:inputField value="{!fundingSource.Relationship_To_Patient__c}" id="policyHolderRelationship" />
                </apex:pageBlockSection>

                <apex:pageBlockSection columns="2" rendered="{!fundingSourceRecordType == 'NeuroRestorative' || fundingSourceRecordType == 'Adult Day Health'}">
                    <apex:outputField value="{!fundingSource.Funding_Source_Status__c}"  />
                    <apex:pageBlockSectionItem />
                    <apex:outputField value="{!theServAssign.Person_Being_Served__r.Name}" />
                    <!-- <apex:outputField value="{!personBeingRefRecord.Date_of_Birth__c}" /> -->
                    <apex:outputText label="Date of Birth" value="{0, date, MM/dd/yyyy} ({!theServAssign.Person_Being_Served__r.Age__c})">
                        <apex:param value="{!theServAssign.Person_Being_Served__r.Birthdate}" />
                    </apex:outputText>
                    <apex:inputField value="{!fundingSource.Type_of_Coverage__c}" rendered="{!!hasPrimaryActiveFS}"/>
                    <apex:pageBlockSectionItem rendered="{!hasPrimaryActiveFS}" >
                        <apex:outputlabel value="Coverage level" styleClass="labelCol"/>
                        <apex:selectList value="{!fundingSource.Type_of_Coverage__c}" size="1" >
                            <apex:selectoptions value="{!fundingCoverageOptions}" />
                        </apex:selectList>
                    </apex:pageBlockSectionItem>
                    <apex:inputField value="{!fundingSource.Payer_Type__c}" id="neuroPayerType" html-data-rules="{&quot;VA - Pilot&quot;: [&quot;{!$Component.vaPilotClinicalNumber}&quot;]}" />
                    <apex:pageBlockSectionItem rendered="{!!isADH}"/>
                    <apex:inputField value="{!fundingSource.VA_Pilot_Clinical_Number__c}" id="vaPilotClinicalNumber" rendered="{!!isADH}"/>
                    <apex:inputField value="{!fundingSource.Payer_Name__c}" />
                    <apex:inputField value="{!fundingSource.Payer_Phone__c}" />
                    <apex:pageBlockSectionItem >
                        <apex:outputLabel for="policyHolder" value="Policy Holder" />
                        <apex:outputPanel >
                            <apex:inputField value="{!fundingSource.Policy_Holder__c}" id="policyHolder" />
                            <apex:commandLink value="Same as PBS" onclick="assignValue('{!$Component.policyHolder}', '{!theServAssign.Person_Being_Served__r.Name}'); return false;" />
                        </apex:outputPanel>
                    </apex:pageBlockSectionItem>
                    <apex:inputField value="{!fundingSource.Relationship_To_Patient__c}" />
        <!--
                    <apex:pageBlockSectionItem >
                        <apex:outputLabel for="insuredSSN" value="Insured SSN" />
                        <apex:outputPanel >
                            <apex:inputField value="{!fundingSource.Insured_SSN__c}" id="insuredSSN" />
                            <apex:commandLink value="Same as PBS" onclick="assignValue('{!$Component.insuredSSN}', '{!theServAssign.Person_Being_Served__r.SSN__c}'); return false;" />
                        </apex:outputPanel>
                    </apex:pageBlockSectionItem>
             -->
                    <apex:pageBlockSectionItem >
                        <apex:outputLabel for="insuredDOB" value="Insured DOB" />
                        <apex:outputPanel >
                            <apex:inputField value="{!fundingSource.Insured_DOB__c}" id="insuredDOB" />
                            <apex:commandLink value="Same as PBS" onclick="assignValue('{!$Component.insuredDOB}', '{!theServAssign.Person_Being_Served__r.Birthdate}'); return false;" />
                        </apex:outputPanel>
                    </apex:pageBlockSectionItem>
                    <apex:inputField value="{!fundingSource.Policy_Number__c}" />
                    <apex:inputField value="{!fundingSource.Group_Number__c}" />
                </apex:pageBlockSection>
                <apex:pageBlockSection columns="1" rendered="{!fundingSourceRecordType == 'CareMeridian'}">
                    <apex:inputField value="{!fundingSource.Additional_Coverage__c}" id="additionalCoverage" />
                    <apex:inputTextarea value="{!fundingSource.Additional_Coverage_Comments__c}" id="additionalCoverageDetail" label="" cols="80" />
                </apex:pageBlockSection>


                <apex:pageBlockSection columns="2" rendered="{!fundingSourceRecordType == 'CareMeridian' }">
                    <apex:outputText value="Benefit Information" styleClass="modalSubheader" />
                    <apex:pageBlockSectionItem />
                    <apex:inputField value="{!fundingSource.Effective_Date__c}" />
                    <apex:inputField value="{!fundingSource.Termination_Date__c}" id="fsTerminationDate" />
                    <apex:inputField value="{!fundingSource.Benefit_Cycle__c}" />
                    <apex:pageBlockSectionItem />
                    <apex:inputField value="{!fundingSource.Benefit_Year_Start_Date__c}" />
                    <apex:inputField value="{!fundingSource.Benefit_Year_End_Date__c}" />
                    <apex:inputField value="{!fundingSource.Deductible__c}" />
                    <apex:inputField value="{!fundingSource.Deductible_Met__c}" />
                    <apex:inputField value="{!fundingSource.Rate_of_Reimbursement__c}" />
                    <apex:inputField value="{!fundingSource.RoR_to_100_after_met_OOP_Max__c}" label="Rate of Reimbursement changes to 100% after OOP Max is met?" />
                    <apex:inputField value="{!fundingSource.OOP_Expense__c}" />
                    <apex:inputField value="{!fundingSource.OOP_Expense_Met__c}" />
                    <apex:inputField value="{!fundingSource.Deductible_Applicable_to_OOP__c}" />
                    <apex:pageBlockSectionItem />
                    <apex:inputField value="{!fundingSource.Lifetime_Max__c}" />
                    <apex:inputField value="{!fundingSource.Lifetime_Max_Met__c}" />


                    <apex:inputField value="{!fundingSource.Copay__c}" />
                    <apex:inputText value="{!fundingSource.Qualifying_Stay_Criteria__c}" />
                    <apex:inputField label="Day Total" value="{!fundingSource.SNF_Day_Total__c}" />
                    <apex:inputField label="Days Used" value="{!fundingSource.SNF_Days_Used__c}" />
                    <apex:inputField label="Precert Required" value="{!fundingSource.Precert_Required__c}" />
                    <apex:pageBlockSectionItem />
                    <apex:outputText value="Acute Rehab" styleClass="modalSubheader" />
                    <apex:pageBlockSectionItem />
                    <apex:inputField value="{!fundingSource.ARU_Day_Total__c}" />
                    <apex:inputField value="{!fundingSource.ARU_Days_Used__c}" />

                    <apex:outputText value="Home Health" styleClass="modalSubheader" />
                    <apex:pageBlockSectionItem />
                    <apex:inputField value="{!fundingSource.HH_Visits_Total__c}" />
                    <apex:inputField value="{!fundingSource.HH_Visits_Used__c}" />

                    <apex:outputText value="DME" styleClass="modalSubheader" />
                    <apex:pageBlockSectionItem />
                    <apex:inputText value="{!fundingSource.DME_Benefits__c}" />
                    <apex:inputField value="{!fundingSource.DME_Maximum__c}" />
                    <apex:inputField value="{!fundingSource.DME_Precert_Required__c}" />
                    <apex:pageBlockSectionItem />

                    <apex:outputText value="Transportation" styleClass="modalSubheader" />
                    <apex:pageBlockSectionItem />
                    <apex:inputText value="{!fundingSource.Transportation_Benefits__c}" />
                    <apex:inputField value="{!fundingSource.Transportation_Maximum__c}" />
                    <apex:inputField value="{!fundingSource.Transportation_Precert_Required__c}" />
                    <apex:pageBlockSectionItem />

                    <apex:inputField value="{!fundingSource.Precert_Company__c}" />
                    <apex:inputField value="{!fundingSource.SNF_Phone__c}" label="Precert Company Phone" />
                    <apex:inputField value="{!fundingSource.SNF_Fax__c}" label="Fax" />
                    <apex:pageBlockSectionItem />

                    <apex:outputText value="Claims Submission" styleClass="modalSubheader" />
                    <apex:pageBlockSectionItem />
                    <apex:inputField value="{!fundingSource.Claims_Submission_Company__c}" label="Company" />
                    <apex:pageBlockSectionItem />
                    <apex:inputField value="{!fundingSource.Claims_Submission_Street_1__c}" label="Street 1" />
                    <apex:inputField value="{!fundingSource.Claims_Submission_Phone__c}" label="Phone" />
                    <apex:inputField value="{!fundingSource.Claims_Submission_Street_2__c}" label="Street 2" />
                    <apex:inputField value="{!fundingSource.Claims_Submission_Email__c}" label="Email Address" id="claimsSubmissionEmail" />
                    <apex:inputField value="{!fundingSource.Claims_Submission_City__c}" label="City" />
                    <apex:inputField value="{!fundingSource.Claims_Submission_Fax__c}" label="Fax" />
                    <apex:inputField value="{!fundingSource.Claims_Submission_State__c}" label="State" />
                    <apex:pageBlockSectionItem />
                    <apex:inputField value="{!fundingSource.Claims_Submission_Zip__c}" id="Claims_Submission_Zip" label="Zip" />
                </apex:pageBlockSection>



                <apex:pageBlockSection columns="2" rendered="{!fundingSourceRecordType == 'NeuroRestorative'}">
                    <apex:outputText value="Benefit Information" styleClass="modalSubheader" />
                    <apex:pageBlockSectionItem />
                    <apex:inputField value="{!fundingSource.Benefit_Cycle__c}" />
                    <apex:pageBlockSectionItem />
                    <apex:inputField value="{!fundingSource.Effective_Date__c}" />
                    <apex:inputField value="{!fundingSource.Termination_Date__c}" />
                    <apex:inputField value="{!fundingSource.Copay__c}" />
                    <apex:pageBlockSectionItem />
                    <apex:inputField value="{!fundingSource.In_patient_Benefits_Limit__c}" />
                    <apex:inputField value="{!fundingSource.Out_patient_Visit_Limit__c}" />
                    <apex:inputField value="{!fundingSource.Deductible__c}" />
                    <apex:inputField value="{!fundingSource.Deductible_Met__c}" />
                    <apex:inputField value="{!fundingSource.Rate_of_Reimbursement__c}"  />
                    <apex:inputField value="{!fundingSource.RoR_to_100_after_met_OOP_Max__c}" label="Rate of Reimbursement changes to 100% after OOP Max is met?" />


                    <apex:inputField label="Day Total" value="{!fundingSource.SNF_Day_Total__c}" />
                    <apex:inputField label="Days Used" value="{!fundingSource.SNF_Days_Used__c}" />
                    <apex:pageBlockSectionItem />
                    <apex:inputField label="Precert Required" value="{!fundingSource.Precert_Required__c}" />
                    <apex:inputField value="{!fundingSource.Precert_Company__c}" />
                    <apex:inputField value="{!fundingSource.SNF_Phone__c}" label="Precert Company Phone" />
                    <apex:inputField value="{!fundingSource.SNF_Fax__c}" label="Fax" />
                    <apex:pageBlockSectionItem />

                    <apex:outputText value="Claims Submission" styleClass="modalSubheader" />
                    <apex:pageBlockSectionItem />
                    <apex:inputField value="{!fundingSource.Claims_Submission_Company__c}" label="Company" />
                    <apex:pageBlockSectionItem />
                    <apex:inputField value="{!fundingSource.Claims_Submission_Street_1__c}" label="Street 1" />
                    <apex:inputField value="{!fundingSource.Claims_Submission_Phone__c}" label="Phone" />
                    <apex:inputField value="{!fundingSource.Claims_Submission_Street_2__c}" label="Street 2" />
                    <apex:inputField value="{!fundingSource.Claims_Submission_Email__c}" label="Email Address" id="claimsSubmissionEmail" />
                    <apex:inputField value="{!fundingSource.Claims_Submission_City__c}" label="City" />
                    <apex:inputField value="{!fundingSource.Claims_Submission_Fax__c}" label="Fax" />
                    <apex:inputField value="{!fundingSource.Claims_Submission_State__c}" label="State" />
                    <apex:pageBlockSectionItem />
                    <apex:inputField value="{!fundingSource.Claims_Submission_Zip__c}" id="Claims_Submission_Zip" label="Zip" />
                </apex:pageBlockSection>
                <apex:pageBlockSection rendered="{!fundingSourceRecordType == 'Adult Day Health'}">
                     <apex:outputText value="Claims Submission" styleClass="modalSubheader" />
                    <apex:pageBlockSectionItem />
                    <apex:inputField value="{!fundingSource.Claims_Submission_Company__c}" label="Company" />
                    <apex:pageBlockSectionItem />
                    <apex:inputField value="{!fundingSource.Claims_Submission_Street_1__c}" label="Street 1" />
                    <apex:inputField value="{!fundingSource.Claims_Submission_Phone__c}" label="Phone" />
                    <apex:inputField value="{!fundingSource.Claims_Submission_Street_2__c}" label="Street 2" />
                    <apex:inputField value="{!fundingSource.Claims_Submission_Email__c}" label="Email Address" id="claimsSubmissionEmail" />
                    <apex:inputField value="{!fundingSource.Claims_Submission_City__c}" label="City" />
                    <apex:inputField value="{!fundingSource.Claims_Submission_Fax__c}" label="Fax" />
                    <apex:inputField value="{!fundingSource.Claims_Submission_State__c}" label="State" />
                    <apex:pageBlockSectionItem />
                    <apex:inputField value="{!fundingSource.Claims_Submission_Zip__c}" id="Claims_Submission_Zip" label="Zip" />                                                                 
                </apex:pageBlockSection>
            </apex:pageBlock>

            <apex:pageBlock title="Red Flags" id="fundingSourceRedFlagsEntry" mode="maindetail" rendered="{!fundingSourceRecordType == 'CareMeridian' || fundingSourceRecordType == 'NeuroRestorative'}">

                <apex:pageBlockSection columns="2" rendered="{!fundingSourceRecordType == 'CareMeridian'}">
                    <apex:inputField value="{!fundingSource.Month_to_Month__c}" id="field_validation1" />
                    <apex:inputField value="{!fundingSource.Basis__c}" id="field_check1" />
                    <apex:inputField value="{!fundingSource.Cobra__c}" id="field_validation2" />
                    <apex:inputField value="{!fundingSource.Payment_Detail__c}" id="field_check2" />
                    <apex:inputField value="{!fundingSource.Individual_Plan__c}" id="field_validation3" />
                    <apex:inputField value="{!fundingSource.Continued_Payment__c}" id="field_check3" />
                    <apex:inputField value="{!fundingSource.Under_Pre_Existing_Period__c}" id="field_validation4" />
                    <apex:inputField value="{!fundingSource.Dx_Pre_Existing__c}" id="field_check4" />
                    <apex:inputField value="{!fundingSource.Self_Inflicted__c}" id="field_validation5" />
                    <apex:inputField value="{!fundingSource.Covered__c}" id="field_check5" />
                    <apex:inputField value="{!fundingSource.Readmission__c}" id="field_validation6" />
                    <apex:inputField value="{!fundingSource.Prior_Pmt_Received__c}" id="field_check6" />
                    <apex:inputField value="{!fundingSource.Swing_Bed_Billing_at_SNF_Rate__c}" id="field_validation7" />
                    <apex:inputField value="{!fundingSource.Number_of_Days__c}" id="field_check7" />
                    <apex:inputField value="{!fundingSource.Medicare_is_Secondary_Coverage__c}" />
                    <apex:pageBlockSectionItem />
                    <apex:inputField value="{!fundingSource.Patient_Over_26_and_On_Parent_s_Policy__c}" />
                    <apex:inputField value="{!fundingSource.Coverage_Details__c}" />
                    <apex:inputField value="{!fundingSource.Is_patient_policy_holder__c}" />
                    <apex:inputField value="{!fundingSource.Can_Patient_Return_to_Work__c}" id="canPatientReturnToWork" label="If Yes, Can Patient Return to Work?" />
                    <apex:pageBlockSectionItem />
                    <apex:inputField value="{!fundingSource.Patient_Has_Policy__c}" id="patientHasPolicy" label="If No, Does Patient Have Policy?" />
                    <apex:pageBlockSectionItem />
                    <apex:inputField value="{!fundingSource.Does_PH_Plan_to_Continue_Working__c}" label="If No, Does PH Plan to Continue Working?" />

                    <apex:outputText >
                        <div class="modalSubheader">Medicare Eligibility
                            <c:HelpTooltip helpText="If any of the following check boxes are selected, patient is Medicare eligible." />
                        </div>
                    </apex:outputText>
                    <apex:pageBlockSectionItem />
                    <apex:inputField value="{!fundingSource.More_than_1_5_Yrs_of_Disability__c}" id="yearsOfDisability" />
                    <apex:pageBlockSectionItem />
                    <apex:inputField value="{!fundingSource.ALS_ESRD_Black_Lung_Disease__c}" />
                    <apex:pageBlockSectionItem />
                    <apex:inputField value="{!fundingSource.Patient_Over_64_Years_of_Age__c}" />

                    <apex:pageBlockSectionItem />
                </apex:pageBlockSection>


                <apex:pageBlockSection columns="2" rendered="{!fundingSourceRecordType == 'NeuroRestorative'}">
                    <apex:inputField value="{!fundingSource.Cobra__c}" id="field_validation20" />
                    <apex:inputField value="{!fundingSource.Payment_Detail__c}" id="field_check20" />
                    <apex:inputField value="{!fundingSource.Self_Inflicted__c}" id="field_validation21" />
                    <apex:inputField value="{!fundingSource.Covered__c}" id="field_check21" />
                    <apex:inputField value="{!fundingSource.Self_Insured_Policy__c}" />
                    <apex:pageBlockSectionItem />
                    <apex:inputField value="{!fundingSource.Did_drugs_alcohol_contribute_to_injury__c}" id="field_validation22" />
                    <apex:inputField value="{!fundingSource.Are_injuries_covered__c}" id="field_check22" />
                </apex:pageBlockSection>
                <apex:pageBlockSection columns="1" rendered="{!fundingSourceRecordType == 'CareMeridian'}">
                    <apex:inputTextArea value="{!fundingSource.Comment__c}" label="Additional Comments" cols="80" />
                </apex:pageBlockSection>
                <apex:pageBlockSection columns="1" rendered="{!fundingSourceRecordType == 'NeuroRestorative'}">
                    <apex:inputTextArea value="{!fundingSource.Comment__c}" label="Red Flag Comments" cols="80" />
                </apex:pageBlockSection>
            </apex:pageBlock>



            <apex:pageBlock id="fundingbuttonsBlock" mode="maindetail">
                <apex:pageblockButtons location="bottom" rendered="{!canEditFundingSource && fundingSourceRecordType != 'NeuroRestorative'}" >
                    <apex:commandButton id="saveFundingSource" value="Save" onclick="fundingSourceSave(true);return false;" />
                    <apex:commandButton id="saveAndNewFundingSource" value="Save & New" onclick="fundingSourceSave(false); return false;" />
                    <apex:commandButton value="Cancel" onclick="closeModalDialogSA('FundingSourceModal', 'span');j$('#fundingErrors').html('');return false;" />
                </apex:pageblockButtons>

                <apex:pageblockButtons location="bottom" rendered="{!canEditFundingSource && fundingSourceRecordType == 'NeuroRestorative'}" >
                    <apex:commandButton id="saveFundingSource" value="Save" onclick="fundingSourceSave(true);return false;" rendered="{!fundingSource.Funding_Source_Status__c != 'Active Final' && fundingSource.Funding_Source_Status__c != 'Inactive'}"/>
                    <apex:commandbutton id="finalizeFundingSource" value="Finalize" onClick="fundingSourceFinalize(); return false;" rendered="{!fundingSource.Funding_Source_Status__c != 'Active Final' && fundingSource.Funding_Source_Status__c != 'Inactive'}"/>
<!--                    <apex:commandButton id="saveAndNewFundingSource" value="Save & New" onclick="fundingSourceSave(false); return false;" rendered="{!fundingSource.Funding_Source_Status__c == 'Active'}"/> -->
                    <apex:commandbutton id="inactivateFundingSource" value="Inactivate" onClick="inactivateFunding(); return false;" rendered="{!fundingSource.Funding_Source_Status__c == 'Active' || fundingSource.Funding_Source_Status__c == 'Active Final'}" />
                    <apex:commandButton value="Cancel" onclick="closeModalDialogSA('FundingSourceModal', 'span');j$('#fundingErrors').html('');return false;" />
                </apex:pageblockButtons>
            </apex:pageBlock>
        </apex:outputPanel>

        <a id="Funding_Sources"></a>
        <apex:pageBlock id="fundingSources" mode="maindetail" rendered="{!( vfVarIsCM  || isNR || isADH) && !newSA && canViewFundingSource }">
            <apex:pageBlockButtons location="top">
                <div class="blockbtns">
                    <apex:commandButton value="Add Funding Source" onclick="showAddFundingSource(); return false;" rendered="{!canViewFundingSource}" />
                    <apex:actionStatus id="AddFundingSourceStatus">
                        <apex:facet name="start">
                            <apex:image height="16px" value="/img/loading32.gif" styleClass="dialogLoadingSpinner" />
                        </apex:facet>
                        <apex:facet name="stop" />
                    </apex:actionStatus>
                </div>
            </apex:pageBlockButtons>
            <apex:pageBlockSection id="fs_Alt1_Header" title="Funding Sources" collapsible="true" columns="1">
                <apex:outputText value="No Funding Sources to display" rendered="{!(fundingSources.size=0)}" />

                <apex:pageBlockTable value="{!fundingSources}" var="fundingSource" rendered="{!fundingSourceRecordType != 'CareMeridian' && fundingSourceRecordType != 'NeuroRestorative' && fundingSourceRecordType != 'Adult Day Health' && fundingSources.size!=0  && canEditFundingSource }" headerClass="tbl-header" rowClasses="tmn-row-odd, tmn-row-even" >
                    <apex:column headerValue="Action"><a href="#" onclick="loadFundingSource('{!fundingSource.Id}');return false; ">Edit</a>
                    </apex:column>
                    <apex:column value="{!fundingSource.Funding_Source__c}" />
                    <apex:column value="{!fundingSource.Funding_Source_ID__c}" />
                    <apex:column value="{!fundingSource.Service_Being_Funded__c}" rendered="{!fundingSourceRecordType!='CareMeridian'}" />
                    <apex:column value="{!fundingSource.Payor__c}" rendered="{!fundingSourceRecordType=='CareMeridian'}" />
                    <apex:column value="{!fundingSource.Status__c}" />
                    <apex:column value="{!fundingSource.Comment__c}" />
                    <apex:column value="{!fundingSource.CreatedDate}" />
                </apex:pageBlockTable>

                <apex:pageBlockTable value="{!fundingSources}" var="fundingSource" rendered="{!fundingSourceRecordType == 'CareMeridian' && fundingSources.size!=0 && canEditFundingSource }" headerClass="tbl-header" rowClasses="tmn-row-odd, tmn-row-even" >
                    <apex:column headerValue="Action"><a href="#" onclick="loadFundingSource('{!fundingSource.Id}');return false; ">Edit</a>
                    </apex:column>
                    <apex:column value="{!fundingSource.Type_of_Coverage__c}" />
                    <apex:column value="{!fundingSource.Payer_Name__c}" />
                    <apex:column value="{!fundingSource.Effective_Date__c}" />
                    <apex:column value="{!fundingSource.Termination_Date__c}" />
                    <apex:column value="{!fundingSource.Status__c}" />
                    <apex:column value="{!fundingSource.Comment__c}" />
                    <apex:column value="{!fundingSource.CreatedDate}" />
                </apex:pageBlockTable>

                <apex:pageBlockTable value="{!fundingSources}" var="fundingSource" rendered="{!(fundingSourceRecordType == 'NeuroRestorative' || fundingSourceRecordType == 'Adult Day Health') && fundingSources.size!=0 && canEditFundingSource }" headerClass="tbl-header" rowClasses="tmn-row-odd, tmn-row-even" >
                    <apex:column headerValue="Action" >
                        <apex:outputPanel rendered="{!fundingSource.Funding_Source_Status__c == 'Active'}" >
                            <a href="#" onclick="loadFundingSource('{!fundingSource.Id}');return false; ">Edit</a>
                        </apex:outputPanel>
                        <apex:outputPanel rendered="{!fundingSource.Funding_Source_Status__c == 'Active Final' || fundingSource.Funding_Source_Status__c == 'Inactive'}">
                            <a href="#" onclick="loadFundingSource('{!fundingSource.Id}');return false;">View</a>
                        </apex:outputPanel>
                    </apex:column>
                    <apex:column value="{!fundingSource.Funding_Source_Status__c}" />
                    <apex:column value="{!fundingSource.Type_of_Coverage__c}" />
                    <apex:column value="{!fundingSource.Payer_Name__c}" />
                    <apex:column value="{!fundingSource.Effective_Date__c}" rendered="{!fundingSourceRecordType == 'NeuroRestorative'}"/>
                    <apex:column value="{!fundingSource.Termination_Date__c}" rendered="{!fundingSourceRecordType == 'NeuroRestorative'}"/>
                    <apex:column value="{!fundingSource.Status__c}" />
                    <apex:column value="{!fundingSource.Comment__c}" />
                    <apex:column value="{!fundingSource.CreatedDate}" />
                </apex:pageBlockTable>
            </apex:pageBlockSection>
        </apex:pageBlock>

<!--    common status for all actions on funding source -->
        <apex:actionStatus id="fundingSouceModalStatus" >
            <apex:facet name="start">
            <div style="opacity:0.8; background-color:#ccc; position:fixed; width:100%; height:100%; top:0px; left:0px; z-index:100;"/>
            <div style="position: fixed; left:50%; top:50%; background-color: white; border: 2px solid gray; padding: 2px; z-index: 200;">
                <span><img class="waitingImage" src="/img/loading.gif" title="Please Wait..." /> Processing . . . </span>
            </div>
            </apex:facet>
            <apex:facet name="stop" />
        </apex:actionStatus>
        <!-- end Funding sources section-->

        <!-- AUTHS SECTION -->
        <a id="auths"></a>
        <apex:pageBlock id="authList" mode="maindetail" rendered="{! (vfVarIsCM  || isNR || isADH) && !newSA && canViewAuths }">
            <div class="pbHeaderButton">
                <apex:outputPanel layout="none">
                    <apex:outputLabel value="Show Disregarded" />
                    <apex:inputCheckbox value="{!authsIncDisregard}" label="Show Disregarded">
                    <apex:actionSupport event="onchange" action="{!populateAuths}" rerender="authList" status="AddAuthStatus" />
                    </apex:inputCheckbox>
                </apex:outputPanel>
                <apex:commandButton value="Add Authorization" onclick="window.open('/apex/AuthorizationEdit?saId={!theServAssign.Id}&retURL={!URLENCODE($CurrentPage.URL)}&RecordType={!authRecTypeID}', '_self'); return false;" rendered="{!canCreateAuths && fundingSources.size>0 && fundingSources != null && vfVarIsCM }" />
                <apex:commandButton value="Add Authorization" onclick="window.open('/apex/AuthorizationNREdit?saId={!theServAssign.Id}&retURL={!URLENCODE($CurrentPage.URL)}&RecordType={!authRecTypeID}', '_self'); return false;" rendered="{!canCreateAuths && fundingSources.size>0 && fundingSources != null && (isNR || isADH)}" />

                <apex:actionStatus id="AddAuthStatus">
                    <apex:facet name="start">
                        <apex:image height="16px" value="/img/loading32.gif" styleClass="dialogLoadingSpinner" />
                    </apex:facet>
                    <apex:facet name="stop" />
                </apex:actionStatus>
            </div>
            <apex:pageBlockSection id="auth_Alt1_Header" title="Authorizations" collapsible="true" columns="1">
            <apex:outputText value="No Authorizations to display" rendered="{!(authList.size=0)}" />
        <apex:pageBlockTable value="{!authList}" var="auth" rendered="{! authList.size!=0 && canViewAuths }" headerClass="tbl-header" rowClasses="tmn-row-odd, tmn-row-even" >
                <apex:column headerValue="Action" >
                    <apex:outputPanel rendered="{!vfVarIsCM}">
                        <a href="/apex/AuthorizationView?id={!auth.ID}&saID={!theServAssign.ID}&retURL={!URLENCODE($CurrentPage.URL)}">View</a>
                        <apex:outputPanel layout="none" rendered="{!auth.Authorization_Status__c != 'Final' && auth.Authorization_Status__c != 'Disregard'}" >
                            &nbsp;|&nbsp;<a href="/apex/AuthorizationEdit?id={!auth.Id}&saID={!theServAssign.ID}&retURL={!URLENCODE($CurrentPage.URL)}">Edit</a>
                        </apex:outputPanel>
                    </apex:outputPanel>
                    <apex:outputPanel rendered="{!isNR || isADH}">
                        <a href="/apex/AuthorizationNRView?id={!auth.ID}&saID={!theServAssign.ID}&retURL={!URLENCODE($CurrentPage.URL)}">View</a>
                        <apex:outputPanel layout="none" rendered="{!auth.Authorization_Status__c != 'Active Final' && auth.Authorization_Status__c != 'Disregard' && auth.Authorization_Status__c != 'Inactive Final'}" >
                            &nbsp;|&nbsp;<a href="/apex/AuthorizationNREdit?id={!auth.Id}&saID={!theServAssign.ID}&retURL={!URLENCODE($CurrentPage.URL)}">Edit</a>
                        </apex:outputPanel>
                    </apex:outputPanel>                    
                </apex:column>
                <apex:column value="{!auth.Contract_Used__c}" rendered="{! (!isNR && !isADH)}"  />
                <apex:column value="{!auth.Payer_Authorization_ID__c}"  headervalue="Authorization Number"/>
                <apex:column value="{!auth.Authorization_Status__c}" headervalue="Status" />
                <apex:column value="{!auth.Type__c}" headervalue="Type" rendered="{! (!isNR && !isADH)}"/>
                <apex:column value="{!auth.Service_Being_Funded_String__c}" headervalue="Item/Service" rendered="{! (!isNR && !isADH)}"/>
                <apex:column value="{!auth.Rate__c}" headervalue="Rate"/>
                <apex:column value="{!auth.Rate_unit__c}" headervalue="Per" rendered="{! (!isNR && !isADH)}"/>
                <apex:column headervalue="Received" rendered="{! (!isNR && !isADH)}">
                    <c:MilitaryDatetime datetimeval="{!auth.Received_Date_Time__c}" />
                </apex:column>
                <apex:column value="{!auth.Payer_Effective_Date__c}" headervalue="Start"/>
                <apex:column value="{!auth.Payer_End_Date__c}" headervalue="End"/>

            </apex:pageBlockTable>
            <apex:outputPanel rendered="{!authList.size = 10}">Showing 10 most recent authorizations. Click <a href="/apex/AuthorizationListView?saId={!Service_Assignment__c.Id}" style="color: blue;">here</a>&nbsp;to view all </apex:outputPanel>
            </apex:pageBlockSection>
        </apex:pageBlock>

        <!-- costs and theray auths -->
        <apex:pageBlock id="therapyauthList" mode="maindetail" rendered="{! isNR && !newSA && canViewAuths }">
            <div style="float: right;">
                <apex:commandButton value="Add Costs & Therapy Authorization" onclick="window.open('/apex/AuthorizationTherapyCostNREdit?saId={!theServAssign.Id}&retURL={!URLENCODE($CurrentPage.URL)}', '_self'); return false;" rendered="{!canCreateAuths && fundingSources.size>0 && fundingSources != null && isNR}" />
            </div>
            <apex:pageBlockSection id="auth_Alt1_Header" title="Costs & Therapy Authorizations" collapsible="true" columns="1">
                <apex:pageBlockTable value="{!NRCostTherapyAuths}" var="auth" rendered="{! NRCostTherapyAuths.size!=0 && canViewAuths }" headerClass="tbl-header" rowClasses="tmn-row-odd, tmn-row-even" >
                    <apex:column headerValue="Action" >
                        <apex:outputPanel >
                            <a href="/apex/AuthorizationTherapyCostNRView?id={!auth.ID}&saID={!theServAssign.ID}&retURL={!URLENCODE($CurrentPage.URL)}">View</a>
                            <apex:outputPanel layout="none" rendered="{!auth.Authorization_Status__c != 'Final' && auth.Authorization_Status__c != 'Disregard'}" >
                                &nbsp;|&nbsp;<a href="/apex/AuthorizationTherapyCostNREdit?id={!auth.Id}&saID={!theServAssign.ID}&retURL={!URLENCODE($CurrentPage.URL)}">Edit</a>
                            </apex:outputPanel>
                        </apex:outputPanel>                    
                    </apex:column>
                    <apex:column value="{!auth.Requested_By__c}"  headervalue="Case Manager"/>
                    <apex:column value="{!auth.Auth_Units_Grand_Total__c}"  />
                    <apex:column value="{!auth.Total_Weekly_Auth_Therapy_Units__c}" />
                    <apex:column value="{!auth.CreatedDate}" />
                </apex:pageBlockTable>
            </apex:pageBlockSection>        
        </apex:pageBlock>
        <!-- Therapy SECTION -->
        <a id="therapyDetails"></a>
        <apex:pageBlock id="therapyList" mode="maindetail" rendered="{! vfVarIsCM && $ObjectType.Therapy_Hour__c.accessible }">
                <apex:pageBlockSection id="cmther_Alt1_Header" title="Therapy" collapsible="true" columns="1">

            <apex:outputText value="No Therapy Hours to display" rendered="{!(therapyList.size = 0 )}" />
            <apex:pageBlockTable value="{!therapyList}" var="therapy" rendered="{! therapyList.size!=0 }" rows="5" headerClass="tbl-header" rowClasses="tmn-row-odd, tmn-row-even" >
                <apex:column value="{!therapy.Owner.Name}"  headervalue="Therapist Name"/>
                <apex:column value="{!therapy.Appointment_Type__c}"  headervalue="Appointment Type"/>
                <apex:column headervalue="Start Time">
                    <c:MilitaryDatetime datetimeval="{!therapy.Start_Time__c}" />
                </apex:column>
                <apex:column headervalue="End Time">
                    <c:MilitaryDatetime datetimeval="{!therapy.End_Time__c}" />
                </apex:column>
                <apex:column value="{!therapy.Number_of_Hours__c}" headervalue="Number of Hours"/>
                <apex:column value="{!therapy.Narrative_Note__c}" headervalue="Notes"/>
            </apex:pageBlockTable>
            <apex:outputPanel rendered="{!therapyList.size > 5}">Showing 5 most recent Therapy Hour logs. Click <a href="/apex/TherapyListView?saId={!Service_Assignment__c.Id}" style="color: blue;">here</a>&nbsp;to view all </apex:outputPanel>
            </apex:pageBlockSection>
        </apex:pageBlock>

        <apex:pageBlock mode="maindetail" rendered="{!referral != null }">
            <apex:pageBlockSection id="ref_Alt1_Header" title="Referral Detail" collapsible="false"/>
            <apex:pageBlockSection columns="2" title="Originating Referral" collapsible="true">
                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="Name" />
                    <apex:outputlink value="/{!referral.Id}" id="originalReferral">{!referral.name}</apex:outputlink>
                </apex:pageBlockSectionItem>
                <apex:outputField value="{!referral.Referral_Date__c}" />
                <apex:pageBlockSectionItem rendered="{!!referral.Has_Evaluation__c && vfVarIsCM }">
                    <apex:outputLabel value="Evaluation" />
                    <apex:outputText value="No Evaluation to display." />
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem rendered="{!referral.Has_Evaluation__c}">
                    <apex:outputLabel value="Evaluation" />
                    <apex:outputLink value="/apex/CareMeridianEvaluationView?id={!referral.Evaluations__r[0].Id}&SA_Id={!theServAssign.Id}">{!referral.Evaluations__r[0].Name}</apex:outputLink>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem rendered="{! vfVarIsCM }" />
                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="Created By" />
                    <apex:outputPanel layout="none">
                        <apex:outputField value="{!referral.CreatedById}" />,
                        <apex:outputText value=" {!referral.CreatedDate}" />
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>
                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="Last Modified By" />
                    <apex:outputPanel layout="none">
                        <apex:outputField value="{!referral.LastModifiedById}" />,
                        <apex:outputText value=" {!referral.LastModifiedDate}" />
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>
            </apex:pageBlockSection>

            <apex:pageBlockSection title="Funding Source" collapsible="true" columns="1" >
                <br />
                <apex:pageBlockTable value="{!referralFundingsources}" var="item" rendered="{!(referralFundingsources != null || referralFundingsources.size > 0)}" headerClass="tbl-header" rowClasses="tmn-row-odd, tmn-row-even" >
                    <apex:column value="{!item.name}" />
                    <apex:column value="{!item.Type_of_Coverage__c}" />
                    <apex:column value="{!item.Payer_Name__c}" />
                    <apex:column value="{!item.Effective_Date__c}" />
                    <apex:column value="{!item.Termination_Date__c}" />
                    <apex:column value="{!item.Status__c}" />
                    <apex:column value="{!item.Comment__c}" />
                    <apex:column value="{!item.CreatedDate}" />
                </apex:pageBlockTable>
                <apex:outputText value="No records to display" rendered="{!(referralFundingsources == null || referralFundingsources.size = 0)}" />
            </apex:pageBlockSection>

        </apex:pageBlock>

        <!-- Link Diagnosis to SA Modal -->
        <apex:actionRegion >
            <apex:outputPanel id="saDiagModal" style="display:none" >
                <apex:pageBlock mode="maindetail">
                     <apex:pageblockButtons location="bottom">
                         <apex:commandButton value="Save" onClick="validatesadiagJo(true); return false;" />
                         <apex:commandButton value="Save & New" onClick="validatesadiagJo(false);return false;" />
                         <apex:commandButton value="Cancel" onClick="closeModalDialogSA('saDiagModal', 'span'); j$('#sadiagJoErrors').html('');return false;" />
                     </apex:pageblockButtons>

                   <div id='sadiagJoErrors' style='color:red'></div>

                    <apex:pageBlockSection Columns="1" id="sadiagJoEntry" >
                        <apex:pageBlockSectionItem >
                            <apex:outputLabel value="Diagnosis" for="pbsdiagSelectList" />
                            <apex:selectList size="1" value="{!selectedDiagnosis}" id="pbsdiagSelectList">
                                <apex:selectoptions value="{!pbsDiagnosisList}" />
                            </apex:selectList>
                        </apex:pageBlockSectionItem>
<!--                         <apex:inputField value="{!sadiagJO.Status__c}" id="sadiagJoEntry_sadiagJoStatus"/>                    -->
                        <apex:inputField value="{!sadiagJO.Ranking__c}" id="sadiagJoEntry_sadiagJoRanking" html-data-visibility-rules="{&quot;Primary&quot;: [&quot;{!$Component.comainjuryItem.sadiagJoEntry_sadiagJoInjuryScore}&quot;, &quot;{!$Component.comainjuryItem.sadiagJoEntry_sadiagJoInjuryScoreLabel}&quot;, &quot;{!$Component.comaSeverityItem.sadiagJoEntry_sadiagJoInjurySeverity}&quot;,
                                    &quot;{!$Component.comaSeverityItem.sadiagJoEntry_sadiagJoInjurySeverityLabel}&quot;,&quot;{!$Component.injurytypeItem.sadiagJoEntry_sadiagJoInjuryType}&quot;, &quot;{!$Component.injtypeOtherItem.sadiagJoEntry_sadiagJoInjOther}&quot;, &quot;{!$Component.injurytypeItem.sadiagJoEntry_sadiagJoInjuryTypeLabel}&quot;, &quot;{!$Component.injtypeOtherItem.sadiagJoEntry_sadiagJoInjOtherLabel}&quot;, &quot;{!$Component.sadiagJoEntry_sadiagJoAbiDiagnosis}&quot;,
                                    &quot;{!$Component.injDateItem.sadiagJoEntry_sadiagJoInjuryDate}&quot;, &quot;{!$Component.injDateItem.sadiagJoEntry_sadiagJoInjuryDateLabel}&quot;]}"
                                    html-data-visibility-row-rules="true" />
                        <apex:inputField value="{!sadiagJO.Billable__c}" id="sadiagJoEntry_sadiagJoBillable"/>
                        <apex:pageBlockSectionItem id="injurytypeItem">
                            <apex:outputLabel Value="Injury Type"  Style="{!IF((isNR || vfVarIsCM),'','display:none;')}" id="sadiagJoEntry_sadiagJoInjuryTypeLabel"/>
                            <apex:inputField value="{!sadiagJO.Injury_Type__c}" id="sadiagJoEntry_sadiagJoInjuryType" onchange="setABIDiagnosis(); return false;" Style="{!IF((isNR || vfVarIsCM),'','display:none;')}" />
                        </apex:pageBlockSectionItem>
                        <apex:pageBlockSectionItem id="injtypeOtherItem">
                            <apex:outputLabel value="Specify Other" Style="{!IF((isNR || vfVarIsCM),'','display:none;')}" id="sadiagJoEntry_sadiagJoInjOtherLabel"/>
                            <apex:inputField value="{!sadiagJO.Injury_Type_Other__c}" id="sadiagJoEntry_sadiagJoInjOther" Style="{!IF((isNR || vfVarIsCM),'','display:none;')}"/>
                        </apex:pageBlockSectionItem>

                        <apex:inputField value="{!sadiagJO.ABI_Diagnosis__c}" id="sadiagJoEntry_sadiagJoAbiDiagnosis" onchange="setInjuryDate(); return false;" rendered="{!!isADH}"/>

                        <apex:pageBlockSectionItem id="injDateItem" rendered="{!!isADH}">
                            <apex:outputLabel value="Injury Date" id="sadiagJoEntry_sadiagJoInjuryDateLabel"/>
                            <apex:inputField value="{!sadiagJO.Date_of_Injury__c}" id="sadiagJoEntry_sadiagJoInjuryDate"/>
                        </apex:pageBlockSectionItem>
                        <apex:pageBlockSectionItem id="comainjuryItem">
                            <apex:outputLabel value="Glasgow Coma Score at Injury" Style="{!IF(isNR,'','display:none;')}" id="sadiagJoEntry_sadiagJoInjuryScoreLabel"/>
                            <apex:inputField value="{!sadiagJO.Glasgow_Coma_Score_at_Injury__c}" id="sadiagJoEntry_sadiagJoInjuryScore" onchange="setGlasgowSeverity(); return false;" Style="{!IF(isNR,'','display:none;')}"/>
                        </apex:pageBlockSectionItem>
                        <apex:pageBlockSectionItem id="comaSeverityItem">
                            <apex:outputLabel value="Glasgow Coma Scale Severity" Style="{!IF(isNR,'','display:none;')}" id="sadiagJoEntry_sadiagJoInjurySeverityLabel"/>
                            <apex:inputField value="{!sadiagJO.Glasgow_Coma_Scale_Severity__c}" id="sadiagJoEntry_sadiagJoInjurySeverity" Style="{!IF(isNR,'','display:none;')}" />
                        </apex:pageBlockSectionItem>

                        <apex:inputHidden value="{!sadiagJO.Id}" id="sadiagJoEntry_sadiagJOId" />
<!--                         <apex:inputHidden value="{!hasPrimaryDiagJo}" /> -->
<!--                        <apex:inputHidden value="{!primaryDiagJoId}" /> -->
                    </apex:pageBlockSection>
                </apex:pageBlock>
            </apex:outputPanel>
        </apex:actionRegion>
        
        <!-- Add Personal Agent Modal - Start-->
        <apex:actionFunction name="savepa" action="{!savePa}" oncomplete="setTodateforPa(); return false;" status="pageProcessing" rerender="msgs,pAgentTable,pAgentModalBlock" />
        <apex:actionFunction name="showaddCaseManager" action="{!showaddCaseManager}" status="pageProcessing" reRender="msgs,caseManagerModalBlock"  oncomplete="openModalDialogSA('caseManagerModal', 'span', 'Choose Personal Agent','none', '700'); return false;"/>
        <apex:actionRegion >
            <apex:outputPanel id="pAgentmodal"  style="display:none;" rendered="{! !newSA && theServAssign.Flavor__c == 'Oregon'}">
                <apex:pageBlock id="pAgentModalBlock" >
                    <div id="paMsgs" style="color:red"></div>
                    <apex:pageBlockSection columns="1" id="pAgentModalEntry">
                        <apex:pageBlockSectionItem >
                        <apex:outputPanel >
                            <apex:outputLabel value="Personal Agent" />
                        </apex:outputPanel>
                        <apex:outputPanel >
                            <apex:inputText label="Personal Agent" value="{!caseManagerName}"  id="pAgentmodal_caseManager" />
                             <a onClick="showaddCaseManager();return false;">
                                <img valign="bottom" src="/s.gif" alt="Case Manager Lookup (New Window)" class="lookupIcon" onblur="this.className = 'lookupIcon';" onfocus="this.className = 'lookupIconOn';" onmouseout="this.className = 'lookupIcon';" onmouseover="this.className = 'lookupIconOn';" title="Case Manager Lookup (New Window)" />
                             </a>
                         </apex:outputPanel>
                       </apex:pageBlockSectionItem>
                        <apex:inputField value="{!pa.Status__c}" id="pAgentmodal_status" onchange="setTodateforPa(); return false;"/>
                        <apex:inputField value="{!pa.From_Date__c}" label="From" id="pAgentmodal_from" />
                        <apex:pageBlockSectionitem >
                            <apex:outputLabel for="pAgentmodal_To" value="To" id="pAgentmodal_ToLabel" />
                            <apex:inputField value="{!pa.To_Date__c}" label="To" id="pAgentmodal_To" />
                        </apex:pageBlockSectionitem>
                        <apex:inputHidden value="{!pa.Personal_Agent__c}" id="pAgentmodal_agent" />
                        <apex:inputHidden value="{!pa.Id}" id="pAgentmodal_paId" rendered="{!pa.Id != null}" />
                    </apex:pageBlockSection>
                    <apex:pageBlockbuttons location="bottom" id="pAgentButtons">
                        <apex:commandbutton value="Save" onClick="validateandSavepAgent(true); return false;"/>
                        <apex:commandbutton value="Save and New" onClick="validateandSavepAgent(false); return false;"/>
                        <apex:commandbutton value="Cancel" action="{!cancelPa}" status="pageProcessing" reRender="msgs,caseManagerModalBlock,pAgentModalBlock" onComplete="closeModalDialogSA('pAgentmodal', 'span');"/>
                    </apex:pageBlockbuttons>
                </apex:pageBlock>
            </apex:outputPanel>
        </apex:actionRegion>
        <!-- Add Personal Agent Modal - End-->
        <!-- Case Manager Modal Start -->
        <apex:actionRegion >
            <apex:outputPanel id="caseManagerModal"  style="display:none;" rendered="{! !newSA && theServAssign.Flavor__c == 'Oregon'}" >
                <apex:pageBlock id="caseManagerModalBlock" >
                    <apex:pageBlockTable value="{!caseManagers}" var="m" id="casemanagerTable">
                        <apex:column headerValue="Personal Agent">
                            <a href="#" onClick="selected('{!m.id}','{!m.name}')" >{!m.name}</a>
                        </apex:column>
                    </apex:pageBlockTable>
                    <apex:pageBlockbuttons location="bottom" id="pAgentButtons">
                        <apex:commandbutton value="Cancel" action="{!closecaseManager}" status="pageProcessing" reRender="msgs,caseManagerModalBlock" onComplete="closeModalDialogSA('caseManagerModal', 'span');"/>
                    </apex:pageBlockbuttons>
                </apex:pageBlock>
            </apex:outputPanel>
        </apex:actionRegion>
        <!-- Case Manager Modal End -->

        <apex:outputPanel id="restraintReportModal" style="display: none; ">
            <script>
                (function ($) {
                    "use strict";
                    window.generateRestraintReport = function () {
                        var errorString = '';
                        var startDate = $(document.getElementById('{!$Component.block.section.reportStartDate}')).val();
                        var endDate = $(document.getElementById('{!$Component.block.section.reportEndDate}')).val();
                        if (startDate == '') {
                            errorString += 'Start Date cannot be blanked.\r\n';
                        }
                        if (endDate == '') {
                            errorString += 'End Date cannot be blanked.\r\n';
                        }
                        var $checkedItem = $(document.getElementById('{!$Component.block.section.reportType}')).find('input:checked');
                        if ($checkedItem.length == 0) {
                            errorString += 'Report Type cannot be blanked.';
                        }
                        if (errorString != '') {
                            alert(errorString);
                        } else {
                            window.location = '/apex/RestraintReductionReport?startDate='+startDate+'&endDate='+endDate+'&type='+$checkedItem.val()+'&saId={!Service_Assignment__c.Id}';
                        }
                    };
                })(jQuery);
            </script>
            <apex:pageBlock title="Restraint Reduction Report" mode="maindetail" id="block">
                <apex:pageBlockSection columns="2" id="section">
                    <!-- The next 2 fields are just dummies so we can use SF inputField datepicker -->
                    <apex:inputField value="{!dummy.Date_of_Injury__c}" label="Start Date" id="reportStartDate" />
                    <apex:inputField value="{!dummy.Date_of_Injury__c}" label="End Date" id="reportEndDate" />
                    <apex:selectRadio label="Report Type" id="reportType">
                        <apex:selectOption itemLabel="Summary" itemValue="Summary" />
                        <apex:selectOption itemLabel="Detailed" itemValue="Detailed" />
                    </apex:selectRadio>
                </apex:pageBlockSection>
                <apex:pageBlockButtons location="bottom">
                    <apex:commandButton value="Generate" onclick="generateRestraintReport(); return false; " />
                    <apex:commandButton value="Cancel" onclick="closeModalDialogSA('restraintReportModal', 'span'); return false; " />
                </apex:pageBlockButtons>
            </apex:pageBlock>
        </apex:outputPanel>
        <div id="IowaDailyDataSummaryDialog" style="display:none;" >
        <apex:outputpanel layout="none" rendered="{!(AND(vfVarIsRW,BEGINS($UserRole.DeveloperName, 'IA')))}" >
            <script>
                jQuery.noConflict();
                jQuery(document).ready(function($) {
                    $('.datepicker').datetimepicker({
                        timepicker: false,
                        format: 'm/d/Y',
                        closeOnDateSelect: true
                    });
                });
            </script>
            <span class="ui-helper-hidden-accessible"><input type="text"/></span>
            <apex:pageBlock id="IowaDailyDataSummaryDialogMainBlock" mode="maindetail">
                <apex:pageBlockSection >
                    <apex:pageBlockSectionItem >
                    <apex:outputLabel value="Service date" />
                        <apex:outputPanel layout="none">
        <!--                     <div class="requiredInput"><div class="requiredBlock"></div> -->
                            <input id="IowaDailyDataSummaryServiceDate" type="text" class="datepicker" />
        <!--                     </div> -->
                        </apex:outputPanel>
                    </apex:pageBlockSectionItem>

                    <apex:pageBlockSectionItem >
                        <apex:outputPanel layout="block">
                            <a class="btn" href="#" id="IowaDailyDataSummaryGenerate" onClick="window.open('/apex/IowaDailyDataSummary?serviceDate=' + document.getElementById('IowaDailyDataSummaryServiceDate').value
                                        + '&saId='+ '{!theServAssign.Id}'
                                        , '_blank');return false;">Generate</a>&nbsp;&nbsp;
                            <a class="btn" href="#" onClick="closeModalDialogSA('IowaDailyDataSummaryDialog', 'div');return false;">Close</a>
                        </apex:outputPanel>
                    </apex:pageBlockSectionItem>
                </apex:pageBlockSection>
            </apex:pageBlock>
        </apex:outputpanel>
        </div>
    </apex:form>


    <c:SObjectNotesAndAttachments parentPage="ServAssign" parentId="{!Service_Assignment__c.id}" showAction="true" rendered="{! newSA==false}"   pbsId="{!admission.Person_Being_Served__c}" servAssignId="{!theServAssign.Id}"  admId="{!admissionId}"></c:SObjectNotesAndAttachments>
    <c:GenericHistoryComponent myObject="{!Service_Assignment__c}" rendered="{! newSA==false}" />

    <script type="text/javascript">
        j$(setFocus);
        var j$ = jQuery.noConflict();
        function setFocus() {
            document.getElementById("hiddenElementId").focus();
        }

        function RefreshPage() {
            window.location.reload();
        }

        function dispdischargePopup(){
            var dis = j$('[id$=hiddendischargePopup]').val();
            if (dis == 'true') {
                openDialog('tstpopupAfterEsign', 'span', 'Would you like to fully discharge the Admission?');
             }
            else{
                callSaveMethod();
            }
        }

        //disable enter key

        function stopRKey(evt) {
            var evt = (evt) ? evt : ((event) ? event : null);
            var node = (evt.target) ? evt.target : ((evt.srcElement) ? evt.srcElement : null);
            if ((evt.keyCode == 13) && (node.type == "text")) {
                return false;
            }
        }

        document.onkeypress = stopRKey;

        //opens the dialog
        function openDialog(dialogId, tagType, titleString, dClass) {
            selector = tagType + '[id$=' + dialogId + ']';

            if (j$(selector).dialog("isOpen") !== true) {
                j$(selector).dialog({
                        dialogClass: dClass,
                        title: titleString,
                        modal: true,
                        width: 800,
                        closeOnEscape: false
                    })
                    .parent()
                    .appendTo(j$('form[id$=myFRM]'));
                j$(selector).parent().find('a.ui-dialog-titlebar-close').remove();
            }
        }

        function closeDialog(dialogId, tagType) {
            selector = tagType + '[id$=' + dialogId + ']';

            j$(selector).dialog('destroy').remove();
        }

        function getMode(name){
            if(name=(new RegExp('[?&]'+encodeURIComponent(name)+'=([^&]*)')).exec(location.search))
            return decodeURIComponent(name[1]);
        }

        function changeEffectiveDates() {
            var sd = j$('input[id$=startdate]').val().substring(0,10);
            var ed = j$('input[id$=enddate]').val();

            setEffectiveDate(sd, ed);

        }

        var saStartDateTime = {
            intializeDateTimePicker: function($target) {
                j$($target).datetimepicker({
                    format: 'm/d/Y H:i',
                    onGenerate: function(dp, $input) {
                        j$('.xdsoft_datetimepicker.xdsoft_.xdsoft_noselect').css("top", "+=10");
                    }
                });
            }
        }

        function validatesadiagJo(isDialogClose) {
            var errors = '';
            j$('#sadiagJoErrors').html(errors);

            var diagSAJOId = j$('input[id$=sadiagJoEntry_sadiagJOId]').val();
            var diagId = j$('select[id$=pbsdiagSelectList]').val();
            var saID = '{!Service_Assignment__c.Id}';
            var ABI = j$('input[id$=sadiagJoEntry_sadiagJoAbiDiagnosis]').is(':checked');
            var Billable = j$('input[id$=sadiagJoEntry_sadiagJoBillable]').is(':checked');
            var injuryDate = j$('input[id$=sadiagJoEntry_sadiagJoInjuryDate]').val();
            var glasgowInjury = j$('select[id$=sadiagJoEntry_sadiagJoInjuryScore]').val();
            var glasgowSeverity = j$('select[id$=sadiagJoEntry_sadiagJoInjurySeverity]').val();
            var injType = j$('select[id$=sadiagJoEntry_sadiagJoInjuryType]').val();
            var injTypeOther = j$('input[id$=sadiagJoEntry_sadiagJoInjOther]').val();
            var rank = j$('select[id$=sadiagJoEntry_sadiagJoRanking]').val();

            var injuryDateFormat  = new Date(moment(new Date(injuryDate)).format());
            var today = new Date(moment(new Date()).format());

            if (diagId == '--None--') {
               errors += '<li>Diagnosis is a required field.</li>';
            }
            if (rank == '') {
                errors += '<li>Ranking is a required field.</li>';
            }
            if(rank == 'Primary' && glasgowInjury == '' && {!isNR}){
                errors += '<li>Glasgow Coma Score at Injury is a required field when ranking is primary.</li>';
            }
            if(rank == 'Primary' && glasgowSeverity == '' && {!isNR}){
                errors += '<li>Glasgow Coma Scale Severity is a required field when ranking is primary.</li>';
            }
            if(rank == 'Primary' && injType == '' &&{! (isNR || vfVarIsCM )}){
                errors += '<li>Injury type is a required field when ranking is primary.</li>';
            }
            if(injType.indexOf('Other') > -1 && injTypeOther == ''){
                errors += '<li>Please specify other.</li>';
            }
            if(rank == 'Primary' && injuryDate == '' && {! (isNR || vfVarIsCM)}){
                errors += '<li>Injury Date is a required field when ranking is primary.</li>';
            }
            if(injuryDate != '' && injuryDateFormat > today){
                errors += '<li>Injury Date cannot be in future.</li>';
            }

            if(errors !=  '' ){
                 j$('#sadiagJoErrors').html(errors);
                 return (errors == '');
            }

           if(errors == ''){
                    Visualforce.remoting.Manager.invokeAction(
                    '{!$RemoteAction.ServiceAssignmentExt.checkErrors}',
                    saID,
                    diagSAJOId,
                    diagId,
                    function(result, event){
                        if (event.status) {
                                if(result == 'dupe diagnosis'){
                                    errors += '<li>This diagnosis is already associated to this Service Assignment</li>';
                                    j$('#sadiagJoErrors').html(errors);
                                    return (errors == '');
                                }
                                else if(result == 'primary error' && rank == 'Primary'){
                                    errors += '<li>Primary Diagnosis already exist for this Service Assignment</li>';
                                    j$('#sadiagJoErrors').html(errors);
                                    return (errors == '');
                                }
                                else{
                                    sadiagJoSave(isDialogClose);
                                }
                        } else if (event.type === 'exception') {
                            document.getElementById("sadiagJoErrors").innerHTML = event.message;
                        } else {
                            document.getElementById("sadiagJoErrors").innerHTML = event.message;
                        }
                    },
                    {escape: true}
                );
          }

        }

         function sadiagJoSave(isDialogClose) {
                var diagSAJOId = j$('input[id$=sadiagJoEntry_sadiagJOId]').val();
                var diagId = j$('select[id$=pbsdiagSelectList]').val();
                var saID = '{!Service_Assignment__c.Id}';
                var ABI = j$('input[id$=sadiagJoEntry_sadiagJoAbiDiagnosis]').is(':checked');
                var Billable = j$('input[id$=sadiagJoEntry_sadiagJoBillable]').is(':checked');
                var injuryDate = j$('input[id$=sadiagJoEntry_sadiagJoInjuryDate]').val() != null ? j$('input[id$=sadiagJoEntry_sadiagJoInjuryDate]').val() : null;
                var glasgowInjury = j$('select[id$=sadiagJoEntry_sadiagJoInjuryScore]').val();
                var glasgowSeverity = j$('select[id$=sadiagJoEntry_sadiagJoInjurySeverity]').val();
                var injType = j$('select[id$=sadiagJoEntry_sadiagJoInjuryType]').val();
                var injTypeOther = j$('input[id$=sadiagJoEntry_sadiagJoInjOther]').val();
                var rank = j$('select[id$=sadiagJoEntry_sadiagJoRanking]').val();

                 if(diagId != ''){
                    Visualforce.remoting.Manager.invokeAction(
                    '{!$RemoteAction.ServiceAssignmentExt.savesadiagJORemote}',
                        diagSAJOId, diagId, saID, ABI, Billable, injuryDate,glasgowInjury,glasgowSeverity,injType,injTypeOther,rank,
                        function(result, event) {
                            if(event.status){
                                savesadiagJo();
                                if(isDialogClose) {
                                    closeModalDialogSA('saDiagModal', 'span');
                                }
                            }else if (event.type === 'exception') {
                                document.getElementById("sadiagJoErrors").innerHTML = event.message;
                            }else {
                                document.getElementById("sadiagJoErrors").innerHTML = event.message;
                            }

                        }, {
                            escape: true
                        }
                    );

                }

            return false;
        }

        setGlasgowSeverity = function(){
              var glasgowInjury = j$('select[id$=sadiagJoEntry_sadiagJoInjuryScore]').val();
              if(glasgowInjury == '3-8'){
                j$('select[id$=sadiagJoEntry_sadiagJoInjurySeverity]').val('Severe');
              }else if(glasgowInjury == '9-12'){
                j$('select[id$=sadiagJoEntry_sadiagJoInjurySeverity]').val('Moderate');
              }else if(glasgowInjury == '13-15'){
                j$('select[id$=sadiagJoEntry_sadiagJoInjurySeverity]').val('Mild');
              }else if(glasgowInjury == ''){
                j$('select[id$=sadiagJoEntry_sadiagJoInjurySeverity]').val('');
              }
        }

        setABIDiagnosis = function(){
            if({!isNR || vfVarIsCM }){
                var injType = j$('select[id$=sadiagJoEntry_sadiagJoInjuryType]').val();
                if(injType.indexOf('Acquired Brain Injury') > -1 ){
                    j$('input[id$=sadiagJoEntry_sadiagJoAbiDiagnosis]').prop('checked', true);
                    j$('input[id$=sadiagJoEntry_sadiagJoAbiDiagnosis]').prop('disabled', true);
                }
                else{
                    j$('input[id$=sadiagJoEntry_sadiagJoAbiDiagnosis]').prop('checked', false);
                    j$('input[id$=sadiagJoEntry_sadiagJoAbiDiagnosis]').prop('disabled', false);
                }

                if(injType.indexOf('Other') > -1){
                    j$('input[id$=sadiagJoEntry_sadiagJoInjOther]').show();
                    j$('[id$=sadiagJoEntry_sadiagJoInjOtherLabel]').show();
                }else{
                    j$('[id$=sadiagJoEntry_sadiagJoInjOtherLabel]').hide();
                    j$('input[id$=sadiagJoEntry_sadiagJoInjOther]').hide();
                    j$('input[id$=sadiagJoEntry_sadiagJoInjOther]').val('');
                }
            }
        }

        setInjuryDate = function(){
            var ABI = j$('input[id$=sadiagJoEntry_sadiagJoAbiDiagnosis]').is(':checked');
            if(!ABI && {!vfVarIsCB || vfVarIsRW }){
                j$('input[id$=sadiagJoEntry_sadiagJoInjuryDate]').hide();
                j$('[id$=sadiagJoEntry_sadiagJoInjuryDateLabel]').hide();
                j$('input[id$=sadiagJoEntry_sadiagJoInjuryDate]').val('');
            }else{
                j$('input[id$=sadiagJoEntry_sadiagJoInjuryDate]').show();
                j$('[id$=sadiagJoEntry_sadiagJoInjuryDateLabel]').show();
            }
        }
        
        function setTodateforPa(){
            var status = j$('select[id$=pAgentmodal_status]').val();
            if(status == 'Inactive'){
                j$('input[id$=pAgentmodal_To]').show();
                j$('[id$=pAgentmodal_ToLabel]').show();
            }else{
                j$('input[id$=pAgentmodal_To]').val('');
                j$('input[id$=pAgentmodal_To]').hide();
                j$('[id$=pAgentmodal_ToLabel]').hide();
            }
        }
        
        function validateandSavepAgent(isDialogClose) {
            var errors = '';
            var from = j$('input[id$=pAgentmodal_from]').val();
            var fromDt = new Date(from);
            var to = j$('input[id$=pAgentmodal_To]').val() != null ? j$('input[id$=pAgentmodal_To]').val() : null;
            var toDt = new Date(to);
            var sapaId = j$('input[id$=pAgentmodal_paId]').val() != null ? j$('input[id$=pAgentmodal_paId]').val() : null;
            var SAID = '{!Service_Assignment__c.Id}';
            var paId = j$('input[id$=pAgentmodal_agent]').val();
            j$('#paMsgs').html(errors);
            if (j$('input[id$=pAgentmodal_agent]').val() == '') {
                errors += '<li>Personal Agent is a required field.</li>';
            }
            if (j$('select[id$=pAgentmodal_status]').val() == '') {
                errors += '<li>Status is a required field.</li>';
            }
            if (from == '') {
                errors += '<li>From Date is a required field.</li>';
            }
            if (j$('select[id$=pAgentmodal_status]').val() == 'Inactive' && to == '') {
                errors += '<li>To Date is a required field.</li>';
            }
            if(fromDt != '' &&  toDt != '' && fromDt > toDt ){
                errors += '<li>To Date should be greater than From Date.</li>';
            }
            if(errors !=  '' ){
                j$('#paMsgs').html(errors);
                return (errors == '');
            }
            if(errors == ''){
                    Visualforce.remoting.Manager.invokeAction(
                    '{!$RemoteAction.ServiceAssignmentExt.checkPAoverlap}',
                    SAID,
                    sapaId,
                    paId,
                    from,
                    to,
                    function(result, event){
                        if (event.status) {
                                if(result){
                                    errors += '<li>The date you are entering is overlapping with another existing entry for the same Personal Agent</li>';
                                    j$('#paMsgs').html(errors);
                                    return (errors == '');
                                }else{
                                    savepa();
                                    if(isDialogClose) {
                                        closeModalDialogSA('pAgentmodal', 'span');
                                    }
                                 }
                          return false;    
                        } else if (event.type === 'exception') {
                            document.getElementById("paMsgs").innerHTML = event.message;
                        } else {
                            document.getElementById("paMsgs").innerHTML = event.message;
                        }
                    },
                    {escape: true}
                );
            }
        }
      
        function selected(caseManagerId,CaseManagerName) {
            closeModalDialogSA('caseManagerModal', 'span');
            j$('[id$=pAgentmodal_agent]').val(caseManagerId);
            j$('[id$=pAgentmodal_caseManager]').val(CaseManagerName);
        }

    </script>
    <script>
        function addLoadEvent(func) {
            var oldonload = window.onload;
            if (typeof window.onload != 'function') {
                window.onload = func;
            } else {
                window.onload = function() {
                    if (oldonload) {
                        oldonload();
                    }
                    func();
                }
            }
        }
        addLoadEvent(function() {
            var modeOfThePage = getMode('Mode');
            if(modeOfThePage == 'Saved'){
                var dis = j$('[id$=hiddendischargePopup]').val();
                if (dis == 'true') {
                    openDialog('tstpopupAfterEsign', 'span', 'Would you like to fully discharge the Admission?');
                }
            }
        });
    </script>

    <apex:actionStatus id="pageProcessing">
        <apex:facet name="start">
            <div style="opacity:0.8; background-color:#ccc; position:fixed; width:100%; height:100%; top:0px; left:0px; z-index:2000;"/>
            <div style="position: fixed; left:50%; top:50%; background-color: white; border: 2px solid gray; padding: 2px; z-index: 2000;">
                <span><img class="waitingImage" src="/img/loading.gif" title="Please Wait..." /> Processing . . . </span>
            </div>
        </apex:facet>
        <apex:facet name="stop" />
    </apex:actionStatus>
    <apex:stylesheet value="{!URLFOR($Resource.mentoresd,'/mentoresdcss2.css')}" />
        <style>
        .pbHeaderButton{    top: 0px !important;}
        </style>
	<!-- PRD-9 Percent Complete: Configure Storage of Values in iServe -->
	<apex:remoteObjects >
		<apex:remoteObjectModel name="Progress_Meter__c" jsShorthand="pm" fields="Id,Items_Complete__c,Progress_Text__c,Total_Items__c,WhatId__c,WhatID_Object__c"/>
	</apex:remoteObjects>
	<!-- End PRD-9 -->
</apex:page>