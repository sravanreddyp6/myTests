<apex:page title="Admission Edit: {!admission.Name}" standardController="Admission__c" extensions="AdmissionEditExtension" standardStylesheets="false" sidebar="false" tabStyle="Persons_Being_Served_New__tab">
<apex:stylesheet value="{!URLFOR($Resource.mentoresd,'/mentoresd.css')}" />
<apex:stylesheet value="{!URLFOR($Resource.datetimepicker,  'datetimepicker/jquery.datetimepicker.css')}" />
<apex:includeScript value="{!URLFOR($Resource.jquery, 'js/jquery-1.7.2.min.js')}" />
<apex:includeScript value="{!URLFOR($Resource.datetimepicker, 'datetimepicker/jquery.datetimepicker.js')}" />
<apex:includeScript value="{!URLFOR($Resource.momentJs)}" />
<script type="text/javascript">
function setFocusOnLoad() {}
var addmissionDateTime = {
    intializeDateTimePicker: function($target) {
        jQuery($target).datetimepicker({
            format: 'm/d/Y H:i',
            closeOnDateSelect: true,
            onGenerate: function(dp, $input) {
                jQuery('.xdsoft_datetimepicker.xdsoft_.xdsoft_noselect').css("top", "+=10");
            }
        });
        if ($target.length === 1){
                  jQuery($target).val((moment($target.val().toString()).format('L LT') == 'Invalid date' ? '' : moment($target.val().toString()).format('L HH:mm')).toString());
        }
    },
    updateDateTime: function($target) {
        jQuery($target).val((moment($target.val().toString()).format('L LT') == 'Invalid date' ? '' : moment($target.val().toString()).format('L LT')));
    }
}
jQuery(function($) {
    addmissionDateTime.intializeDateTimePicker($('input[id$=admissionEffectiveDateTime]'));
});
</script>
    
    <c:PersonalRecord pbsId="{!admission.Person_Being_Served__c}" parentPage="Admission" admId="{!Admission__c.Id}" rendered="{!showPersonalCard}"/>
    <br />
    <apex:form >
    <apex:pageMessages id="msgs"/>
        <apex:pageBlock title="Admission Edit" id="detail" mode="edit">
            <div class="pbHeaderButton" id="buttons">
				<apex:commandButton value="Save" id="btnSave" action="{!save}" status="mySaveStatus" onClick="addmissionDateTime.updateDateTime(jQuery('input[id$=admissionEffectiveDateTime]'))" rerender="msgs, detail" onComplete="addmissionDateTime.intializeDateTimePicker(jQuery('input[id$=admissionEffectiveDateTime]'));"/>
			    <apex:commandButton action="{!cancel}" value="Cancel"/>
            </div>
            <apex:pageBlockSection title="Information" columns="2">
                <apex:outputField value="{!admission.Name}" />
                <apex:inputField value="{!admission.Status__c}" />
                <apex:outputField value="{!admission.Person_Being_Served__c}" />
                <apex:pageBlockSectionItem >
                    <apex:outputLabel value="Effective Date" />
                    <apex:outputPanel >
                        <div class="requiredInput">
                            <div class="requiredBlock"></div>
                            <apex:inputText id="admissionEffectiveDateTime" value=" {!admission.Admission_Effective_DateTime__c}" required="true" />
                        </div>
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>
                <apex:inputField value="{!admission.Network_Offering__c}" required="true" />
                <apex:inputField value="{!admission.Discharged_Date__c}" />
                <apex:inputField value="{!admission.State__c}" required="true" />
                <apex:inputField value="{!admission.Discharged_Status__c}" />
                <apex:pageBlockSectionItem />
                <apex:inputField value="{!admission.Reason_for_Discharge__c}" />
            </apex:pageBlockSection>
            <apex:pageBlockSection title="Referred-Out Details" columns="1">
                <apex:inputField value="{!admission.Referred_Out_Date__c}" />
                <apex:inputField value="{!admission.Referred_Out_Agency_Name__c}" />
                <apex:inputField value="{!admission.Referred_Out_Reason__c}" />
            </apex:pageBlockSection>
        </apex:pageBlock>
    </apex:form>

<apex:actionStatus id="mySaveStatus">
    <apex:facet name="start">
        <style>
            .thinkingwheel {
                position: fixed;
                left: 50%;
                top: 50%;
                background-color: white;
                border: 2px solid gray;
                padding: 2px;
                z-index: 2000;
            }            
            .foggy {
                opacity: 0.8;
                background-color: #ccc;
                position: fixed;
                width: 100%;
                height: 100%;
                top: 0px;
                left: 0px;
                z-index: 1000;
            }
        </style>
        <div class="foggy" />
        <div class="thinkingwheel">
            <span><img class="waitingImage" src="/img/loading.gif" title="Please Wait..." /> Processing . . . </span>
        </div>
    </apex:facet>
    <apex:facet name="stop"> </apex:facet>
</apex:actionStatus>
</apex:page>