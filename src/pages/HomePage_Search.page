<apex:page title="Home Page Search" controller="HomePageSearchController" standardStylesheets="true" sidebar="false" tabStyle="Persons_Being_Served_New__tab" readOnly="true">
    <apex:includeScript value="{!URLFOR($Resource.jquery, '/js/jquery-1.7.2.min.js')}" />
    <apex:includeScript value="{!URLFOR($Resource.dataTables, '/dataTables/media/js/jquery.dataTables.min.js')}" />
    <apex:includeScript value="{!URLFOR($Resource.qtip, '/jquery.qtip.min.js')}" />
     
    <apex:stylesheet value="{!URLFOR($Resource.mentoresd,'/mentoresd.css')}" />
    <apex:stylesheet value="{!URLFOR($Resource.qtip, '/jquery.qtip.min.css')}" />
<style>
#table_filter h1 {
    font-size: 14px;
    display: inline-block;
    margin: 10px 10px 10px 0;
}

input#table_filter_box {
    padding-top: 1px;
}
[id *=view_filter] {
    margin-bottom: 10px;
}

[id *=view_filter] select {
    margin-right: 5px;
}

[id *=view_filter] a {
    color: #015BA7;
    text-decoration: none;
}

[id *=view_filter] a:hover {
    color: #015BA7;
}
table#Total_Names {
    border-collapse: collapse;
    border: 1px solid;
    width: 100%;
}

table#Total_Names thead,table#Total_Names thead td {
    border: 1px solid;
}

table#Total_Names thead tr {
    background-color: #32CD32;
}

table#Total_Names thead td {
    font-weight: bold;
    background-color: #ededed;
}

table#Total_Names tbody tr:hover {
    background-color: #E3F3FF;
}

table#Total_Names td {
    padding: 6px 10px;
}

div#table_start_filter {
    padding: 5px 10px;
}

div#table_start_filter a {
    text-decoration: none;
    padding: 6px 6px 5px 5px;
}

div#table_start_filter a.active {
    background-color: #C6E1FF;
    font-weight: bold;
}



.paginate_disabled_previous,.paginate_disabled_next,.paginate_enabled_previous,.paginate_enabled_next
    {
    padding: 0 5px;
}

.paginate_disabled_previous:hover,.paginate_disabled_next:hover,.paginate_enabled_previous:hover,.paginate_enabled_next:hover
    {
    cursor: pointer;
    color: blue;
}

[id *=table_div] {
    min-width: 800px; /* Make sure the table is not too small */
}

table#Total_Names.dataTable {
    border-bottom: 0;
}

#Total_Names_wrapper .bottom {
    border: 1px solid;
    border-top: 0;
    padding-bottom: 5px;
}

.dataTables_paginate {
    display: inline-block;
    position: relative;
    left: 150px;
}

.dataTables_record_info {
    display: inline-block;
}

#Total_Names_info {
    display: inline-block;
    float: left;
    margin-left: 50px;
}

.dataTables_page_info {
    display: inline-block;
    position: relative;
    left: 600px;
}
#loading_modal {
    position: absolute;
    width: 100%;
    height: 100%;
    /* IE Hack */
    filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled=true, sizingMethod=scale, src='{!URLFOR($Resource.TransparentBG)}');
    background-image:url({!URLFOR($Resource.TransparentBG)});    
    z-index: 99999;
    text-align: center;
}
[id*=table_block] {
    position: relative;  /* In order for loading model to be absolute positioned */
}

</style>
 
 <apex:pageBlock id="table_block">
   <!-- <div id="loading_modal">
            <img style="position: relative; top: 30px;" src="/img/loading32.gif" />
        </div> -->
     <div id="table_start_filter" >
                Browse by Name 
                <a href="#" data-filter='[A]'>A</a>&nbsp;|&nbsp;<a href="#" data-filter='[B]'>B</a>&nbsp;|&nbsp;
                <a href="#" data-filter='[C]'>C</a>&nbsp;|&nbsp;<a href="#" data-filter='[D]'>D</a>&nbsp;|&nbsp;
                <a href="#" data-filter='[E]'>E</a>&nbsp;|&nbsp;<a href="#" data-filter='[F]'>F</a>&nbsp;|&nbsp;
                <a href="#" data-filter='[G]'>G</a>&nbsp;|&nbsp;<a href="#" data-filter='[H]'>H</a>&nbsp;|&nbsp;
                <a href="#" data-filter='[I]'>I</a>&nbsp;|&nbsp;<a href="#" data-filter='[J]'>J</a>&nbsp;|&nbsp;
                <a href="#" data-filter='[K]'>K</a>&nbsp;|&nbsp;<a href="#" data-filter='[L]'>L</a>&nbsp;|&nbsp;
                <a href="#" data-filter='[M]'>M</a>&nbsp;|&nbsp;<a href="#" data-filter='[N]'>N</a>&nbsp;|&nbsp;
                <a href="#" data-filter='[O]'>O</a>&nbsp;|&nbsp;<a href="#" data-filter='[P]'>P</a>&nbsp;|&nbsp;
                <a href="#" data-filter='[Q]'>Q</a>&nbsp;|&nbsp;<a href="#" data-filter='[R]'>R</a>&nbsp;|&nbsp;
                <a href="#" data-filter='[S]'>S</a>&nbsp;|&nbsp;<a href="#" data-filter='[T]'>T</a>&nbsp;|&nbsp;
                <a href="#" data-filter='[U]'>U</a>&nbsp;|&nbsp;<a href="#" data-filter='[V]'>V</a>&nbsp;|&nbsp;
                <a href="#" data-filter='[W]'>W</a>&nbsp;|&nbsp;<a href="#" data-filter='[XYZ]'>XYZ</a>&nbsp;|&nbsp;
                <a href="#" class="active" data-filter='.'>All</a>
       </div>
       <br />
       <br />
        <apex:outputPanel layout="block" id="table_div">
            
            <table id="Total_Names" class="tablesorter">
                <thead>
                    <tr>
                        <td style="width: 25%">Full Name</td>
                        <td style="width: 30%">Age</td>
                        <td style="width: 37%">State</td>
                        <td style="width: 40%">Type</td>
                    </tr>
                </thead>
                <tbody>
                   <apex:repeat value="{!TotalList}" var="acct">
                        <apex:outputPanel layout="none">
                            <tr data-name="{!(acct.FullName)}">
                                <td><apex:outputLink rendered="{!(acct.Type=='Person Being Referred')}">
                                             <a href="/apex/ReferralSearch?referralNumber={!acct.Names}" data-record-id="{!acct}" class="account_link">{!(acct.FullName)}</a>
                                    </apex:outputLink>
                                     <apex:outputLink rendered="{!(acct.Type=='Person Being Served')}">
                                             <a href="/PersonsBeingServedListView?table_filter_box={!acct.FullName}.val()" data-record-id="{!acct}" class="account_link">{!(acct.FullName)}</a>
                                    </apex:outputLink>
                                     <apex:outputLink rendered="{!(acct.Type=='Mentor')}">
                                             <a href="/apex/TmnContactListView?j_id0%3Aj_id3%3Afcf=00B11000000Q4YH" data-record-id="{!acct}" class="account_link">{!(acct.FullName)}</a>
                                    </apex:outputLink></td>
                                <td>{!acct.Age}</td>
                                <td>{!acct.State}</td>
                                <td>{!acct.Type}</td>
                            </tr>
                        </apex:outputPanel>
                  </apex:repeat>
               </tbody>
              </table>
          </apex:outputPanel>
       <!--         /apex/ReferralSearch?referralNumber={!acct.recordId}     ************************************************************ -->
      
       

   </apex:pageBlock>
   
  <script type="text/javascript">
    $j = jQuery.noConflict();
    function checkUndefined(field) {
        if (field !== undefined) {
            return field;
        }
        return "-";
    }
    function refreshQtips() {
    
        // All qtips share the same config, so we refactor it here.
        var qtip_options = function (selector, fn) {
            return $j(selector).qtip({
                style: { classes: 'bPageBlock' },
                show: {
                    delay: 1000
                },
                hide: {
                    fixed: true,
                    delay: 500
                },
                content: {
                    text: fn
                },
                position: {
                    my: 'top left',
                    at: 'bottom center',
                    adjust: {
                       y: 15 // because site-wide CSS applies a 15px border-top for <body>
                    }
                }
            });
        }
        var epoch_to_time = function (miliseconds) {
            // Returns string representation of an epoch time.
            // Because UTC epoch is sent back, we have to parse the time like
            // this. See: http://stackoverflow.com/questions/4631928/convert-utc-epoch-to-local-date-with-javascript
            if (miliseconds === undefined) {
                return "-";
            }
            var d = new Date(0);
            d.setUTCMilliseconds(miliseconds);
            return (d.getUTCMonth()+1) + '/' + d.getUTCDate() + '/' + d.getUTCFullYear();
        }
        qtip_options(".account_link", function(e, api) {
            var account_id = $j(e.target).data("record-id");
            Visualforce.remoting.Manager.invokeAction(
                '{!TotalList}'
                function (result, event) {
                    if (event.status) { // Success
                        api.set('content.text',
                            '<div class="pbHeader"><h2 class="mainTitle">Full Name</h2></div>' + 
                            '<div class="pbBody"><table class="detailList">' + 
                            '<tr><td class="labelCol">Name:</td><td class="dataCol">' + $j(e.target).parent().parent().data('name') + '</td></tr>' +
                            '<tr><td class="labelCol">Name:</td><td class="dataCol">' + checkUndefined(result.FullName) + '</td></tr>' +
                            '<tr><td class="labelCol">Age:</td><td class="dataCol">' + checkUndefined(result.Age) + '</td></tr>' +
                            '<tr><td class="labelCol">State:</td><td class="dataCol">' + checkUndefined(result.State) + '</td></tr>' +
                            '<tr><td class="labelCol">Type:</td><td class="dataCol">' + checkUndefined(result.Type) + '</td></tr>' +
                            '<br /><div style="width:100% text-align:center;"><a class="btn" href="/' + result.recordId + '">View Record</a>' +
                            '&nbsp;&nbsp;<a class="btn" href="/' + result.recordId + '#RP">View Related Parties</a><br /><Br /></div></div>'
                        );
                    } else if (event.type === 'exception') {
                        api.set('content.text', 'Error: <br/>' + event.message);
                        console.log(event);
                    } else {
                        api.set('content.text', event.message);
                    }
                }
            );
            return "Loading ...";
        });
     
    }
    
   /* function showLoadingModal() {
        $j("#loading_modal").css("display", "block");
    }
    function refreshDataTable() {
        refreshQtips();
        // Have to make this var global in order for filter to work
        table = $j("#Total_Names").dataTable({
            "bProcessing": true,
            "bAutoWidth": false,
            "sDom": '<"top">t<"bottom"rpi><"clear">',
            "sPaginationType": "four_button",
            "iDisplayLength": 25,
            "fnInfoCallback": function( oSettings, iStart, iEnd, iMax, iTotal, sPre ) {
                var info = this.fnPagingInfo();
                if (iEnd == 0) {
                    iStart = 0; // Otherwise it displays as 1 - 0 of ...
                }
                return "<div class='dataTables_record_info'>" + iStart + " - " + iEnd + " of " + iTotal + "</div><div class='dataTables_page_info'>Page " + info.iPage +" of "+ info.iTotalPages + '</div>';
            },
            "fnInitComplete": function () {
                filterByStatus(this);
                $j("#loading_modal").css("display", "none");
            },
            "oLanguage": {
                 "sInfo": "_START_ - _END_ of _TOTAL_",
                 "sZeroRecords": "No records to display",
                 "sInfoEmpty": "No Records",
                 "oPaginate": {
                     "sFirst": "<<",
                     "sLast": ">>",
                     "sNext": "Next >",
                     "sPrevious": "< Previous"
                }
            },
            "aoColumns": [
                null, // Full Name
                null, // Age
                null, // State
                null, // Type
               { "bVisible": false } // Admission Status
            ]
        });
       table.fnSort( [ [0,'asc'] ] );
        $j("#table_filter_box").keyup();
    }*/
    $j.fn.dataTableExt.afnFiltering.push(function( oSettings, aData, iDataIndex ) {
        var textToSearch = $j('#table_filter_box').val().toLowerCase();
        if (aData[0].toLowerCase().indexOf(textToSearch)!==-1 ||
            aData[1].toLowerCase().indexOf(textToSearch)!==-1 ||
            aData[2].toLowerCase().indexOf(textToSearch)!==-1 ||
            aData[3].toLowerCase().indexOf(textToSearch)!==-1 ||
            aData[4].toLowerCase().indexOf(textToSearch)!==-1) {
            return true;
        }
        return false;
    });
    var filterByStatus = function (injectedTable) {
        var statusToSearch = $j('#table_status_filter_box :selected').val();
        if (statusToSearch === 'All') {
            statusToSearch = '';
        }
        if (injectedTable) {
            injectedTable.fnFilter(statusToSearch, 6, true);
        } else {
            table.fnFilter(statusToSearch, 6, true);
        }
    }
    $j(document).ready(function() {
       // refreshDataTable();
        filterByStatus();
        $j('#table_filter_box').on('keyup', function () {
            table.fnFilter('', 0, true);  // Clear the column-based filter first
            table.fnFilter($j('#table_filter_box').val());
            $j('#table_start_filter a.active').removeClass('active');
            $j('#table_start_filter a:contains("All")').addClass('active');
            return false;
        });
        $j('#table_status_filter_box').on('change', function (event) {
            filterByStatus();
        });
        $j('body').on('click', '#table_start_filter a', function (event) {
            $j('#table_filter_box').val('');  // Remove the text in filter box
            table.fnFilter('');  // Clear the global filter
            var regex = '^' + $j(event.target).data('filter');
            table.fnFilter(regex, 0, true);
            $j('#table_start_filter a.active').removeClass('active');
            $j(event.target).addClass('active');
            return false;
        });
    });
    
      
    (function ($) {
        $.fn.dataTableExt.oPagination.four_button = {
            "fnInit": function ( oSettings, nPaging, fnCallbackDraw )
            {
                nFirst = document.createElement( 'span' );
                nPrevious = document.createElement( 'span' );
                nNext = document.createElement( 'span' );
                nLast = document.createElement( 'span' );
                  
                nFirst.appendChild( document.createTextNode( oSettings.oLanguage.oPaginate.sFirst ) );
                nPrevious.appendChild( document.createTextNode( oSettings.oLanguage.oPaginate.sPrevious ) );
                nNext.appendChild( document.createTextNode( oSettings.oLanguage.oPaginate.sNext ) );
                nLast.appendChild( document.createTextNode( oSettings.oLanguage.oPaginate.sLast ) );
                  
                nFirst.className = "paginate_button first";
                nPrevious.className = "paginate_button previous";
                nNext.className = "paginate_button next";
                nLast.className = "paginate_button last";
                  
                nPaging.appendChild( nFirst );
                nPaging.appendChild( nPrevious );
                nPaging.appendChild( nNext );
                nPaging.appendChild( nLast );
                  
                $(nFirst).click( function () {
                    oSettings.oApi._fnPageChange( oSettings, "first" );
                    fnCallbackDraw( oSettings );
                } );
                  
                $(nPrevious).click( function() {
                    oSettings.oApi._fnPageChange( oSettings, "previous" );
                    fnCallbackDraw( oSettings );
                } );
                  
                $(nNext).click( function() {
                    oSettings.oApi._fnPageChange( oSettings, "next" );
                    fnCallbackDraw( oSettings );
                } );
                  
                $(nLast).click( function() {
                    oSettings.oApi._fnPageChange( oSettings, "last" );
                    fnCallbackDraw( oSettings );
                } );
                  
                /* Disallow text selection */
                $(nFirst).bind( 'selectstart', function () { return false; } );
                $(nPrevious).bind( 'selectstart', function () { return false; } );
                $(nNext).bind( 'selectstart', function () { return false; } );
                $(nLast).bind( 'selectstart', function () { return false; } );
            },
             
             
            "fnUpdate": function ( oSettings, fnCallbackDraw )
            {
                if ( !oSettings.aanFeatures.p )
                {
                    return;
                }
                  
                /* Loop over each instance of the pager */
                var an = oSettings.aanFeatures.p;
                for ( var i=0, iLen=an.length ; i<iLen ; i++ )
                {
                    var buttons = an[i].getElementsByTagName('span');
                    if ( oSettings._iDisplayStart === 0 )
                    {
                        buttons[0].className = "paginate_disabled_previous";
                        buttons[1].className = "paginate_disabled_previous";
                    }
                    else
                    {
                        buttons[0].className = "paginate_enabled_previous";
                        buttons[1].className = "paginate_enabled_previous";
                    }
                      
                    if ( oSettings.fnDisplayEnd() == oSettings.fnRecordsDisplay() )
                    {
                        buttons[2].className = "paginate_disabled_next";
                        buttons[3].className = "paginate_disabled_next";
                    }
                    else
                    {
                        buttons[2].className = "paginate_enabled_next";
                        buttons[3].className = "paginate_enabled_next";
                    }
                }
            }
        };
        $.fn.dataTableExt.oApi.fnPagingInfo = function ( oSettings )
        {
            return {
                "iStart":         oSettings._iDisplayStart,
                "iEnd":           oSettings.fnDisplayEnd(),
                "iLength":        oSettings._iDisplayLength,
                "iTotal":         oSettings.fnRecordsTotal(),
                "iFilteredTotal": oSettings.fnRecordsDisplay(),
                "iPage":          oSettings.fnRecordsDisplay() === 0 ?
                    0 : Math.ceil( (oSettings._iDisplayStart+1) / oSettings._iDisplayLength ),
                "iTotalPages":    oSettings.fnRecordsTotal() === 0 ?
                    0 : Math.ceil( oSettings.fnRecordsDisplay() / oSettings._iDisplayLength )
            };
        };
    } ($j))
    </script> 
    <script type="text/javascript" src="/path/to/jquery.tablesorter.js">
    $('table').ready(function()
    {
      $("#Total_Names").tablesorter();
    }
    );
    $('table').ready(function()
     {
       $("#Total_Names").tablesorter({sortList: [[0,0], [1,0]]});
     }
    );
    
    
    </script>
</apex:page>