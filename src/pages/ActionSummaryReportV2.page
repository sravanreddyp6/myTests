<apex:page standardController="Action_Summary__c" extensions="ActionSummaryReportV2">
	<apex:includeScript value="{!URLFOR($Resource.jquery, 'js/jquery-1.7.2.min.js')}"/>
	<apex:stylesheet value="{!URLFOR($Resource.mentoresd,'/mentoresd.css')}" />
	<style>
		#pbsBlueCard {
			margin-bottom: 15px;
		}
		.leftAndTheRest {
			padding-left:300px;
		}
		.recommendationBlock {
			float: left;
			padding: 4px;
			padding-left: 120px;
			position: relative;
			width: 180px;
			right: 300px;
			margin-left: -100%;
		}
		.commentBlock {
			float: left;
			padding: 4px;
			width: 100%;
			position: relative;
		}
		.objectiveCommentInput {
			width:100%;
		}
		tr.dataRow {
			background-color: white;
		}
		tr.dataRow.changed {
			background-color: #FFF8DC;
		}
		tr.dataRow:hover {
			background-color: #e3f3ff;
		}
		table.alignTop td {
			vertical-align: top !important;
		}
		a.viewAllLink {
			display: inline-block;
			margin-top: 5px;
			margin-left: 5px;
		}
	</style>

	<c:PersonalRecord pbsId="{!Action_Summary__c.Service_Assignment__r.Admission__r.Person_Being_Served__r.Id}"
		parentPage="ActionSummaryReport" servAssignId="{!Action_Summary__c.Service_Assignment__c}"
		admId="{!Action_Summary__c.Service_Assignment__r.Admission__c}" />

	<apex:pageMessages id="pageMessages" />
	<apex:form id="mainForm">
		<apex:pageBlock title="Action Plan Summary" >
			<div class="pbHeaderButton">
				<apex:commandButton value="Go To Prior Summaries" id="priorSummariesButton" rendered="{!action == 'edit'}"/>
				<apex:commandButton value="Save" action="{!save}" id="saveButton" status="pageProcessing"  rendered="{!action == 'edit'}"/>
				<apex:commandButton value="Cancel" action="{!cancel}" id="cancelButton" rendered="{!action == 'edit'}"/>
			</div>
			<apex:pageBlockSection title="Summary Details" columns="2">
				<apex:outputField value="{!Action_Summary__c.Name}" label="Summary Name" />
				<apex:outputField value="{!Action_Summary__c.Start_Date__c}" />
				<apex:outputField value="{!Action_Summary__c.Service_Assignment__r.Admission__c}" />
				<apex:outputField value="{!Action_Summary__c.End_Date__c}" />
				<apex:outputField value="{!Action_Summary__c.Service_Assignment__c}" />
				<apex:outputField value="{!Action_Summary__c.Status__c}" />
				<apex:pageBlockSectionItem >
					<apex:outputLabel for="summaryCreatedBy" value="Created By" />
					<apex:outputLink id="summaryCreatedBy" value="/{!Action_Summary__c.CreatedBy.Id}">{!Action_Summary__c.CreatedBy.Name}</apex:outputLink>
				</apex:pageBlockSectionItem>
				<apex:outputField value="{!Action_Summary__c.CreatedDate}" />
			</apex:pageBlockSection>
			<apex:pageBlockSection title="Vitals Detail Summary" columns="1">
				<apex:outputPanel layout="block" style="width: {!TABLE_WIDTH}; ">
					<apex:pageBlockTable value="{!vitalsDetails}" var="vital" rows="{!LIST_LIMIT}">
						<apex:column headerValue="Date">
							<apex:outputText value="{0, date, M/d/yyyy}"><apex:param value="{!vital.dateTaken}" /></apex:outputText>
						</apex:column>
						<apex:column headerValue="Heart Rate" value="{!vital.heartRate}" />
						<apex:column headerValue="Blood Pressure" value="{!vital.bloodPressure}" />
						<apex:column headerValue="O2" value="{!vital.o2}" />
						<apex:column headerValue="Temperature" value="{!vital.temperature}" />
					</apex:pageBlockTable>
					<apex:commandLink styleClass="viewAllLink" value="View All" rendered="{!vitalsDetails.size > LIST_LIMIT}" />
				</apex:outputPanel>
			</apex:pageBlockSection>
			<apex:pageBlockSection title="Seizure Activity" columns="1">
				<apex:outputPanel layout="block" style="width: {!TABLE_WIDTH}; ">
					<apex:pageBlockTable value="{!seizures}" var="seizure" rows="{!LIST_LIMIT}">
						<apex:column headerValue="Start Date/Time">
							<apex:outputText value="{0, date, M/d/yyyy h:mm:ss a}"><apex:param value="{!seizure.startTime}" /></apex:outputText>
						</apex:column>
						<apex:column headerValue="End Date/Time">
							<apex:outputText value="{0, date, M/d/yyyy h:mm:ss a}"><apex:param value="{!seizure.endTime}" /></apex:outputText>
						</apex:column>
						<apex:column headerValue="Duration" value="{!seizure.duration} seconds" />
						<apex:column headerValue="Observed By">
							<a href="/{!seizure.observedById}">{!seizure.observedByName}</a>
						</apex:column>
					</apex:pageBlockTable>
					<apex:commandLink styleClass="viewAllLink" value="View All" rendered="{!seizures.size > LIST_LIMIT}" />
				</apex:outputPanel>
			</apex:pageBlockSection>
			<apex:pageBlockSection title="Isolation Events" columns="1">
				<apex:outputPanel layout="block" style="width: {!TABLE_WIDTH}">
					<apex:pageBlockTable value="{!isolationEvents}" var="event" rows="{!LIST_LIMIT}">
						<apex:column headerValue="Start Date/Time">
							<apex:outputText value="{0, date, M/d/yyyy h:mm a}"><apex:param value="{!event.startTime}" /></apex:outputText>
						</apex:column>
						<apex:column headerValue="End Date/Time">
							<apex:outputText value="{0, date, M/d/yyyy h:mm a}"><apex:param value="{!event.endTime}" /></apex:outputText>
						</apex:column>
						<apex:column headerValue="Status" value="{!event.status}" />
						<apex:column headerValue="Type" value="{!event.type}" />
					</apex:pageBlockTable>
					<apex:commandLink styleClass="viewAllLink" value="View All" rendered="{!isolationEvents.size > LIST_LIMIT}" />
				</apex:outputPanel>
			</apex:pageBlockSection>
			<apex:pageBlockSection title="Restraint Events" columns="1">
				<apex:outputPanel layout="block" style="width: {!TABLE_WIDTH}; ">
					<apex:pageBlockTable value="{!restraintEvents}" var="event" rows="{!LIST_LIMIT}">
						<apex:column headerValue="Start Date/Time">
							<apex:outputText value="{0, date, M/d/yyyy h:mm a}"><apex:param value="{!event.startTime}" /></apex:outputText>
						</apex:column>
						<apex:column headerValue="End Date/Time">
							<apex:outputText value="{0, date, M/d/yyyy h:mm a}"><apex:param value="{!event.endTime}" /></apex:outputText>
						</apex:column>
						<apex:column headerValue="Status" value="{!event.status}" />
						<apex:column headerValue="Most Current Restraint Reduction Score" value="{!event.score}" />
					</apex:pageBlockTable>
					<apex:commandLink styleClass="viewAllLink" value="View All" rendered="{!restraintEvents.size > LIST_LIMIT}" />
				</apex:outputPanel>
			</apex:pageBlockSection>
			<apex:pageBlockSection title="Systems" columns="1">
				<apex:outputPanel layout="block" style="width: {!TABLE_WIDTH}; ">
					<table class="list" cellspacing="0" cellpadding="0" border="0">
						<thead>
							<tr class="headerRow">
								<th style="width: 20%; ">System Name</th>
								<th style="width: 20%; ">Status</th>
								<th style="width: 60%; ">Comment</th>
							</tr>
						</thead>
						<tbody>
							<apex:repeat value="{!systemSummaryResultDomain}" var="domain">
								<tr class="dataRow">
									<td class="dataCell">{!domain}</td>
									<td class="dataCell">
										<apex:selectRadio layout="pageDirection" value="{!systemSummaryResultMap[domain].status}">
											<apex:selectOptions value="{!systemStatusOptions}" />
										</apex:selectRadio>
									</td>
									<td class="dataCell">
										<apex:inputTextArea style="width: 95%;" rows="4" value="{!systemSummaryResultMap[domain].comment}" />
									</td>
								</tr>
							</apex:repeat>
						</tbody>
					</table>
				</apex:outputPanel>
			</apex:pageBlockSection>
			<apex:repeat value="{!objectiveMap}" var="objectiveType">
				<apex:pageBlockSection title="{!objectiveType}" columns="1">
					<apex:outputPanel layout="block" id="objectivePanel" style="clear: both; ">
						<apex:repeat value="{!objectiveMap[objectiveType]}" var="objectiveParentToChildrenMap">
							<apex:repeat value="{!objectiveParentToChildrenMap}" var="parentId">
								<table class="list alignTop" style="clear: both; margin-bottom: 20px; " cellspacing="0" cellpadding="0" border="0">
									<thead>
										<tr class="headerRow">
											<th style="width: 40%; ">Description</th>
											<th style="width: 15%; ">Revised</th>
											<th style="width: 15%; ">Attribute</th>
											<th style="width: 30%; ">
												<apex:outputText value="Progress" rendered="{!OR(objectiveType == 'Skill', objectiveType == 'Behavior - Count')}" />
												<apex:outputText value="Narrative Notes" rendered="{!objectiveType == 'Narrative'}" />
											</th>
										</tr>
									</thead>
									<tbody>
										<apex:repeat value="{!objectiveMap[objectiveType][parentId]}" var="objective">
											<tr class="dataRow {!IF(objective.highlight, 'changed', '')}">
												<td class="dataCell" style="padding-top: 10px; padding-left: 5px; ">
													{!objective.objectiveSObject.Description__c}
												</td>
												<td class="dataCell" style="padding-top: 10px; padding-left: 5px; ">
													<apex:outputText rendered="{!parentId != objective.objectiveSObject.Id}" value="{0, date, M/d/yyyy}"><apex:param value="{!objective.objectiveSObject.CreatedDate}" /></apex:outputText>
												</td>
												<td class="dataCell" style="padding-top: 10px; padding-left: 5px; ">
													Status - {!Objective.objectiveSObject.Status__c}<br />
													Effective Date - <apex:outputText value="{0, date, M/d/yyyy}"><apex:param value="{!Objective.objectiveSObject.Effective_Date__c}" /></apex:outputText> <br />
													Target Date - <apex:outputText value="{0, date, M/d/yyyy}"><apex:param value="{!Objective.objectiveSObject.Target_End_Date__c}" /></apex:outputText>
												</td>
												<td class="dataCell" style="padding-top: 5px; padding-left: 5px; ">
													<apex:outputPanel rendered="{!objectiveType == 'Skill'}">
														<table>
															<thead>
																<tr>
																	<th>Time Period</th>
																	<th>Met Obj.</th>
																	<th>Did Not Meet Obj.</th>
																	<th>% Obj. Met</th>
																</tr>
															</thead>
															<tbody>
																<apex:repeat value="{!objective.skillResults.startDates}" var="startDate">
																	<tr>
																		<td>
																			<apex:outputText value="{0, date, MMM yyyy}"><apex:param value="{!startDate}" /></apex:outputText>
																		</td>
																		<td>{!objective.skillResults.metObjectiveMap[startDate]}</td>
																		<td>{!objective.skillResults.notMetObjectiveMap[startDate]}</td>
																		<td>{!objective.skillResults.percentMetObjectiveMap[startDate]}</td>
																	</tr>
																</apex:repeat>
																<apex:outputPanel layout="none" rendered="{!objective.skillResults.startDates.size == 0}">
																	<tr>
																		<td colspan="4">No data recorded</td>
																	</tr>
																</apex:outputPanel>
															</tbody>
														</table>
													</apex:outputPanel>
													<apex:outputPanel rendered="{!objectiveType == 'Behavior - Count'}">
														<table>
															<thead>
																<tr>
																	<th>Time Period</th>
																	<th>Occurrences</th>
																</tr>
															</thead>
															<tbody>
																<apex:repeat value="{!objective.countResults.startDates}" var="startDate">
																	<tr>
																		<td>
																			<apex:outputText value="{0, date, MMM yyyy}"><apex:param value="{!startDate}" /></apex:outputText>
																		</td>
																		<td>{!objective.countResults.occurrenceMap[startDate]}</td>
																	</tr>
																</apex:repeat>
																<apex:outputPanel layout="none" rendered="{!objective.countResults.startDates.size == 0}">
																	<tr>
																		<td colspan="2">No data recorded</td>
																	</tr>
																</apex:outputPanel>
															</tbody>
														</table>
													</apex:outputPanel>
													<apex:outputPanel rendered="{!objectiveType == 'Narrative'}" layout="block" style="max-height: 200px; overflow: auto;">
														<table>
															<tbody>
																<apex:repeat value="{!objective.objectiveSObject.Action_Narrative_Results__r}" var="result">
																	<tr>
																		<td>
																			<apex:outputText value="{0, date, M/d/yyyy}"><apex:param value="{!result.CreatedDate}" /></apex:outputText>
																		</td>
																		<td>
																			{!result.Description__c}
																		</td>
																	</tr>
																</apex:repeat>
																<apex:outputPanel layout="none" rendered="{!objective.objectiveSObject.Action_Narrative_Results__r.size == 0}">
																	<tr>
																		<td colspan="2">No data recorded</td>
																	</tr>
																</apex:outputPanel>
															</tbody>
														</table>
													</apex:outputPanel>
												</td>
											</tr>
										</apex:repeat>
									</tbody>
								</table>
								<apex:outputPanel layout="block" styleClass="leftAndTheRest">
									<apex:outputPanel layout="block" styleClass="commentBlock">
										<div style="font-weight:bold">Objective Comment</div>
										<apex:inputTextArea styleClass="objectiveCommentInput" value="{!recommendationSummaryResultMap[parentId].comment}" rows="6" rendered="{!action='edit'}" />
										<apex:outputText value="{!recommendationSummaryResultMap[parentId].comment}" rendered="{!action!='edit'}" />
									</apex:outputPanel>
									<apex:outputPanel layout="block" styleClass="recommendationBlock">
										<div style="color:#cc6600;font-weight:bold;">Recommendation</div>
										<apex:selectRadio value="{!recommendationSummaryResultMap[parentId].recommendation}"  layout="pageDirection" rendered="{!action='edit'}">
											<apex:selectoptions value="{!recommendationOptions}"></apex:selectoptions>
										</apex:selectRadio>
										<apex:outputText value="{!recommendationSummaryResultMap[parentId].recommendation}" rendered="{!action!='edit'}"/>
									</apex:outputPanel>
								</apex:outputPanel>
							</apex:repeat>
						</apex:repeat>
					</apex:outputPanel>
				</apex:pageBlockSection>
			</apex:repeat>
		</apex:pageBlock>
	</apex:form>

	<script>
		jQuery.noConflict();
		jQuery(document).ready(function ($) {});
	</script>
</apex:page>