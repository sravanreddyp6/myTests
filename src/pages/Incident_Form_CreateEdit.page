<apex:page standardcontroller="Incident__c" Extensions="Incident_Form_CreateEdit" sidebar="false" docType="html-5.0" >
	<apex:stylesheet value="{!URLFOR($Resource.mentoresd,'/mentoresd.css')}" />
    <apex:includeScript value="{!URLFOR($Resource.jquery, 'js/jquery-1.7.2.min.js')}" />
    <apex:includeScript value="{!URLFOR($Resource.jquery, 'js/jquery-ui-1.8.21.custom.min.js')}" />
	<apex:includeScript value="{!URLFOR($Resource.CommonJS)}" />
	<apex:includeScript value="{!URLFOR($Resource.momentJs)}" />
	
<script>
    function setFocusOnLoad() {} //to prevent fiocus from first date time field


        jQuery.noConflict();
        jQuery(document).ready(function($) {
            setUpFields = function () {
                // Apply rules to input fields
                $('body input').on("change", function (event) {
                    applyShowHideRulesToField(event.target);
                });
                $('body select').on("change", function (event) {
                    applyShowHideRulesToField(event.target);
                });
                $('body input').each(function (_, target) {
                    applyShowHideRulesToField(target);
                });
                $('body select').each(function (_, target) {
                    applyShowHideRulesToField(target);
                });
				$('body input').on("change", function (event) {
					applyRulesToField(event.target);
				});
				$('body select').on("change", function (event) {
					applyRulesToField(event.target);
				});
				$('body input').each(function (_, target) {
					applyRulesToField(target);
				});
				$('body select').each(function (_, target) {
					applyRulesToField(target);
				}); 
				evalFirstReportedField( jQuery('[id$=first_reported_by]'), true );               
            };
            setUpFields();
        }); 
        
function evalFirstReportedField(eley, leaveBlank){
	console.log( jQuery(eley).val() );
	jQuery('[id$=specify_emp_label]').addClass('noDisplay');
	jQuery('[id$=specify_mentor_label]').addClass('noDisplay');
	jQuery('[id$=specify_exp_label]').addClass('noDisplay');
	if(!leaveBlank){
		jQuery('[id$=specify_emp_input]').val('');
		jQuery('[id$=specify_mentor_input]').val('');
		jQuery('[id$=specify_exp_input]').val('');
	}	
	var v = jQuery(eley).val();
	if(v == 'Employee'){
		jQuery('[id$=specify_emp_label]').removeClass('noDisplay');
	}
	if(v == 'Mentor'){
		jQuery('[id$=specify_mentor_label]').removeClass('noDisplay');
	}
	if(v == 'External Party'){
		jQuery('[id$=specify_exp_label]').removeClass('noDisplay');
	}	



}        
</script>
<style>
.sub-question-header{font-size:10pt; font-weight: bold; padding: 7px; padding-left:0px; color: #4a4a56;}
.sub-question-wrapper{padding: 7px; padding-left:0px;}
.labelCol{min-width: 300px;}
.noDisplay{display: none;}
/*
.pbSubheader {
   background-color: #253e76 !important;  
   color: White !important; 
}

.pbTitle h2{
	background-color: #253e76 !important;  
  	color: White !important;
  	width: 100%;
  	font-size: 11pt !important;
}
*/
</style>
<br/>
<c:PersonalRecord pbsId="{!servAssign.Admission__r.Person_Being_Served__c}" servAssignId="{!servAssign.Id}" parentPage="incidentEdit" admId="{!servAssign.Admission__c}" rendered="{!servAssign.id != null}" />
<apex:pagemessages id="msgs" />
<br/>
<apex:form id="theForm" >
    <apex:pageBlock mode="detail" >
        <apex:pageBlockButtons >
            <div style="float: right;">
                <apex:CommandButton action="{!saveIncident}" value="Save" status="pageProcessing" reRender="theForm, msgs" oncomplete="setUpFields();"/>
                <apex:CommandButton action="{!Cancel}" value="Cancel" />
            </div>
        </apex:pageBlockButtons>
        <apex:pageBlock mode="mainDetail" title="General Information" id="generalInfoBlock">
        	<apex:pageBlockSection columns="1" showHeader="false" >
        		<apex:pageBlockSectionItem rendered="{!recordtypeName == 'PBS'}">
        			<apex:outputLabel value="Which Current Service is Related to the Incident? "  />
        			<apex:outputField value="{!Incident__c.Service_Assignment__c }" />
        		</apex:pageBlockSectionItem>
        	</apex:pageBlockSection>
       		<apex:pageBlockSection columns="1" id="incidentTimingSection" title="Incident Timing" showHeader="true" collapsible="false" >
       			<apex:pageBlockSectionItem id="timeSectionItem">
       			<apex:outputPanel >
       				
       				<apex:outputLabel Value="Date/Time Incident Occurred" id="DateOccurredLabel"/>
       				
       			</apex:outputPanel>
                   <apex:outputPanel >
                       <div class="requiredInput">
							<div class="requiredBlock"></div>
						<c:MilitaryDatetime id="dateOccurredmilitary" shiftTop="20" datetimeval="{!Incident__c.Date_Occurred__c}" edit="true" hiddenFieldId="DateOccurred" datetimepickerid="DateOccurred"/>
                       </div>
                       <apex:inputhidden id="DateOccurred" value="{!Incident__c.Date_Occurred__c}" />
                     
                       
                       <div>
                       <apex:inputField id="dateUnknown" value="{!Incident__c.Unknown_Date_Occurred__c}" 
                       	html-data-rules="{&quot;0&quot;: &quot;DateOccurred&quot;}"
                       	html-data-visibility-rules="{&quot;0&quot;: [&quot;{!$Component.generalInfoBlock.incidentTimingSection.timeSectionItem.occurredApproximate}&quot;, &quot;{!$Component.generalInfoBlock.incidentTimingSection.timeSectionItem.occurredApproximateLabel}&quot;, &quot;{!$Component.generalInfoBlock.incidentTimingSection.timeSectionItem.DateOccurred}&quot;]}"/>                       
                       	<apex:outputLabel value="Date/Time Currently Unknown" for="dateUnknown"  styleClass="sub-question-header" id="dateUnknownLabel"/>
                       </div>    
                       <div>
                       	<apex:inputField id="occurredApproximate" value="{!Incident__c.Occurred_Time_is_Approximate__c}" /><apex:outputLabel Value="Time is Approximate" for="occurredApproximate" styleClass="sub-question-header" id="occurredApproximateLabel" />
                       </div>                             
                   </apex:outputPanel>
               </apex:pageBlockSectionItem>  
                <apex:pageBlockSectionItem >
                    <apex:outputLabel >First Reported to The MENTOR Network By</apex:outputLabel>
                    <apex:outputPanel >
                  		<apex:inputField id="first_reported_by" onchange="evalFirstReportedField(this);" html-data-visibility-rules2="{&quot;Employee&quot;: [&quot;{!$Component.specify_emp_label}&quot;, &quot;{!$Component.specify_emp_input}&quot;], 
                  					&quot;Mentor&quot;: [&quot;specify_mentor_label&quot;, &quot;{!$Component.specify_mentor_input}&quot;],
                  					&quot;External Party&quot;: [&quot;{!$Component.specify_exp_label}&quot;, &quot;{!$Component.specify_exp_input}&quot;]}" 
                  			value="{!Incident__c.First_Reported_By__c}" / >
                  		
                    		<apex:outputPanel id="specify_emp_label"  styleClass="sub-question-wrapper" layout="block"><apex:outputLabel styleClass="sub-question-header">Specify Employee</apex:outputLabel>
                    			<apex:inputField id="specify_emp_input" value="{!Incident__c.First_Reported_Staff__c}" />
                    		</apex:outputPanel>

                    		<div id="specify_mentor_label" class="sub-question-wrapper"><apex:outputLabel styleClass="sub-question-header">Specify Mentor</apex:outputLabel>
                    			<apex:inputField id="specify_mentor_input" value="{!Incident__c.First_Reported_Mentor__c }" />
							</div>                    	
                    		<apex:outputPanel id="specify_exp_label"  styleClass="sub-question-wrapper" layout="block"><apex:outputLabel styleClass="sub-question-header">Specify External Party</apex:outputLabel>
                    			<apex:inputField id="specify_exp_input" value="{!Incident__c.External_Party__c}" />                    		
                    		</apex:outputPanel>
                    </apex:outputPanel>                    
                </apex:pageBlockSectionItem>                           
               <apex:pageBlockSectionItem >
               		<apex:outputPanel >
               			<apex:outputLabel value="Date/Time Incident First Reported to The MENTOR Network" />               			
               		</apex:outputPanel>
               		<apex:outputPanel >
               			<c:MilitaryDatetime id="dateReportedmilitary" shiftTop="20" datetimeval="{!Incident__c.Date_Reported__c}" edit="true" hiddenFieldId="DateReported" datetimepickerid="DateReported"/>
               			<apex:inputHidden value="{!Incident__c.Date_Reported__c}" id="DateReported" />
               			<div>
               			<apex:inputField id="First_Reported_Time_is_Approximate" value="{!Incident__c.First_Reported_Time_is_Approximate__c}" /><apex:outputLabel styleClass="sub-question-header" for="First_Reported_Time_is_Approximate" value="Time is Approximate"  />
               			</div>
               		</apex:outputPanel>
               </apex:pageBlockSectionItem>       		
			</apex:pageBlockSection>
       		<apex:pageBlockSection id="incidentLocationSection" title="Incident Location" columns="1" showHeader="true" collapsible="false" >	
                <apex:pageBlockSectionItem id="incidentLocationItem" helptext=" Select 'Residence' if the incident occurred at a Group Home, SNF, CLF, or Supported Living faciliy" >
                    <apex:outputLabel >Where did the incident occur?</apex:outputLabel>
                    <apex:outputPanel >
 						<apex:inputField value="{!Incident__c.Where_incident_occurred__c }" id="whereOccurred"
 						 		html-data-visibility-rules="{&quot;Community Location&quot;: [&quot;{!$Component.generalInfoBlock.incidentLocationSection.incidentLocationItem.communityLocation_label}&quot;, &quot;{!$Component.generalInfoBlock.incidentLocationSection.incidentLocationItem.communityLocation_input}&quot;],
										&quot;Other Location&quot;: [&quot;{!$Component.otherIncidentLocation_label}&quot;, &quot;{!$Component.otherIncidentLocation_input}&quot;],
										&quot;Day Program&quot;: [&quot;{!$Component.incident_nettype_input}&quot;, &quot;{!$Component.incident_nettype_label}&quot;], 
										&quot;Program Office&quot;: [&quot;{!$Component.incident_nettype_input}&quot;, &quot;{!$Component.incident_nettype_label}&quot;], 
										&quot;Residence&quot;: [&quot;{!$Component.incident_nettype_input}&quot;, &quot;{!$Component.incident_nettype_label}&quot;], 
										&quot;School&quot;: [&quot;{!$Component.incident_nettype_input}&quot;, &quot;{!$Component.incident_nettype_label}&quot;], 
										&quot;Residence&quot;: [&quot;{!$Component.incident_nettype_input}&quot;, &quot;{!$Component.incident_nettype_label}&quot;], 										 
                  						&quot;Vehicle&quot;: [&quot;{!$Component.incident_nettype_input}&quot;, &quot;{!$Component.incident_nettype_label}&quot;]}" />
                    		<apex:outputPanel id="communityLocation_label" styleClass="sub-question-wrapper" layout="block"><apex:outputLabel styleClass="labelCol, sub-question-header">Specify Community Location</apex:outputLabel>
                    			<apex:inputField id="communityLocation_input" value="{!Incident__c.Community_Location__c }" />                    		
                    		</apex:outputPanel>
                    		<apex:outputPanel id="otherIncidentLocation_label" styleClass="sub-question-wrapper" layout="block"><apex:outputLabel styleClass="labelCol, sub-question-header">Specify Other Location</apex:outputLabel>
                    			<apex:inputField id="otherIncidentLocation_input" value="{!Incident__c.Other_Location__c }"  />                   		
                    		</apex:outputPanel>  
                    		
                    		<apex:outputPanel id="incident_nettype_label" styleClass="sub-question-wrapper" layout="block"><apex:outputLabel styleClass="labelCol, sub-question-header">Type</apex:outputLabel>
                    			<apex:inputField id="incident_nettype_input" value="{!Incident__c.Network_Type__c}"  />                   		
                    		</apex:outputPanel>                      		                  		                    	
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>         			
       		</apex:pageBlockSection>
       		
       		
        </apex:pageBlock>
        
        <apex:pageBlock mode="mainDetail" id="mainBlock" >
            <apex:pageBlockSection Title="Incident Type" columns="2" id="section1"  collapsible="false">
         
 				<apex:pageBlockSectionItem rendered="false" >
                    <apex:outputLabel >Was the Person Being Served hospitalized?</apex:outputLabel>
                    <apex:outputPanel >
                 		<apex:inputField value="{!Incident__c.Hospitalized__c}" html-data-visibility-rules="{&quot;Yes&quot;: [&quot;{!$Component.hosp_type}&quot;, &quot;{!$Component.hosp_type_label}&quot;]}" />
                 		<apex:outputLabel id="hosp_type_label" styleClass="sub-question-header">Type</apex:outputLabel>
                 		<apex:inputField id="hosp_type" value="{!Incident__c.Hospitalization_Type__c}" />
                    </apex:outputPanel>
                </apex:pageBlockSectionItem>   
                <apex:pageBlockSectionItem rendered="false" >
                    <apex:outputLabel >Was the Person Being Served Arrested/Detained?</apex:outputLabel>
                    <apex:outputPanel >
                 		<apex:inputField value="{!Incident__c.PBS_Arrested__c}" html-data-visibility-rules="{&quot;Yes&quot;: [&quot;{!$Component.pbs_arrested_label}&quot;, &quot;{!$Component.pbs_arrested}&quot;]}" />
                 		<apex:outputLabel id="pbs_arrested_label" styleClass="sub-question-header">Reason Known?</apex:outputLabel>
                 		<apex:inputField id="pbs_arrested" value="{!Incident__c.PBS_Arrest_Reason_Known__c}" />
                    </apex:outputPanel>
                </apex:pageBlockSectionItem> 
                                             

                <apex:outputPanel >
                	<apex:outputLabel styleClass="sub-question-header" style="font-size: 91%; display: block;">Which of the following describe the events?</apex:outputLabel>
                	<apex:outputPanel layout="block" style="float: left; padding-left: 100px;">
                		<apex:inputField style="padding-left: 10px;" label="Which of the following describe the events?" value="{!Incident__c.Incident_Type__c}" />
                	</apex:outputPanel>
				</apex:outputPanel>
			</apex:pageBlockSection>	 
			<apex:pageBlockSection title="First Response" columns="2" collapsible="false">	
                <apex:outputPanel >
                    <apex:outputLabel styleClass="sub-question-header" style="font-size: 91%; display: block;">First Response Action Taken</apex:outputLabel>
                    <apex:outputPanel layout="block" style="float: left; padding-left: 100px;">
                		<apex:inputField value="{!Incident__c.First_Response_Action_Taken__c}" html-data-visibility-rules="{&quot;Other&quot;: [&quot;{!$Component.first_res_other_label}&quot;, &quot;{!$Component.first_res_other_input}&quot;]}" />
                 		<br/>
                 		<apex:outputLabel id="first_res_other_label" styleClass="sub-question-header">Other</apex:outputLabel>
                 		<apex:inputField id="first_res_other_input" value="{!Incident__c.First_Response_Action_Taken_Other__c}" />
                    </apex:outputPanel>
                </apex:outputPanel>  
                
                <apex:outputPanel /> 
				
			</apex:pageBlockSection>	
			<apex:pageBlockSection title="People Involved" columns="2" collapsible="false">	
  
                <apex:pageBlockSectionItem >
                	<apex:outputLabel >Staff present at the time of the Incident?</apex:outputLabel>
                	<apex:outputPanel >
                		<apex:inputField label="Staff present at the time of the Incident?" value="{!Incident__c.Staff_Present__c }" 
                			html-data-visibility-rules="{&quot;Yes&quot;: [&quot;staff_label&quot;, &quot;staff_input&quot;]}" />                 	
                		
                	</apex:outputPanel>
                </apex:pageBlockSectionItem>                 
                    
                    <apex:outputPanel >
                    <span id="staff_label" ><apex:outputLabel style="color: blue; cursor:pointer;">Add Staff</apex:outputLabel></span>
                    <div id="staff_input">
						info
                    </div>
                    </apex:outputPanel>



                <apex:inputField label="Mentor present at the time of the incident?" value="{!Incident__c.Mentor_present__c}" 
                	html-data-visibility-rules="{&quot;Yes&quot;: [&quot;mentor_label&quot;, &quot;mentor_input&quot;]}"/>
                <apex:pageBlockSectionItem >
                    <apex:outputPanel >
                    <div id="mentor_label" ><apex:outputLabel style="color: blue; cursor:pointer;">Add Staff</apex:outputLabel></div>
                    <div id="mentor_input">
						info
                    </div>
                    </apex:outputPanel>
                </apex:pageBlockSectionItem> 

                 <apex:pageBlockSectionItem helpText="Do not enter the full name of any other Person being Served involved in the incident. Initials are OK." >
                    <apex:outputLabel >Others present at the time of the incident?</apex:outputLabel>
                    <apex:outputPanel >
                 		<apex:inputField value="{!Incident__c.Others_Present_at_Time_of_Incident__c}" html-data-visibility-rules="{&quot;Yes&quot;: [&quot;{!$Component.other_people_label}&quot;, &quot;{!$Component.other_people_input}&quot;]}" />

                    </apex:outputPanel>
                </apex:pageBlockSectionItem>   
                <apex:outputPanel >
                 		<apex:outputLabel id="other_people_label" styleClass="sub-question-header">Other</apex:outputLabel>
                 		<apex:inputField id="other_people_input" value="{!Incident__c.Other_people__c}" />                
                </apex:outputPanel>             
                
			</apex:pageBlockSection>	
			<apex:pageBlockSection columns="2" rendered="false">					
    
                <apex:inputField label="Incident Level" value="{!Incident__c.Incident_Level__c}" />  
                <apex:outputPanel />    
                <apex:inputField label="Incident Type-Detailed list" value="{!Incident__c.Incident_Type_Detail__c}" /> 
                <apex:outputPanel /> 
                <apex:inputField label="Was an Internal Investigation initiated?" value="{!Incident__c.Internal_Investigation__c }" />
                <apex:outputPanel /> 
                <apex:inputField label="Incident Outcome" value="{!Incident__c.Incident_Outcome__c}" />
                
                
                <apex:pageBlockSectionItem />
                <apex:pageBlockSectionItem />
                <!-- 
                <apex:inputField value="{!Incident__c.Location__c}" />
                
                <apex:inputField value="{!Incident__c.Operating_Group__c}" />
                <apex:inputField value="{!Incident__c.Original_Incident__c }" />                
                <apex:inputField value="{!Incident__c.Supervised__c }" />
                <apex:inputField value="{!Incident__c.Prior_Revision__c }" />               
                <apex:inputField value="{!Incident__c.State__c }" />
                <apex:inputField value="{!Incident__c.Status__c }" />
                    --->                   
                
                                        
            
            </apex:pageBlockSection>
        </apex:pageBlock>
    </apex:pageBlock>
    <!--     Use this for All ajax calls on this page -->
    <apex:actionStatus id="pageProcessing">
		<apex:facet name="start">
			<div style="opacity:0.8; background-color:#ccc; position:fixed; width:100%; height:100%; top:0px; left:0px; z-index:100;"/>
			<div style="position: fixed; left:50%; top:50%; background-color: white; border: 2px solid gray; padding: 2px; z-index: 200;">
					<span><img class="waitingImage" src="/img/loading.gif" title="Please Wait..." /> Processing . . . </span>
				</div>
			</apex:facet>
		<apex:facet name="stop" />
	</apex:actionStatus>
</apex:form>
</apex:page>