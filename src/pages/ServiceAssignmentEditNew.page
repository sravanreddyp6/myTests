<apex:page standardController="Service_Assignment__c" extensions="ServiceAssignmentExt" standardStylesheets="true" sidebar="false" tabStyle="Persons_Being_Served_New__tab" showheader="true">
<apex:stylesheet value="{!$Resource.mentoresdcss}" />
<apex:stylesheet value="{!$Resource.pbscardcss}" />
<apex:includeScript value="{!URLFOR($Resource.jquery, '/js/jquery-1.7.2.min.js')}" />
<apex:includeScript value="{!URLFOR($Resource.jquery, 'js/jquery-ui-1.8.21.custom.min.js')}"/>
<apex:stylesheet value="{!URLFOR($Resource.jquery, 'css/custom-theme/jquery-ui-1.8.21.custom.css')}"/>
<c:PersonalRecord pbsId="{!admission.Person_Being_Served__c}" servAssignId="{!theServAssign.Id}" parentPage="ServAssign" servAssignNew="{!newSA}" admId="{!admissionId}"  />
<script>
    $j = jQuery.noConflict();
    
    function SetHiddenPhase(thePhase)
    {
        $j('input[id$=phaseToSave]').val(thePhase);
    }
    
</script>
<apex:pagemessages />
<br />
<apex:form id="myFRM">
<!-- To set focus on Top -->
<input id="hiddenElementId" type="hidden" />

<apex:inputHidden id="phaseToSave" value="{!theServAssign.Phase__c}" />

     <apex:pageBlock mode="detail" title="Service Assignment{!if(editSA==true,' Edit','')}" rendered="{!!AssessmentOnly}">

      <div class="pbHeaderButton">
          <apex:commandButton value="Edit" action="{!EditServAssign}" rendered="{!!editSA}" />
          <apex:commandButton value="Save" action="{!SaveServAssign}" rendered="{!editSA}" />
          &nbsp;
          <apex:commandButton value="Reset" action="{!ResetPage}" rendered="{!editSA}" />
          &nbsp;
          <apex:commandButton value="Cancel" immediate="true" action="{!CancelServAssignEditNew}" rendered="{!editSA}" />
      </div>
    <apex:pageBlockSection id="ServAssignDetail" columns="1" collapsible="false" title="Service Assignment Detail">
        <apex:outputField value="{!theServAssign.Admission__c}" rendered="{!!editSA}" />
        <apex:outputField value="{!theServAssign.Admission__c}" rendered="{!editSA}" />
        <apex:outputField value="{!theServAssign.Name}" rendered="{!!editSA}" />
        <apex:outputField value="{!theServAssign.Name}" rendered="{!editSA}" />
        <apex:outputField value="{!theServAssign.Status__c}" rendered="{!!editSA}"  />
        <apex:inputField value="{!theServAssign.Status__c}" rendered="{!editSA}"  />
        <apex:outputField value="{!theServAssign.Start_Date__c}" rendered="{!!editSA}"  />
        <apex:inputField value="{!theServAssign.Start_Date__c}" required="true" rendered="{!editSA}"  />
        <apex:outputField value="{!theServAssign.Projected_Treatment_End_Date__c}" rendered="{!!editSA}"  />
        <apex:inputField value="{!theServAssign.Projected_Treatment_End_Date__c}" rendered="{!editSA}"  />
        <apex:outputField value="{!theServAssign.End_Date__c}" rendered="{!!editSA}"  />
        <apex:inputField value="{!theServAssign.End_Date__c}" rendered="{!editSA}"  />
        <apex:outputField value="{!theServAssign.Program_Detail__c}" rendered="{!!editSA}"  />
        <apex:inputField value="{!theServAssign.Program_Detail__c}" rendered="{!editSA}"  />
    </apex:pageBlockSection>

    <hr />
    <apex:pageBlockSection title="Contract Association"
                             showHeader="true"
                             columns="3"
                             collapsible="false"
                             id="ContractAssoc">
            <apex:pageBlockTable value="{!contractRows}" var="c" id="ContractTable">
                <apex:column headerValue="Select" >
                    <apex:inputCheckbox value="{!c.selectedContract}" disabled="{!!editSA}">
                         <!-- <apex:actionSupport event="onchange" reRender="myFRM" status="
                         "  action="{!saveContractSelections}"/> -->
                    </apex:inputCheckbox>
                </apex:column>
                <apex:column value="{!c.theContract.Name}" />
            </apex:pageBlockTable>
    </apex:pageBlockSection>
    <hr />
    <apex:pageBlockSection title="Program Association"
                             showHeader="true"
                             columns="1"
                             collapsible="false"
                             id="ProgAssocViewNEW"
                             rendered="{!!editSA}" >
                <apex:outputText value="{!theServAssign.Program__c}" />
                <apex:outputText value="{!theServAssign.Location_Region__c}" />
                <apex:outputText value="{!theServAssign.Service_Line__c}" />
        <apex:outputPanel id="ProgAssocPanelView2NEW" layout="block" styleClass="col" rendered="{!!editSA}" >
            <apex:pageBlockTable value="{!programRows}" var="pR" id="ProgramAssocTableNEW" rendered="{!theServAssign.Program__c=='IFCS'}">
                <apex:column headerValue="{!IF(editSA,'Select','Selected')}">
                    <apex:outputPanel rendered="{!(pR.paPhase<>999 && pR.paPhase==theServAssign.Phase__c)}">
                        <input type="radio" name="phaseRadio" checked="checked" disabled="true" />
                    </apex:outputPanel>
                    <apex:outputPanel rendered="{!(pR.paPhase<>999 && pR.paPhase<>theServAssign.Phase__c)}">
                        <input type="radio" name="phaseRadio" disabled="true" />
                    </apex:outputPanel>
                </apex:column>
                <apex:column headerValue="Phase of Treatment">
                    {!IF(pR.paPhase==999,"Total",pR.paPhase)}
                </apex:column>   
                <apex:column headerValue="# Docs Received" value="{!pR.paNumDocsReceived}" />
                <apex:column headerValue="# Docs Expected" value="{!pR.paNumDocsExpected}" />
                <apex:column headerValue="% Complete" value="{!pR.paPhasePercentage}" />
                    <apex:column headerValue="Start Date">
                         <apex:outputField value="{!theServAssign.Phase_1_Start_Date__c}" rendered="{!pR.paPhase==1}" />
                         <apex:outputField value="{!theServAssign.Phase_2_Start_Date__c}" rendered="{!pR.paPhase==2}" />
                         <apex:outputField value="{!theServAssign.Phase_3_Start_Date__c}" rendered="{!pR.paPhase==3}" />
                         <apex:outputField value="{!theServAssign.Phase_4_Start_Date__c}" rendered="{!pR.paPhase==4}" />
                    </apex:column>
                    <apex:column headerValue="End Date">
                         <apex:outputField value="{!theServAssign.Phase_1_End_Date__c}" rendered="{!pR.paPhase==1}" />
                         <apex:outputField value="{!theServAssign.Phase_2_End_Date__c}" rendered="{!pR.paPhase==2}" />
                         <apex:outputField value="{!theServAssign.Phase_3_End_Date__c}" rendered="{!pR.paPhase==3}" />
                         <apex:outputField value="{!theServAssign.Phase_4_End_Date__c}" rendered="{!pR.paPhase==4}" />
                    </apex:column>                      
            </apex:pageBlockTable>
        </apex:outputPanel>
    </apex:pageBlockSection>
    <apex:pageBlockSection title="Program Association"
                             showHeader="true"
                             columns="1"
                             collapsible="false"
                             id="ProgAssoc"
                             rendered="{!editSA}">       
            <apex:outputPanel id="ProgAssocPanelEdit" layout="block" styleClass="col" rendered="{!editSA}" > 
                <apex:actionStatus id="myStatus">
                        <apex:facet name="start">
                            <div class="waitingHolder" style="display: inline; margin-left: 5px; position: relative; top: 5px;">
                                <img class="waitingImage" src="/img/loading.gif" title="Please Wait..." /> <span class="waitingDescription"></span>
                            </div>
                        </apex:facet>
                        <apex:facet name="stop">
                            <apex:pageBlockSection columns="1" >
                                <apex:selectList size="1" id="ProgramSelect" label="Program" value="{!currentProgram}">
                                    <apex:actionSupport event="onchange" action="{!changeToProgramLocationServiceLine}" reRender="LocationSelect,ServiceLineSelect,ServCodeSelect" status="myStatus">
                                        <apex:param assignTo="{!currentLocation}" value="" />
                                        <apex:param assignTo="{!currentServiceLine}" value="" />
                                    </apex:actionSupport>
                                    <apex:selectOptions value="{!MyPrograms}"/>            
                                </apex:selectList>        
                                <!-- rendered="{!IF(SelectedProgram != '',True,False)}" -->
                                <apex:selectList size="1" id="LocationSelect" label="Location" value="{!currentLocation}">
                                    <apex:actionSupport event="onchange" action="{!changeToProgramLocationServiceLine}" reRender="ServiceLineSelect,ServCodeSelect"  status="myStatus">
                                        <apex:param assignTo="{!currentProgram}" value="{!currentProgram}" />
                                        <apex:param assignTo="{!currentServiceLine}" value="" />
                                    </apex:actionSupport>
                                    <apex:selectOptions value="{!MyLocations}"/>
                                </apex:selectList>
                                                
                                <apex:selectList size="1" id="ServiceLineSelect" label="Service Line" value="{!currentServiceLine}">
                                    <apex:actionSupport event="onchange" action="{!changeToProgramLocationServiceLine}" reRender="ServiceLineSelect,ServCodeSelect" status="myStatus">
                                        <apex:param assignTo="{!currentProgram}" value="{!currentProgram}" />
                                        <apex:param assignTo="{!currentLocation}" value="{!currentLocation}" />
                                    </apex:actionSupport>
                                    <apex:selectOptions value="{!MyServiceLines}"/>
                                </apex:selectList>  
                           <!--     
                                <apex:selectList size="1" id="PhaseSelect" label="Phase" value="{!theServAssign.Phase__c}" rendered="{!!newSa}">
                                    <apex:actionSupport event="onchange" rerender="ProgAssocPanelView2" />
                                    <apex:selectOptions value="{!phaseSelectOptions}" />
                                </apex:selectList>
                           -->     
                            </apex:pageBlockSection>
                        </apex:facet>
                </apex:actionStatus>
                <apex:pageBlockTable value="{!programRows}" var="pR" id="ProgramAssocTableNEW" rendered="{!theServAssign.Program__c=='IFCS'}">
                    <apex:column headerValue="{!IF(editSA,'Select','Selected')}">
                        <apex:outputPanel rendered="{!(pR.paPhase<>999 && pR.paPhase==theServAssign.Phase__c)}">
                            <input id="PhaseRadio" name="PhaseRadioEdit" type="radio" value="{!theServAssign.Phase__c}" onclick="SetHiddenPhase({!pR.paPhase});" checked="checked" />
                        </apex:outputPanel>
                        <apex:outputPanel rendered="{!(pR.paPhase<>999 && pR.paPhase<>theServAssign.Phase__c)}">
                            <input id="PhaseRadio" name="PhaseRadioEdit" type="radio" value="{!theServAssign.Phase__c}" onclick="SetHiddenPhase({!pR.paPhase});" />
                        </apex:outputPanel>
                    </apex:column>
                    <apex:column headerValue="Phase of Treatment">
                        {!IF(pR.paPhase==999,"Total",pR.paPhase)}
                    </apex:column>   
                    <apex:column headerValue="# Docs Received" value="{!pR.paNumDocsReceived}" />
                    <apex:column headerValue="# Docs Expected" value="{!pR.paNumDocsExpected}" />
                    <apex:column headerValue="% Complete" value="{!pR.paPhasePercentage}" />
                    <apex:column headerValue="Start Date">
                         <apex:inputField value="{!theServAssign.Phase_1_Start_Date__c}" rendered="{!pR.paPhase==1}" />
                         <apex:inputField value="{!theServAssign.Phase_2_Start_Date__c}" rendered="{!pR.paPhase==2}" />
                         <apex:inputField value="{!theServAssign.Phase_3_Start_Date__c}" rendered="{!pR.paPhase==3}" />
                         <apex:inputField value="{!theServAssign.Phase_4_Start_Date__c}" rendered="{!pR.paPhase==4}" />
                    </apex:column>
                    <apex:column headerValue="End Date">
                         <apex:inputField value="{!theServAssign.Phase_1_End_Date__c}" rendered="{!pR.paPhase==1}" />
                         <apex:inputField value="{!theServAssign.Phase_2_End_Date__c}" rendered="{!pR.paPhase==2}" />
                         <apex:inputField value="{!theServAssign.Phase_3_End_Date__c}" rendered="{!pR.paPhase==3}" />
                         <apex:inputField value="{!theServAssign.Phase_4_End_Date__c}" rendered="{!pR.paPhase==4}" />
                    </apex:column>                     
                </apex:pageBlockTable>
             </apex:outputPanel>

                
    </apex:pageBlockSection>
    <hr />
    <apex:pageBlockSection title="Service Code Selection"
                             showHeader="true"
                             columns="2"
                             collapsible="false"
                             id="ServCodeSelect">
              <apex:outputPanel layout="block" styleClass="col" rendered="{!OR(currentProgram=='',currentLocation=='',currentServiceLine=='')}">
                  You must select a Program, Location, and Service Line for this Service Assignment before you can select a Service Code.
              </apex:outputPanel>
              <apex:outputPanel layout="block" styleClass="col" rendered="{!AND(currentProgram!='',currentLocation!='',currentServiceLine!='')}" >      
                <apex:actionStatus id="addStatus">
                     <apex:facet name="start">
                        <div class="waitingHolder" style="display: inline; margin-left: 5px; position: relative; top: 5px;">
                            <img class="waitingImage" src="/img/loading.gif" title="Please Wait..." /> <span class="waitingDescription"></span>
                        </div>
                    </apex:facet>
                    <apex:facet name="stop"> 
                    <apex:pageBlockTable value="{!AvailableCodes}" var="aCodes">
                        <apex:column >
                            <apex:commandButton value="Add" action="{!AddCode}" reRender="ServCodeSelect"  status="addStatus" rendered="{!editSA}">
                                <apex:param assignTo="{!SelectedCodeID}" name="SelectedCodeID" value="{!AvailableCodes[aCodes].Id}"/>
                            </apex:commandButton>
                        </apex:column>
        
                        <apex:column headerValue="Available Service Codes" value="{!AvailableCodes[aCodes].Service_Value__c}"/> 
                        <apex:column headerValue="Program" value="{!AvailableCodes[aCodes].Program__c}"/>
                        <apex:column headerValue="Start Date">
                            <apex:outputText value="{0, date, MM/dd/yyyy}">
                                <apex:param value="{!AvailableCodes[aCodes].Start_Date__c}" /> 
                            </apex:outputText>
                        </apex:column>
                        <apex:column headerValue="End Date" >
                                  <apex:outputText value="{0, date, MM/dd/yyyy}">
                                  <apex:param value="{!AvailableCodes[aCodes].End_Date__c}" />
                                 </apex:outputText>
            
                        <!-- used to inspect source code to get the ID of the record being displayed, display should be none;-->
                            <apex:outputPanel style="display: none;">{!AvailableCodes[aCodes].id}</apex:outputPanel> 
                        </apex:column>                
                                          
                    </apex:pageBlockTable>  
                 </apex:facet>
                 </apex:actionStatus>
            </apex:outputPanel> 
            <apex:outputPanel layout="block" styleClass="col" rendered="{!AND(currentProgram!='',currentLocation!='',currentServiceLine!='')}"> 
                <apex:actionStatus id="removeStatus">
                     <apex:facet name="start">
                        <div class="waitingHolder" style="display: inline; margin-left: 5px; position: relative; top: 5px;">
                            <img class="waitingImage" src="/img/loading.gif" title="Please Wait..." /> <span class="waitingDescription"></span>
                        </div>
                    </apex:facet>
                    <apex:facet name="stop">                   
                        <apex:pageBlockTable value="{!SelectedCodes}" var="Code">
                            <apex:column headerValue="Selected Service Codes" value="{!SelectedCodes[Code].Service_Value__c}">
                            </apex:column>  
                            <apex:column headerValue="Start Date">
                            <apex:outputText value="{0, date, MM/dd/yyyy}">
                                <apex:param value="{!SelectedCodes[Code].Start_Date__c}" />
                            </apex:outputText>
                            </apex:column>
                            <apex:column headerValue="End Date" >
                            <apex:outputText value="{0, date, MM/dd/yyyy}">
                                <apex:param value="{!SelectedCodes[Code].End_Date__c}" />
                            </apex:outputText>
                 
                            <!-- used to inspect source code to get the ID of the record being displayed, display should be none;-->
                                <apex:outputPanel style="display: none;">Service Code ID {!SelectedCodes[Code].Id}</apex:outputPanel> 
                                <apex:outputPanel style="display: none;">JO ID {!SelectedCodes[Code].id}</apex:outputPanel> 
                                
                            </apex:column>                                 
                            <apex:column >
                                <apex:commandButton value="Remove" action="{!RemoveCode}" reRender="ServCodeSelect" status="removeStatus" rendered="{!editSA}">
                                    <apex:param assignTo="{!SelectedCodeId}" name="SelectedCodeId" value="{!SelectedCodes[Code].Id}" />
                                    <apex:param assignTo="{!SelectedCodeKey}" name="SelectedCodeKey" value="{!Code}" />
                                </apex:commandButton> 
                            </apex:column>
                        </apex:pageBlockTable>
                    </apex:facet>  
                </apex:actionStatus>
            </apex:outputPanel>       
    </apex:pageBlockSection>
    <hr />
    <apex:pageBlockSection title="System Information"
                             showHeader="true"
                             columns="2"
                             collapsible="false"
                             id="ServAssignSystemInfo">
        <apex:outputPanel >
            <apex:outputLabel value="Created By" for="CreatedByLink" style="font-size: 75%;font-family: 'Arial','Helvetica',sans-serif; font-weight:bold;" />&nbsp;&nbsp;<apex:outputLink id="CreatedByLink" value="/{!Service_Assignment__c.CreatedBy.Id}">{!Service_Assignment__c.CreatedBy.Name}</apex:outputLink> 
            <apex:outputText value=", " rendered="{!Service_Assignment__c.CreatedDate!=null}" />
            <apex:outputText value="{0,date,MM'/'dd'/'yyyy' 'h':'mm' 'a}">
                <apex:param value="{!Service_Assignment__c.CreatedDate}" /> 
            </apex:outputText>
        </apex:outputPanel>
        <apex:outputPanel >
            <apex:outputLabel style="font-size: 75%;font-family: 'Arial','Helvetica',sans-serif; font-weight:bold;" value="Last Modified By" for="LastModifiedByLink" />&nbsp;&nbsp;<apex:outputLink id="LastModifiedByLink" value="/{!Service_Assignment__c.LastModifiedBy.Id}">{!Service_Assignment__c.LastModifiedBy.Name}</apex:outputLink>
            <apex:outputText value=", " rendered="{!Service_Assignment__c.LastModifiedDate!=null}" />
            <apex:outputText value="{0,date,MM'/'dd'/'yyyy' 'h':'mm' 'a}">
                <apex:param value="{!Service_Assignment__c.LastModifiedDate}" /> 
            </apex:outputText>
        </apex:outputPanel>
    </apex:pageBlockSection>
    
<!-- START:  Uncomment to have the element collapsed by default
    <script>
        twistSection(document.getElementById('{!$Component.block1.section1}').getElementsByTagName('img')[0])
    </script>
    
END: Uncomment to have the element collapsed by default -->

</apex:pageBlock>

<apex:pageBlock mode="detail" title="Service Assignment{!if(editSA==true,' Edit','')}" rendered="{!AssessmentOnly}">

      <div class="pbHeaderButton">
          <apex:commandButton value="Edit" action="{!EditServAssign}" rendered="{!!editSA}" />
          <apex:commandButton value="Save" action="{!SaveServAssign}" rendered="{!editSA}" rerender="myFRM" />
          &nbsp;
          <apex:commandButton value="Reset" action="{!ResetPage}" rendered="{!editSA}" />
          &nbsp;
          <apex:commandButton value="Cancel" immediate="true" action="{!CancelServAssignEditNew}" rendered="{!editSA}" />
      </div>
    <apex:pageBlockSection id="AOServAssignDetail" columns="1" collapsible="false" title="Service Assignment Detail">
        <apex:outputField value="{!theServAssign.Admission__c}" rendered="{!!editSA}" />
        <apex:outputField value="{!theServAssign.Admission__c}" rendered="{!editSA}" />
        <apex:outputField value="{!theServAssign.Name}" rendered="{!!editSA}" />
        <apex:outputField value="{!theServAssign.Name}" rendered="{!editSA}" />
        <apex:outputField value="{!theServAssign.Status__c}" rendered="{!!editSA}"  />
        <apex:inputField value="{!theServAssign.Status__c}" rendered="{!editSA}"  />
        <apex:outputField value="{!theServAssign.Start_Date__c}" rendered="{!!editSA}"  />
        <apex:inputField value="{!theServAssign.Start_Date__c}" required="true" rendered="{!editSA}"  />
        <apex:outputField value="{!theServAssign.Projected_Treatment_End_Date__c}" rendered="{!!editSA}"  />
        <apex:inputField value="{!theServAssign.Projected_Treatment_End_Date__c}" rendered="{!editSA}"  />
        <apex:outputField value="{!theServAssign.End_Date__c}" rendered="{!!editSA}"  />
        <apex:inputField value="{!theServAssign.End_Date__c}" rendered="{!editSA}"  />
        <apex:outputField value="{!theServAssign.Outcomes__c}" rendered="{!!editSA}"  />
        <apex:inputField value="{!theServAssign.Outcomes__c}" rendered="{!editSA}"  />        
    </apex:pageBlockSection>

    <hr />
    <apex:pageBlockSection title="Program Association"
                             showHeader="true"
                             columns="1"
                             collapsible="false"
                             id="ProgAssoc">       
            <apex:outputPanel id="ProgAssocPanelView" layout="block" styleClass="col" rendered="{!!editSA}" >
                <apex:outputLabel for="ProgramField" title="Program" value="Program " style="font-weight:bold" />
                <apex:outputField id="ProgramField" value="{!theServAssign.Program__c}" /><br />
                <apex:outputLabel for="LocationField" title="Program" value="Location " style="font-weight:bold;" />
                <apex:outputField id="LocationField" value="{!theServAssign.Location_Region__c}" /><br />
                <apex:outputLabel for="ServLineField" title="Program" value="Service Line " style="font-weight:bold;" />
                <apex:outputField id="ServLineField" value="{!theServAssign.Service_Line__c}" />
            </apex:outputPanel>
            <apex:outputPanel id="ProgAssocPanelEdit" layout="block" styleClass="col" rendered="{!editSA}" > 
                <apex:actionStatus id="myStatus">
                        <apex:facet name="start">
                            <div class="waitingHolder" style="display: inline; margin-left: 5px; position: relative; top: 5px;">
                                <img class="waitingImage" src="/img/loading.gif" title="Please Wait..." /> <span class="waitingDescription"></span>
                            </div>
                        </apex:facet>
                        <apex:facet name="stop">
                            <apex:pageBlockSection columns="1" >
                                <apex:selectList size="1" id="ProgramSelect" label="Program" value="{!currentProgram}">
                                    <apex:actionSupport event="onchange" action="{!changeToProgramLocationServiceLine}" reRender="LocationSelect,ServiceLineSelect,ServCodeSelect" status="myStatus">
                                        <apex:param assignTo="{!currentLocation}" value="" />
                                        <apex:param assignTo="{!currentServiceLine}" value="" />
                                    </apex:actionSupport>
                                    <apex:selectOptions value="{!MyPrograms}"/>            
                                </apex:selectList>        
                                <!-- rendered="{!IF(SelectedProgram != '',True,False)}" -->
                                <apex:selectList size="1" id="LocationSelect" label="Location" value="{!currentLocation}">
                                    <apex:actionSupport event="onchange" action="{!changeToProgramLocationServiceLine}" reRender="ServiceLineSelect,ServCodeSelect"  status="myStatus">
                                        <apex:param assignTo="{!currentProgram}" value="{!currentProgram}" />
                                        <apex:param assignTo="{!currentServiceLine}" value="" />
                                    </apex:actionSupport>
                                    <apex:selectOptions value="{!MyLocations}"/>
                                </apex:selectList>
                                                
                                <apex:selectList size="1" id="ServiceLineSelect" label="Service Line" value="{!currentServiceLine}">
                                    <apex:actionSupport event="onchange" action="{!changeToProgramLocationServiceLine}" reRender="ServiceLineSelect,ServCodeSelect" status="myStatus">
                                        <apex:param assignTo="{!currentProgram}" value="{!currentProgram}" />
                                        <apex:param assignTo="{!currentLocation}" value="{!currentLocation}" />
                                    </apex:actionSupport>
                                    <apex:selectOptions value="{!MyServiceLines}"/>
                                </apex:selectList>  
                                      
                            </apex:pageBlockSection>
                        </apex:facet>
                </apex:actionStatus>
             </apex:outputPanel>

                
    </apex:pageBlockSection>
    <hr />
    <apex:pageBlockSection title="Service Code Selection"
                             showHeader="true"
                             columns="2"
                             collapsible="false"
                             id="ServCodeSelect">
              <apex:outputPanel layout="block" styleClass="col" rendered="{!OR(currentProgram=='',currentLocation=='',currentServiceLine=='')}">
                  You must select a Program, Location, and Service Line for this Service Assignment before you can select a Service Code.
              </apex:outputPanel>
              <apex:outputPanel layout="block" styleClass="col" rendered="{!AND(currentProgram!='',currentLocation!='',currentServiceLine!='')}" >      
                <apex:actionStatus id="addStatus">
                     <apex:facet name="start">
                        <div class="waitingHolder" style="display: inline; margin-left: 5px; position: relative; top: 5px;">
                            <img class="waitingImage" src="/img/loading.gif" title="Please Wait..." /> <span class="waitingDescription"></span>
                        </div>
                    </apex:facet>
                    <apex:facet name="stop"> 
                    <apex:pageBlockTable value="{!AvailableCodes}" var="aCodes">
                        <apex:column >
                            <apex:commandButton value="Add" action="{!AddCode}" reRender="ServCodeSelect"  status="addStatus" rendered="{!editSA}">
                                <apex:param assignTo="{!SelectedCodeID}" name="SelectedCodeID" value="{!AvailableCodes[aCodes].Id}"/>
                            </apex:commandButton>
                        </apex:column>
        
                        <apex:column headerValue="Available Service Codes" value="{!AvailableCodes[aCodes].Service_Value__c}"/> 
                        <apex:column headerValue="Program" value="{!AvailableCodes[aCodes].Program__c}"/>
                        <apex:column headerValue="Start Date">
                            <apex:outputText value="{0, date, MM/dd/yyyy}">
                                <apex:param value="{!AvailableCodes[aCodes].Start_Date__c}" /> 
                            </apex:outputText>
                        </apex:column>
                        <apex:column headerValue="End Date" >
                                  <apex:outputText value="{0, date, MM/dd/yyyy}">
                                  <apex:param value="{!AvailableCodes[aCodes].End_Date__c}" />
                                 </apex:outputText>
            
                        <!-- used to inspect source code to get the ID of the record being displayed, display should be none;-->
                            <apex:outputPanel style="display: none;">{!AvailableCodes[aCodes].id}</apex:outputPanel> 
                        </apex:column>                
                                          
                    </apex:pageBlockTable>  
                 </apex:facet>
                 </apex:actionStatus>
            </apex:outputPanel> 
            <apex:outputPanel layout="block" styleClass="col" rendered="{!AND(currentProgram!='',currentLocation!='',currentServiceLine!='')}"> 
                <apex:actionStatus id="removeStatus">
                     <apex:facet name="start">
                        <div class="waitingHolder" style="display: inline; margin-left: 5px; position: relative; top: 5px;">
                            <img class="waitingImage" src="/img/loading.gif" title="Please Wait..." /> <span class="waitingDescription"></span>
                        </div>
                    </apex:facet>
                    <apex:facet name="stop">                   
                        <apex:pageBlockTable value="{!SelectedCodes}" var="Code">
                            <apex:column headerValue="Selected Service Codes" value="{!SelectedCodes[Code].Service_Value__c}">
                            </apex:column>  
                            <apex:column headerValue="Start Date">
                            <apex:outputText value="{0, date, MM/dd/yyyy}">
                                <apex:param value="{!SelectedCodes[Code].Start_Date__c}" />
                            </apex:outputText>
                            </apex:column>
                            <apex:column headerValue="End Date" >
                            <apex:outputText value="{0, date, MM/dd/yyyy}">
                                <apex:param value="{!SelectedCodes[Code].End_Date__c}" />
                            </apex:outputText>
                 
                            <!-- used to inspect source code to get the ID of the record being displayed, display should be none;-->
                                <apex:outputPanel style="display: none;">Service Code ID {!SelectedCodes[Code].Id}</apex:outputPanel> 
                                <apex:outputPanel style="display: none;">JO ID {!SelectedCodes[Code].id}</apex:outputPanel> 
                                
                            </apex:column>                                 
                            <apex:column >
                                <apex:commandButton value="Remove" action="{!RemoveCode}" reRender="ServCodeSelect" status="removeStatus" rendered="{!editSA}">
                                    <apex:param assignTo="{!SelectedCodeId}" name="SelectedCodeId" value="{!SelectedCodes[Code].Id}" />
                                    <apex:param assignTo="{!SelectedCodeKey}" name="SelectedCodeKey" value="{!Code}" />
                                </apex:commandButton> 
                            </apex:column>
                        </apex:pageBlockTable>
                    </apex:facet>  
                </apex:actionStatus>
            </apex:outputPanel>       
    </apex:pageBlockSection>
    <hr />
    <apex:pageBlockSection title="System Information"
                             showHeader="true"
                             columns="2"
                             collapsible="false"
                             id="ServAssignSystemInfo">
        <apex:outputPanel >
            <apex:outputLabel value="Created By" for="CreatedByLink" style="font-size: 75%;font-family: 'Arial','Helvetica',sans-serif; font-weight:bold;" />&nbsp;&nbsp;<apex:outputLink id="CreatedByLink" value="/{!Service_Assignment__c.CreatedBy.Id}">{!Service_Assignment__c.CreatedBy.Name}</apex:outputLink>
            <apex:outputText value=", " rendered="{!Service_Assignment__c.CreatedDate!=null}" />
            <apex:outputText value="{0,date,MM'/'dd'/'yyyy' 'h':'mm' 'a}">
                <apex:param value="{!Service_Assignment__c.CreatedDate}" /> 
            </apex:outputText>
        </apex:outputPanel>
        <apex:outputPanel >
            <apex:outputLabel style="font-size: 75%;font-family: 'Arial','Helvetica',sans-serif; font-weight:bold;" value="Last Modified By" for="LastModifiedByLink" />&nbsp;&nbsp;<apex:outputLink id="LastModifiedByLink" value="/{!Service_Assignment__c.LastModifiedBy.Id}">{!Service_Assignment__c.LastModifiedBy.Name}</apex:outputLink>
            <apex:outputText value=", " rendered="{!Service_Assignment__c.LastModifiedDate!=null}" />
            <apex:outputText value="{0,date,MM'/'dd'/'yyyy' 'h':'mm' 'a}">
                <apex:param value="{!Service_Assignment__c.LastModifiedDate}" /> 
            </apex:outputText>
        </apex:outputPanel>
    </apex:pageBlockSection>

</apex:pageBlock>    
</apex:form>
<apex:relatedList list="Progress_Notes__r" rendered="{!!editSA}" />
<c:GenericHistoryComponent myObject="{!Service_Assignment__c}" rendered="{!!editSA && newSA==false}" />

<script type="text/javascript">
window.onload = setFocus
function setFocus() {
              document.getElementById("hiddenElementId").focus();
}
function RefreshPage() {
    window.location.reload();
}
</script>

</apex:page>