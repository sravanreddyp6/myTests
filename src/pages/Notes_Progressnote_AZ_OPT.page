<apex:page standardController="Progress_Note__c" extensions="Notes_ProgressNote_AZ_OPT,Notes_ProgressNote_Svc_Code_Selection,progressnote_actionplan_embed_ex" id="mypage">

        <!-- Shaun added this to get rid of the default Salesforce TABS -->
      <style>  
      
      
        /* Used to hide the default "tabs" in salesforce */
        #tabContainer {
            display: none;
        }
        
        /* Hide the createNew section of the default salesforce sidebar */
        #createNew {
            display: none;
        }

        /* Hide the Recent Items section of the default salesforce sidebar */
        .recentItemModule {
            display: none;
        }

        /* Hide the Recycle Bin section of the default salesforce side bar */
        .recycleBinModule{
            display: none;
        }
        
        
      </style>  



<apex:includeScript value="{!URLFOR($Resource.jquery, '/js/jquery-1.7.2.min.js')}" />
<!-- Added for Goal Starts-->


<apex:includeScript value="{!$Resource.jquery}"/>
<apex:includeScript value="{!URLFOR($Resource.jquery, '/js/jquery-1.7.2.min.js')}" />
<apex:includeScript value="{!URLFOR($Resource.jQueryTabSlideOut, 'js/jquery.tabSlideOut.v1.3.js')}"/>
<apex:includeScript value="{!URLFOR($Resource.jquery, 'js/jquery-ui-1.8.21.custom.min.js')}" />
<apex:stylesheet value="{!URLFOR($Resource.jquery, 'css/custom-theme/jquery-ui-1.8.21.custom.css')}"/>

<apex:variable value="{!$User.Operating_Group__c ='Care Meridian'}" var="isCM"/>
<apex:variable value="{!$ObjectType.Action_Plan_Worksheet__c.accessible}" var="vfVarCanAccessWS"/>


<apex:variable value="{!if(isCM,'What difficulty does this Person Being Served seek to overcome?','What does this Person Being Served want to achieve?')}" var="goalTxt" />

<script> 
  
       
function hideStuff(cls, cls2, option, newtopion){
    j$("."+cls).slideUp(400);   
    j$("."+cls2).slideUp(400);     
    j$("."+option).slideUp(0); 
    j$("."+newtopion).slideDown(0);      
};

function showStuff(cls, cls2, option, newtopion){
    j$("."+cls).slideDown(400);   
    j$("."+cls2).slideDown(400);     
    j$("."+option).slideUp(0); 
    j$("."+newtopion).slideDown(0);  
};

function gotoend(div){
    j$('html, body').animate({scrollTop: j$("#"+div).offset().top}, 1000); 
};    
    
function toggleById(id, ms){
    j$(document.getElementById(id)).toggle(ms);
};
function toggleCatalogCell(){
    j$('#catalog-cell').toggleClass('cat-cell-width');
};
function maxCatalog(){    
    j$("#catalog-flyout").addClass('nodisplay');
    j$("#catalog-wrapper").addClass('catmaxWRAP');
    j$("#catalog-bg").addClass('catmaxBG');
    j$(".clinical-catalog").addClass('widthfull');
    j$("#catalog_sticky").addClass('catmin');
    j$(".catalog_tree").css({'height': 'auto'});
    j$("#cata-minimize").removeClass('nodisplay');
    j$("#cata-maximize").addClass('nodisplay');
    var h = j$( window ).height() - 150;
    j$(".catalog_tree").css({'max-height': h});
    //j$("#tree2").addClass('fullH');    
    j$('body').addClass('noscroll'); 
}
function minCatalog(){
    j$("#catalog-flyout").removeClass('nodisplay');
    j$("#catalog-wrapper").removeClass('catmaxWRAP');
    j$("#catalog-bg").removeClass('catmaxBG');
    j$(".clinical-catalog").removeClass('widthfull');
    j$("#catalog_sticky").removeClass('catmin');
    j$(".catalog_tree").css({'height': '350px'}); 
    j$("#cata-minimize").addClass('nodisplay');
    j$("#cata-maximize").removeClass('nodisplay');
    //j$("#tree2").removeClass('fullH');
    j$('body').removeClass('noscroll');
}
function toggleByClass(showcls, hidecls){
    j$("."+hidecls).slideUp(0);
    j$("."+showcls).slideDown(0);
};
function highlightButtons ( btype, sfid, on )
{

    j$('#' + btype + 'btn'+ sfid).toggle();
    if (on) { 
        j$('#' + btype + 'btn'+ sfid).css('background-color','#99f'); 
        j$('#' + btype + 'icon'+ sfid).attr('src','{!URLFOR($Resource.GoalIcons, 'icon-edit-orange.png')}');
        j$('#' + btype + 'icon'+ sfid).css('background-color','#99f');  
    } else {
        j$('#' + btype + 'icon'+ sfid).attr('src','{!URLFOR($Resource.GoalIcons, 'icon-edit-blue.png')}');
        j$('#' + btype + 'icon'+ sfid).css('background-color','transparent');  
    }        
    
}

j$(document).ready(function($) {
    $("[id$='dialog-alert-dates']").dialog({
                    resizable: false,
                    draggable: false,
                    height: 150,
                    width: 600,
                    modal: true,
                    autoOpen: false,
                    buttons: {
                        OK: function() {
                            $( this ).dialog( "close" );
                        }
                     },
                });
    
    $("[id$='dialog-set-dates']").dialog({
                    resizable: false,
                    draggable: false,
                    height: 200,
                    width: 600,
                    modal: true,
                    autoOpen: false,
                    buttons: {
                        Yes: function() {
                            
                            $( this ).dialog( "close" );
                            
                            // find all start dates
                            var dtPlanStart = j$('input[id$=plan_start_date]').val();
                            $('.startdate').each(function( index, elem ) {
                                $(elem).val( dtPlanStart);
                            });
                
                            // find all end dates
                            var dtPlanEnd = j$('input[id$=plan_end_date]').val();
                            $('.enddate').each( function( index, elem ) {
                                $(elem).val( dtPlanEnd);
                            });
                    
                            $(this).dialog("close");
                        },
                        
                        No: function() {
                            $(this).dialog("close");
                        }
                     },
                });
                
    setPlanDates = function(){
    

        var dtPlanStart = $('input[id$=plan_start_date]').val();
        var dtPlanEnd = $('input[id$=plan_end_date]').val();
        
        // if either effective date or target date is empty, alert
        if ( dtPlanStart == '' || dtPlanEnd== '') {
            $("[id$='dialog-alert-dates']").dialog("open");
        }
        
        else {  
            // confirm user knows whats entailed
            $("[id$='dialog-set-dates']").dialog("open");
            
        }
    }
    });
 
</script>
<style>
.nodisplay{display: none; }
#catalog_sticky::-webkit-scrollbar {
    width: 12px;
}
#tree2{
    width: 100%;
}
/* Track */
#catalog_sticky::-webkit-scrollbar-track {
    -webkit-box-shadow: inset 0 0 6px rgba(0,0,0,0.3); 
    -webkit-border-radius: 10px;
    border-radius: 10px;
}
 
/* Handle */
#catalog_sticky::-webkit-scrollbar-thumb {
    -webkit-border-radius: 10px;
    border-radius: 10px;
    background: rgba(255,0,0,0.8); 
    -webkit-box-shadow: inset 0 0 6px rgba(0,0,0,0.5); 
}
#catalog_sticky::-webkit-scrollbar-thumb:window-inactive {
    background: rgba(255,0,0,0.4); 
}
.label{
    margin:10px;
    font-weight:bold;
}
.fullH{
    height: 90%;
}
.cat-cell-width{
    width: 400px;
}
.noscroll{    overflow:hidden;}
.dateFormat{ display: none;}
.thinking{
    opacity:0.8;
    background-color:#ccc;
    position:fixed;
    width:100%;
    height:100%;
    top:0px;
    left:0px;
    z-index:10000;
}
.btnhover{
    z-index:10001;

}
.thinkingwheel{
    position:absolute; left:50%; top:50%; background-color: white; border: 2px solid gray; padding: 2px;
}
    .editcol{
        width: 50px;
    }
    .datecol{
        width: 250px;
    }
.lblaction{
    padding-left: 22px;
}
.lblobj{
    padding-left: 11px;
}
.lblgoal{
    padding-left: 0px;
}
.mylbl{
    font-weight: bold;
}
.txtarea{
    width: 95%;
}
.mytbl{
    width: 100%;
    margin-bottom:10px;
    margin-top:10px;
}
#wrappertbl{

    width: 100%;
}
.mytbl:nth-child(odd) {
   // background-color:#dcdcfd;
   //background-color:#c5d3ef;
   
  background-color:#e3e6ef;
}

.mytbl:nth-child(even) {
    background-color:#FAFBFC;
}

.leftcol{
    width: 150px;
}
.innerLabel{
    width: 85px;
    font-weight: bold;
}
.innerData{
    width: 250px;
}

.hbbg{
    position:fixed;
    width:100%;
    height:100%;
    top:0px;
    left:0px;
    background-color: gray;
    opacity: .6;
    z-index:1000;
}

.popupform{
    position: fixed; 
    left:35%; 
    top:40%;
     /*background-color: white; border: 2px solid gray; padding: 7px;*/
    width: 343px;
    opacity: 1;
    z-index:1099;

}

.fixedBtn { width:120px };
.catalog_sticky{
    height: 100px;
}
#clinical-catalog {
    padding: 10px;
    background: #e3e6ef /*#BDC4D9*/;
    border: 3px solid #BDC4D9;
    border-radius: 7px;
    box-shadow: 7px 7px 3px #888888;
} 
.catalog_tree{
    height: 350px;
    overflow: auto;
    max-height: 700px;
    margin-bottom: 15px;
}

.fancytree-container{
    overflow: visible !important;
    border: none !important;
    background: #e3e6ef !important;

} 
.fancytree-treefocus{
    outline: none !important;
}
.fancytree-ext-filter-hide{
//    width: 500px !important;
    overflow: visible !important;
}
.clinical-catalog{

    width: 300px;
}
.max{
    width: 800px;
    height: 100%;

}
.catmax{
    width: 750px;

}
.catmaxBG{
    opacity:0.8;
    background-color:#ccc;
    position:fixed;
    width:100%;
    height:100%;
    top:0px;
    left:0px;
    z-index:100;
    }
.catmin{
    position: absolute; opacity:1; left:10%; top:5%; background-color: white; border: 2px solid gray; padding: 2px; z-index:101; 
}
.catmaxWRAP{
     //position: fixed; 
     width: 100%;
     height: 100%;
     z-index:99;

}
.stick {
    position:fixed;
    top:120px;
    margin-top: 5px;
}
.widthfull{
    position: fixed;
    left: 2%;
    top: 5px;
    width: 95%;
    height: 95%;
    min-height: 700px;
    overflow: auto;
}
.min-max-containter{
    float: right; 
    padding-right: 5px; 
    cursor: pointer;
    margin-top: -3px;
    position: relative;
    top: 0;
    right: 0;
}
.min-max{
    width: 24px;
    height: 24px;    

}
.min-max:hover{
    border: 1px black solid;

}
.catalog-header{

    border-bottom: 1px solid #BDC4D9;
    padding-bottom: 3px;
    font-size: 12px;
}
#clinical-catalog select{
    background: #FAFBFC ;
    padding: 3px;
    border-radius: 3px;
    font-size: 14px;
    max-width: 225px;
}

#clinical-catalog select:focus{
    outline: none;
}
#clinical-catalog div:focus{
    outline: none;
}

.newObjClass {
background-color: cornsilk;
}
</style>




<!-- Ends -->
<apex:includeScript value="{!$Resource.jquery}"/>
<apex:includeScript value="{!URLFOR($Resource.jquery, '/js/jquery-1.7.2.min.js')}" />

<apex:variable value="{!Progress_Note__c.Locked__c || Progress_Note__c.Status__c == 'Final'}" var="vfVarLock"/>
<style>
    .goal{padding-left: 20px;}
    .obj{padding-left: 60px;}
    .act{padding-left: 100px;}
    .myheader{ margin-left: -10px;}
.thinking{
    opacity:0.8;
    background-color:#ccc;
    position:fixed;
    width:100%;
    height:100%;
    top:0px;
    left:0px;
    z-index:1000;
}
.btnhover{
    z-index:1001;

}
.thinkingwheel{
    position:absolute; left:50%; top:50%; background-color: white; border: 2px solid gray; padding: 2px;
}
.fixedElement {
    background-color: white;
    border-bottom: 2px green solid;
    position:fixed;
    top:0;
    width:100%;
    z-index:100;
    padding: 3px;
}
.mytitle{
    font-weight: bold;
    font-size: 14px;

}
.myhide{color :blue; text-decoration: underline; cursor:pointer}
.myshow{color :blue; text-decoration: underline; cursor:pointer}
</style>
<script>
var j$ = jQuery.noConflict();
function toggleByClass(showcls, hidecls){
    j$("."+hidecls).slideUp(0);
    j$("."+showcls).slideDown(0);
};
function toggleByClass2(cls){
    j$("."+cls).toggle(500);
    j$(".myshow").toggle(0);
    j$(".myhide").toggle(0);

};
</script>
<Script>
function complete(Signed) {
    if (Signed == 'Y') {
        alert("Document Already E-Signed");
    } else {
        authenticate();
    }
}
</script>
<apex:variable var="State" value="{!if(ISBLANK($CurrentPage.parameters.state) ,'',$CurrentPage.parameters.state)}"/>
    <apex:includeScript value="{!URLFOR($Resource.jquery, '/js/jquery-1.7.2.min.js')}" />
    <apex:includeScript value="{!URLFOR($Resource.jquery, 'js/jquery-ui-1.8.21.custom.min.js')}" />
    <apex:stylesheet value="{!URLFOR($Resource.chosen, '/chosen.css')}" />
    <apex:includescript value="{!URLFOR($Resource.chosen, '/chosen.jquery.js')}" />
    <style>
        .ui-dialog.ui-widget.ui-widget-content.ui-corner-all.modalDialog.ui-draggable {
            left: 55% !important;
            margin: 0 0 0 -488px;
            z-index: 101 !important;
            height:300px;
            padding-top:45%;
            
        }

        .chosen-single {
            background-color: black!important;
            background-image: none !important;
            box-shadow: none !important;
            border-radius: 0px !important;
            opacity: 0.20;
        }
        .ui-widget-overlay {
            background: #eeeeee url(images/ui-bg_diagonals-thick_90_eeeeee_40x40.png) 50% 50% repeat;
            opacity: .80;
            position: absolute;
              top: 0;
              left: 0;
        }
        
        .ui-widget-header {
            border: 1px solid #aed0ea;
            background: #deedf7 url(images/ui-bg_highlight-soft_100_deedf7_1x100.png) 50% 50% repeat-x;
            color: #222222;
            font-weight: bold;
        }
        .ui-dialog .ui-dialog-titlebar {
            padding: .4em 1em;
            position: relative;
        }
        
    </style>
    
    <style type="text/css">
        .custPopup{
            background-color: white;
            border-width: 2px;
            border-style: solid;
            z-index: 9999;
            left: 38%;
            padding:10px;
            position: absolute;
            width: 800px;
            margin-left: -250px;
            top:100px;
        }
        .popupBackground{
            background: #eeeeee url(images/ui-bg_diagonals-thick_90_eeeeee_40x40.png) 50% 50% repeat;
            opacity: .80;
            position: absolute;
              top: 0;
              left: 0;
            
            filter: alpha(opacity = 20);
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: 9998;
        }

    </style>
    <style>
        .dateFormat{display: none;}
        .thinking{
            opacity:0.8;
            background-color:#ccc;
            position:fixed;
            width:100%;
            height:100%;
            top:0px;
            left:0px;
            z-index:1000;
        }    
        .thinkingwheel{
            position:absolute; left:50%; top:50%; background-color: white; border: 2px solid gray; padding: 2px;
        }
        .timePastNoon{
            background: lightblue;
        }
    </style>
    <script>
        function setFocusOnLoad() {};
    </script>

    <!-- Shaun changed this from PersonalRecord to PersonalRecordBreadCumbsOnly -->
    <c:PersonalRecordBreadCrumbsOnly pbsId="{!pbsname}" servAssignId="{!theServAssignId }" parentPage="Notes_ProgressNote_AZ_OPT" servAssignNew="true" admId="{!admissionId}"/>

    <apex:pageBlock mode="mainDetail" id="mainData">
    <script type="text/javascript">
        j$ = jQuery.noConflict();
        j$(document).ready(function(){
            j$('.dateInput input').change(function(){
                if(j$(this).val().toUpperCase().indexOf('PM') > 0 ){
                    j$(this).addClass("timePastNoon");
                }else{
                    j$(this).removeClass("timePastNoon");
                }            
            })
            j$('.dateInput input').trigger('change');
            
            
            <apex:outputPanel layout="none" rendered="{!$User.Operating_Group__c=='NeuroRestorative' }" >
            // uncheck the billable field for NR
            j$('[id$=isbillable]').prop('checked',false);
            </apex:outputPanel>
        });
    </script>
<apex:variable var="Final" value="{!IF(Progress_Note__c.Status__c='Final',True,False)}"/>
<apex:variable var="Pending" value="{!IF(Progress_Note__c.Approval_Status__c='Pending',True,False)}"/>
<apex:variable value="{!$User.Operating_Group__c == 'NeuroRestorative' || $User.Operating_Group__c == 'Neuro Restorative'}" var="isNR" />
    <apex:pagemessages ></apex:pagemessages>
    <apex:form id="myFRM" ><apex:pagemessages ></apex:pagemessages>
    <c:Authentication formId="{!$Component.myFRM}" title="E-Sign" handler="CMEsignAZOPT" objectId="{!insertedProgressNoteId}" oncomplete="alert('This document was electronically signed by {!$User.FirstName} ({!$User.Email}) on {!NOW()}'); location.reload(true); return false;" />
    <script>
        function openPopUp(){
            var vars = '{!insertedProgressNoteId}';
            window.open('/apex/Notes_ProgressNote_PDF_AZ_OPT?id='+ vars,'','width=700,height=500,0,status=0,');
        }
    </script>       
    <apex:outputpanel rendered="{!NewBlock}">
        <apex:pageBlock >
            <apex:pageBlockButtons >  
                <apex:commandButton action="{!saveProgressNote}" value="Save" status="myStatus" rerender="myFRM"></apex:commandButton>
                <apex:commandButton action="{!cancel}" value="Cancel"  ></apex:commandButton>  
            </apex:pageBlockButtons>
            <apex:pageBlockSection columns="1" >
                <!-- hidden fields, values will be passed in the url -->    
                <apex:outputPanel style="display:none;">
                    <apex:selectList value="{!Progress_Note__c.Person_Being_Served__c}" size="1">
                        <apex:selectOption itemValue="{!$CurrentPage.parameters.person}" itemLabel="Person" ></apex:selectOption>
                    </apex:selectList>
                    <apex:selectList value="{!Progress_Note__c.Action_Plan__c}" size="1">
                        <apex:selectOption itemValue="{!$CurrentPage.parameters.plan}" itemLabel="Plan" ></apex:selectOption>
                    </apex:selectList>
                    <apex:selectList value="{!Progress_Note__c.Admission__c}" size="1">
                        <apex:selectOption itemValue="{!$CurrentPage.parameters.admission}" itemLabel="Admisison" ></apex:selectOption>
                    </apex:selectList>
                    <apex:selectList value="{!Progress_Note__c.Service_Assignment__c}" size="1">
                        <apex:selectOption itemValue="{!$CurrentPage.parameters.service_assignment}" itemLabel="Service Assignemnt" ></apex:selectOption>
                    </apex:selectList>            
               </apex:outputPanel><!--end of hidden fields-->
               <apex:outputText value="{!contactName}" label="Person Being Served" rendered="{!!ISBlANK(pbsName)}" />
               <apex:selectRadio id="TypeOfNoteField" required="true" layout="pageDirection" label="Type of Note" value="{!Progress_Note__c.RecordTypeId}" >
                    <apex:selectOptions value="{!rtOptions}"></apex:selectOptions>
               </apex:selectRadio>            
               <apex:repeat value="{!$ObjectType.Progress_Note__c.FieldSets.NewFormAZOPT}" var="f"> 
                   <apex:inputField id="isbillable" value="{!Progress_Note__c[f]}" rendered="{! f.fieldpath=='Purpose_Service_is_Billable__c'}"/>
                   <apex:inputField value="{!Progress_Note__c[f]}" rendered="{! AND(f.fieldpath != 'Purpose_Service_is_Billable__c', IF(And(contains(f.Label,'Unit'),$User.Operating_Group__c='NeuroRestorative'),false,true))}"/>
                   <apex:OutputField value="{!Progress_Note__c[f]}" rendered="{!AND(f.fieldpath != 'Purpose_Service_is_Billable__c', IF(And(contains(f.Label,'Unit'),$User.Operating_Group__c='NeuroRestorative'),true,false))}" styleclass="thinkingwheel"/>
                </apex:repeat>
                <apex:outputLabel >Required Number of Signatures (put 0 if None)</apex:outputLabel>
                <apex:inputField required="true" value="{!Progress_Note__c.Number_of_Required_Signatures__c}"/>
            </apex:pageBlockSection>
        </apex:pageBlock>
    </apex:outputpanel>
    <apex:outputpanel rendered="{!!NewBlock}">
        <apex:outputPanel style="display: none;">
            <apex:outputField value="{!Progress_Note__c.recordtype.DeveloperName}" />
        </apex:outputPanel>
        <style>
            input[name=piSubmit] { display: none;}
        </style>
        <br></br>
        <apex:pageBlock id="pblk">
        <apex:pagemessages ></apex:pagemessages>
            <apex:commandButton id="saveButton"   value="Save"   action="{!save}"   style="margin-left:30%;display:none"/>
            <apex:commandButton id="cancelButton" value="Cancel" action="{!Cancel}" style="display:none"/>
            <apex:commandButton id="editButton" value="Edit"  action="{!Edit}" style="margin-left:30%;"/>
            <apex:commandButton id="finalizebtn" value="Finalize this Progress Note"  action="{!showPopup}" rerender="tstpopup,pblk" />
            <apex:commandButton id="disregard" value="Disregard Note"  action="{!disregardNote}" />
            <apex:commandButton id="createPDF" value="Create PDF"  onclick="openPopUp(); return false;"/>
            <apex:commandButton id="esign" value="E-Sign"  onClick="complete('{!SignedDoc}'); return false;"/>
            <br></br>
            <br></br>
            <apex:pageBlockSection columns="1">
            <apex:outputField value="{!Progress_Note__c.name}"/>
            <apex:outputField title="Type of Note" value="{!Progress_Note__c.recordtypeid}"/>
            <apex:outputField value="{!Progress_Note__c.Start_Time__c}">
            <apex:inlineEditSupport disabled="false" showOnEdit="saveButton,cancelButton" hideOnEdit="editButton,finalizebtn,disregard,createPDF,esign" event="ondblclick" changedStyleClass="myBoldClass" resetFunction="resetInlineEdit"/>
            </apex:outputField>
            <apex:outputField value="{!Progress_Note__c.End_Time__c}">
            <apex:inlineEditSupport disabled="false" showOnEdit="saveButton,cancelButton" hideOnEdit="editButton,finalizebtn,disregard,createPDF,esign" event="ondblclick" changedStyleClass="myBoldClass" resetFunction="resetInlineEdit"/>
            </apex:outputField>
            <apex:outputField value="{!Progress_Note__c.Total_Time__c}"/>
            
            <apex:outputField value="{!Progress_Note__c.Service_Location__c}">
            <apex:inlineEditSupport disabled="false" showOnEdit="saveButton,cancelButton" hideOnEdit="editButton,finalizebtn,disregard,createPDF,esign" event="ondblclick" changedStyleClass="myBoldClass" resetFunction="resetInlineEdit"/>
            </apex:outputField>
    
            <apex:outputField value="{!Progress_Note__c.Type_of_Contact__c}">
            <apex:inlineEditSupport disabled="false" showOnEdit="saveButton,cancelButton" hideOnEdit="editButton,finalizebtn,disregard,createPDF,esign" event="ondblclick" changedStyleClass="myBoldClass" resetFunction="resetInlineEdit"/>
            </apex:outputField>
            
            <apex:outputField value="{!Progress_Note__c.Purpose_Service_is_Billable__c}">
            <apex:inlineEditSupport disabled="false" showOnEdit="saveButton,cancelButton" hideOnEdit="editButton,finalizebtn,disregard,createPDF,esign" event="ondblclick" changedStyleClass="myBoldClass" resetFunction="resetInlineEdit"/>
            </apex:outputField>
            
            <apex:outputField value="{!Progress_Note__c.Units__c}">
            <apex:inlineEditSupport disabled="false" showOnEdit="saveButton,cancelButton" hideOnEdit="editButton,finalizebtn,disregard,createPDF,esign" event="ondblclick" changedStyleClass="myBoldClass" resetFunction="resetInlineEdit"/>
            </apex:outputField>
            
            <apex:outputField value="{!Progress_Note__c.People_Present__c}">
            <apex:inlineEditSupport disabled="false" showOnEdit="saveButton,cancelButton" hideOnEdit="editButton,finalizebtn,disregard,createPDF,esign" event="ondblclick" changedStyleClass="myBoldClass" resetFunction="resetInlineEdit"/>
            </apex:outputField>
            
            <apex:outputField value="{!Progress_Note__c.Status__c}">
            <apex:inlineEditSupport disabled="false" showOnEdit="saveButton,cancelButton" hideOnEdit="editButton,finalizebtn,disregard,createPDF,esign" event="ondblclick" changedStyleClass="myBoldClass" resetFunction="resetInlineEdit"/>
            </apex:outputField>
            
            
            <apex:outputField value="{!Progress_Note__c.Disregard_Note__c}">
            </apex:outputField>
            
            <apex:outputField value="{!Progress_Note__c.Sleep_Check_Conducted__c}">
            <apex:inlineEditSupport disabled="false" showOnEdit="saveButton,cancelButton" hideOnEdit="editButton,finalizebtn,disregard,createPDF,esign" event="ondblclick" changedStyleClass="myBoldClass" resetFunction="resetInlineEdit"/>
            </apex:outputField>
            
            <apex:outputField value="{!Progress_Note__c.Interventions__c}">
            <apex:inlineEditSupport disabled="false" showOnEdit="saveButton,cancelButton" hideOnEdit="editButton,finalizebtn,disregard,createPDF,esign" event="ondblclick" changedStyleClass="myBoldClass" resetFunction="resetInlineEdit"/>
            </apex:outputField>
            
            <apex:outputField value="{!Progress_Note__c.Progress__c}">
            <apex:inlineEditSupport disabled="false" showOnEdit="saveButton,cancelButton" hideOnEdit="editButton,finalizebtn,disregard,createPDF,esign" event="ondblclick" changedStyleClass="myBoldClass" resetFunction="resetInlineEdit"/>
            </apex:outputField>
            
            <apex:outputField value="{!Progress_Note__c.Notes_For_Next_Visit__c}">
            <apex:inlineEditSupport disabled="false" showOnEdit="saveButton,cancelButton" hideOnEdit="editButton,finalizebtn,disregard,createPDF,esign" event="ondblclick" changedStyleClass="myBoldClass" resetFunction="resetInlineEdit"/>
            </apex:outputField>
            
            <apex:outputField value="{!Progress_Note__c.Next_Appt_Date_Time__c}">
            <apex:inlineEditSupport disabled="false" showOnEdit="saveButton,cancelButton" hideOnEdit="editButton,finalizebtn,disregard,createPDF,esign" event="ondblclick" changedStyleClass="myBoldClass" resetFunction="resetInlineEdit"/>
            </apex:outputField>
            
            <apex:outputField value="{!Progress_Note__c.Person_Being_Served__c}">
            <apex:inlineEditSupport disabled="false" showOnEdit="saveButton,cancelButton" hideOnEdit="editButton,finalizebtn,disregard,createPDF,esign" event="ondblclick" changedStyleClass="myBoldClass" resetFunction="resetInlineEdit"/>
            </apex:outputField>
            
            <apex:outputField value="{!Progress_Note__c.Service_Assignment__c}">
            <apex:inlineEditSupport disabled="false" showOnEdit="saveButton,cancelButton" hideOnEdit="editButton,finalizebtn,disregard,createPDF,esign" event="ondblclick" changedStyleClass="myBoldClass" resetFunction="resetInlineEdit"/>
            </apex:outputField>
            
            <apex:outputField value="{!Progress_Note__c.Admission__c}">
            <apex:inlineEditSupport disabled="false" showOnEdit="saveButton,cancelButton" hideOnEdit="editButton,finalizebtn,disregard,createPDF,esign" event="ondblclick" changedStyleClass="myBoldClass" resetFunction="resetInlineEdit"/>
            </apex:outputField>
            
            <apex:outputField value="{!Progress_Note__c.Action_Plan__c}">
            <apex:inlineEditSupport disabled="false" showOnEdit="saveButton,cancelButton" hideOnEdit="editButton,finalizebtn,disregard,createPDF,esign" event="ondblclick" changedStyleClass="myBoldClass" resetFunction="resetInlineEdit"/>
            </apex:outputField>
            </apex:pageBlockSection>
            <!--  <apex:detail subject="{!insertedProgressNoteId}"  relatedListHover="false" inlineEdit="true" title="false"/>-->
        </apex:pageBlock>
        
        <apex:pageBlock mode="mainDetail" >
                    <apex:actionStatus id="myStatus">
                        <apex:facet name="start">
                            <div class="waitingHolder" style="display: inline; margin-left: 5px; position: relative; top: 5px;">
                                <img class="waitingImage" src="/img/loading.gif" title="Please Wait..." /> Saving... <span class="waitingDescription"></span>
                            </div>
                        </apex:facet>
                        <apex:facet name="stop"></apex:facet>
                    </apex:actionStatus>
                    
                        
          <apex:pageBlockSection title="Service Code" collapsible="false" columns="2">

          <apex:selectList size="1" title="Service Code" value="{!Progress_Note__c.Service_Code__c}" rendered="{!!Final}" disabled="{!Pending}">
                <apex:selectOptions value="{!Codes}"></apex:selectOptions>
                <apex:actionSupport event="onchange" reRender="myFrm" status="myStatus" action="{!quicksave}"/>
            </apex:selectList>
          
          <apex:pageBLockSectionItem rendered="{!!Final && Progress_Note__c.Admission__r.State__c != 'NC' && Progress_Note__c.Admission__r.State__c != 'AZ' && Progress_Note__c.Admission__r.State__c != 'IN' && Progress_Note__c.Admission__r.State__c != 'MA' && Progress_Note__c.Admission__r.State__c != 'MD' && Progress_Note__c.Admission__r.State__c != 'OH'}">
          <!-- added by Amruth for EB-436 -->
          <apex:outputLabel for="auth" value="Authorization" rendered="{isNR}" />
          <apex:selectList size="1" id="auth" value="{!Progress_Note__c.Authorization__c}"  rendered="{!!Final && !isNR}" disabled="{!Pending}">
                
            <apex:selectOptions value="{!Auths}"></apex:selectOptions>
                    <apex:actionSupport event="onchange" reRender="myFrm" status="myStatus" action="{!quicksave}"/>
            </apex:selectList>
            </apex:pageBLockSectionItem>
            
            <apex:outputField id="svccode" value="{!Progress_Note__c.Service_Code__r.Service_Value__c}"  rendered="{!Final}"/>
            <apex:outputPanel rendered="{! Progress_note__c.Admission__r.state__C != 'NC' && Progress_Note__c.Admission__r.State__c != 'AZ' && Progress_Note__c.Admission__r.State__c != 'IN' && Progress_Note__c.Admission__r.State__c != 'MA' && Progress_Note__c.Admission__r.State__c != 'MD' && Progress_Note__c.Admission__r.State__c != 'OH' && Final}" >
            <apex:outputLabel for="authdisp" value="Authorization" rendered="{isNR}"/>
            <apex:outputField id="authdisp" label="Authorization" value="{!Progress_Note__c.Authorization__r.Display_Name__c}"/>
            <apex:pageBlockSectionItem />         
            <apex:outputField label="Payor Name" value="{!Progress_Note__c.Authorization__r.Payer_Name__c}" />
            </apex:outputPanel>
        </apex:pageBlockSection>
    </apex:pageBlock>
    
    
    <!-- Added for Goal Starts-->
    
    <apex:commandButton style="float:right" action="{!addGoal}" rendered="true" value="Add {!GoalAlias}" reRender="myFrm" status="myStatus"  oncomplete="gotoend('planend');"/>        
<apex:pageBlockSection title="Action Plan" collapsible="false" columns="1" id="anothertest">
<apex:outputPanel id="apchildren_wrapper">
<table id="wrappertbl" >
<tr>
<td id="catalog-cell">
    <div id="catalog-bg"/>
    <div id="catalog-wrapper">
        <apex:outputPanel layout="block" style="display: {!if(editMode, 'block','none')}" rendered="{!
                            ($Setup.SystemSettings__c.ActnPln_CtlgEnabledFor_CM__c && userOpGrp == 'Care Meridian')
                            || ($Setup.SystemSettings__c.ActnPln_CtlgEnabledFor_Cambridge__c && userOpGrp == 'Cambridge')
                            || ($Setup.SystemSettings__c.ActnPln_CtlgEnabledFor_NR__c && userOpGrp == 'NeuroRestorative')
                            || ($Setup.SystemSettings__c.ActnPln_CtlgEnabledFor_Redwood__c && userOpGrp == 'Redwood') }" >
            <div id="catalog_filler" style="display: none; width: 400px;"> &nbsp;</div>
            <div style="width: 45px;"> &nbsp;</div>
            <div id="catalog_sticky">
                <div id="clinical-catalog" class="clinical-catalog" style="display: none; float: left; ">
                    <apex:outputPanel layout="block" styleClass="catalog-header" >
                        <div id="cata-maximize" class="min-max-containter" onclick="maxCatalog(); return false;" ><apex:image styleClass="min-max" url="{!URLFOR($Resource.min_max_imgs,'max.png')}"/></div>
                        <div id="cata-minimize" class="min-max-containter nodisplay" onclick="minCatalog(); return false;"><apex:image styleClass="min-max" url="{!URLFOR($Resource.min_max_imgs,'min.png')}"/></div>
                                            
                        <apex:outputLabel value="Catalog: " styleClass="label" style="margin-bottom: 7px;"/>
                                    <apex:selectList id="choosePlan" value="{!curCtlg}" required="false" size="1" multiselect="false">
                                        <apex:selectOptions value="{!ctlgs}"/>
                                        <apex:actionSupport event="onchange" reRender="fullTree" action="{!refreshSelectedCatalog}" status="myCatalogStatus"/>
                                    </apex:selectList>                           
                            <apex:actionStatus id="myCatalogStatus" >
                                <apex:facet name="start">    
                                            <span style="padding-left: 3px;"><img class="waitingImage" src="/img/loading.gif" title="Please Wait..." /></span>
  
                                </apex:facet>  
                                <apex:facet name="stop"> 
                                 
                                </apex:facet>         
                            </apex:actionStatus>                        


                        <apex:inputHidden value="{!catalog_selections}" id="catalog_items"/>                       
                    </apex:outputPanel>
                     
                    <apex:outputPanel styleClass="catalog_tree" layout="block">
                        <apex:pageBlock id="fullTree" mode="mainDetail">
                            <apex:outputPanel id="tree2" layout="block" >
                                <div id="tree-wrapper">
                                   <c:Fancy_Tree forceParents="true" showIcons="false" TreeString="{!allGoals.Fancy_Tree_JSon_String_LongText}" allowInactiveNode="false" mode="2" checkbox="true" ID_PageSideStorage="catalog_items" TreeID="tree2" debug="false" />    
                                </div>
                            </apex:outputPanel>                
                        </apex:pageBlock>
                    </apex:outputPanel>    
                    
                    <apex:outputPanel >
                        <apex:commandButton oncomplete="gotoend('planend'); minCatalog(); " status="myStatus" reRender="goalwrapper" style="float: right; margin-top: 0px; " action="{!addItemsFromCatalog}" value="Add to Plan"/>
     
                    
                    </apex:outputPanel>
                        
                </div>
                <span id="catalog-flyout" onclick="toggleById('clinical-catalog', 250); toggleById('catalog_filler',0); toggleCatalogCell();  return false;" style="cursor:pointer;"><apex:image url="{!$Resource.catalogIMG}"/></span>
            </div>
    
            <script>
        
                $(document).ready(function() {
                    var s = $("#catalog_sticky");
                    var pos = s.position();                    
                    $(window).scroll(function() {
                        var windowpos = $(window).scrollTop();
                        //$("#header_left").html("Distance from top:" + pos.top + "<br />Scroll position: " + windowpos);
                        if (windowpos - 120 >= pos.top) {
                            s.addClass("stick");
                        } else {
                            s.removeClass("stick"); 
                        }
                    });
                });
            </script>  
        </apex:outputPanel> 
    </div>
    
    </td>
    <td>
    
<apex:outputPanel id="goalwrapper" layout="block"  >
    <apex:repeat value="{!planStuff}" var="g">    
    <table class="mytbl">
    <tr>
        <td class="leftcol" >        
            <apex:outputLabel rendered="{! !editmode}"><b>{!GoalAlias}</b></apex:outputLabel>
            <apex:outputPanel id="goalButtons" 
                            layout="block" 
                            rendered="{!editMode}"
                            onmouseover="highlightButtons('goal','{!g}', true);" 
                            onmouseout="highlightButtons('goal','{!g}', false );"
                            style="width: 122px">
                    <img id="goalicon{!g}" src="{!URLFOR($Resource.GoalIcons, 'icon-edit-blue.png')}" style="vertical-align:middle"/>&nbsp;<b>{!GoalAlias}</b>
                    <div id="goalbtn{!g}" class="btnhover" style="display: none;padding-top:0px" > 
                    <apex:commandButton value="Add {!ObjAlias}" action="{!addObj}" reRender="myFrm" status="myStatus" styleClass="fixedBtn" >
                        <apex:param assignTo="{!goalID}" value="{!g}" name="goalID"  /> 
                        <apex:param assignTo="{!isparentNew}" value="{!planStuff[g].isNew}" name="isparentNew "  /> 
                    </apex:commandButton>
                    <br/>
                    <apex:commandButton action="{!deleteGoal}" 
                                        value="Delete {!GoalAlias}" 
                                        reRender="myFrm" 
                                        status="myStatus"
                                        styleClass="fixedBtn" 
                                        onclick="if(!confirm('Are you sure you want to Delete this {!GoalAlias}? All associated {!ObjAlias}s and {!ActAlias}s will also be deleted.')){return};">
                        <apex:param assignTo="{!deleteGid}" value="{!g}" name="deleteGid"  />   
                    </apex:commandButton>                
                </div>
            </apex:outputPanel>
        
        </td>                
        <td>
            <apex:outputLabel styleClass="tmnHelpText">{!goalTxt}<br /></apex:outputLabel>
            <apex:outputPanel layout="block" style="padding-bottom:20px">
                <apex:inputField rendered="{!editMode}" styleClass="txtarea" value="{!planStuff[g].theGoal.Description__c}" /> 
                <apex:outputField rendered="{! !editMode}" value="{!planStuff[g].theGoal.Description__c}"  />
            </apex:outputPanel> 
            
        </td>            
    </tr>            
        
        
            <apex:repeat value="{!planStuff[g].GoalObjs}" var="o" >
    <tr>
                    <td>
                    <apex:outputLabel style="margin-left:10px" rendered="{! !editmode}"><b>{!ObjAlias}</b></apex:outputLabel>            
                        <apex:outputPanel id="objButtons" 
                                            layout="block" 
                                            rendered="{!editMode}" 
                                            style="margin-left: 10px; width: 122px"
                                            onmouseover="highlightButtons('obj','{!o}', true);" 
                                            onmouseout="highlightButtons('obj','{!o}', false );"
                                            >
                            
                    <img id="objicon{!o}" src="{!URLFOR($Resource.GoalIcons, 'icon-edit-blue.png')}" style="vertical-align:middle"/>&nbsp;<b>{!ObjAlias}</b>
                            <div id="objbtn{!o}" style="display: none;">  
                                <apex:commandButton value="Add {!ActAlias}" action="{!addAct}" reRender="myFrm" styleClass="fixedBtn" status="myStatus">
                                    <apex:param assignTo="{!goalID}" value="{!g}" name="goalID"  /> 
                                    <apex:param assignTo="{!objID}" value="{!o}" name="objID"  />
                                    <apex:param assignTo="{!isparentNew}" value="{!planStuff[g].GoalObjs[o].isNew}" name="isparentNew "  />
                                </apex:commandButton>
                                <br/>                
                                    <apex:commandButton action="{!deleteObj}" 
                                                        value="Delete {!ObjAlias}" 
                                                        reRender="myFrm" 
                                                        status="myStatus"
                                                        styleClass="fixedBtn" 
                                                        onclick="if(!confirm('Are you sure you want to Delete this {!ObjAlias} ? All associated {!ActAlias}s will also be deleted.')){return};">
                                        <apex:param assignTo="{!deleteGid}" value="{!g}" name="deleteGid"  /> 
                                        <apex:param assignTo="{!deleteOid}" value="{!o}" name="deleteOid"  /> 
                                    </apex:commandButton> 
                            </div>
                        </apex:outputPanel>
                    </td>                    
                    <td>
                    
                        <apex:outputPanel layout="block" id="theObj" style="padding-bottom:20px" styleClass="{!if(AND(OR(planStuff[g].GoalObjs[o].theObj.Status__c == 'New', planStuff[g].GoalObjs[o].theObj.Status__c == 'Revised')),'newObjClass','')}">
                            <apex:inputField styleClass="txtarea" rendered="{!editMode}" value="{!planStuff[g].GoalObjs[o].theObj.Description__c}"/>  
                            <apex:outputField rendered="{! !editMode}" value="{!planStuff[g].GoalObjs[o].theObj.Description__c}"/> 
                            
                            <apex:panelGrid columns="8" style="" rules="groups" columnClasses="innerLabel, innerData">
                                <apex:outputPanel layout="block" styleClass="innerLabel" > Status</apex:outputPanel>  
                                <apex:outputField value="{!planStuff[g].GoalObjs[o].theObj.Status__c}"  rendered="{!!editMode}"/> 
                                <apex:inputField value="{!planStuff[g].GoalObjs[o].theObj.Status__c}"  rendered="{!editMode}"/> 
                                                                        
                                <apex:outputPanel layout="block" styleClass="innerLabel" > Effective Date</apex:outputPanel>
                                <apex:outputField value="{!planStuff[g].GoalObjs[o].theObj.Effective_Date__c}" rendered="{!!editMode}"/>
                                <apex:inputField styleClass="startdate" value="{!planStuff[g].GoalObjs[o].theObj.Effective_Date__c}" rendered="{!editMode}"/>    
                                
                                <apex:outputPanel layout="block" styleClass="innerLabel" > Target Date</apex:outputPanel>
                                <apex:outputField value="{!planStuff[g].GoalObjs[o].theObj.Target_End_Date__c}" rendered="{!!editMode}"/> 
                                <apex:inputField styleClass="enddate" value="{!planStuff[g].GoalObjs[o].theObj.Target_End_Date__c}" rendered="{!editMode}"/> 
                                
                                
                                <!--<apex:outputPanel layout="block" styleClass="innerLabel" rendered="{! !hideObjType}" > Type</apex:outputPanel> 
                                <apex:outputField value="{!planStuff[g].GoalObjs[o].theObj.Type__c}" rendered="{!!editMode  && !hideObjType}"/>
                                <apex:inputField value="{!planStuff[g].GoalObjs[o].theObj.Type__c}" rendered="{!editMode  && !hideObjType}"/> -->
                            </apex:panelGrid> 
                                                
                        </apex:outputPanel>
                    </td>
    </tr>                
                    <apex:repeat value="{!planStuff[g].GoalObjs[o].ObjActs}" var="a" id="actsthe">
    <tr class="action_row">
                            <td >
                            <apex:outputLabel style="margin-left:20px" rendered="{! !editmode}"><b>{!ActAlias}</b></apex:outputLabel>                
                                <apex:outputPanel id="actButtons" 
                                                rendered="{!editMode}" 
                                                layout="block" 
                                                style="margin-left:20px; width: 122px"
                                                onmouseover="highlightButtons('act','{!a}', true);" 
                                                onmouseout="highlightButtons('act','{!a}', false );"
                                                >
                                <img id="acticon{!a}" src="{!URLFOR($Resource.GoalIcons, 'icon-edit-blue.png')}" style="vertical-align:middle"/>&nbsp;<b>{!ActAlias}</b>
                                   <div id="actbtn{!a}" style="display: none;">                                
                                        <apex:commandButton action="{!deleteAct}" 
                                                            value="Delete {!ActAlias}" 
                                                            reRender="myFrm" 
                                                            status="myStatus"
                                                            styleClass="fixedBtn" 
                                                            onclick="if(!confirm('Are you sure you want to delete this {!ActAlias}?')){return};">
                                            <apex:param assignTo="{!deleteGid}" value="{!g}" name="deleteGid"  /> 
                                            <apex:param assignTo="{!deleteOid}" value="{!o}" name="deleteOid"  /> 
                                            <apex:param assignTo="{!deleteAid}" value="{!a}" name="deleteAid"  /> 
                                        </apex:commandButton> 
                                        <br/>
                                    </div>
                                </apex:outputPanel>
                            </td> 
                            <td>
                            
                                <apex:outputLabel styleClass="tmnHelpText">How will staff support this Person Being Served to meet the {!ObjAlias}?<br/></apex:outputLabel>    
                                <apex:outputPanel layout="block" id="theAction" style="padding-bottom:20px">
                                    <apex:inputField styleClass="txtarea" rendered="{!editMode}" value="{!planStuff[g].GoalObjs[o].ObjActs[a].theAction.Description__c}"/>  
                                    <apex:outputField rendered="{! !editMode}" value="{!planStuff[g].GoalObjs[o].ObjActs[a].theAction.Description__c}"/>   
                                        
                                        <apex:panelGrid columns="8" style="" rules="groups" columnClasses="innerLabel, innerData" rendered="true">
                                            <apex:outputPanel layout="block" styleClass="innerLabel" > Status</apex:outputPanel>  
                                            <apex:outputField value="{!planStuff[g].GoalObjs[o].ObjActs[a].theAction.Status__c}"  rendered="{!!editMode}"/> 
                                            <apex:inputField value="{!planStuff[g].GoalObjs[o].ObjActs[a].theAction.Status__c}"  rendered="{!editMode}"/> 
                                                                                    
                                            <apex:outputPanel layout="block" styleClass="innerLabel" > Start Date</apex:outputPanel>
                                            <apex:outputField value="{!planStuff[g].GoalObjs[o].ObjActs[a].theAction.Start_Date__c}" rendered="{!!editMode}"/>
                                            <apex:inputField styleClass="startdate" value="{!planStuff[g].GoalObjs[o].ObjActs[a].theAction.Start_Date__c}" rendered="{!editMode}"/>  

                                            <apex:outputPanel layout="block" styleClass="innerLabel" >End Date</apex:outputPanel>
                                            <apex:outputField value="{!planStuff[g].GoalObjs[o].ObjActs[a].theAction.End_Date__c}" rendered="{!!editMode}"/>
                                            <apex:inputField styleClass="enddate" value="{!planStuff[g].GoalObjs[o].ObjActs[a].theAction.End_Date__c}" rendered="{!editMode}"/>                                               
                                            
                                        </apex:panelGrid>                                           
                                        
                                </apex:outputPanel>
                            </td>
    </tr>                    
                </apex:repeat> <!-- end action-->
        </apex:repeat> <!-- end obj -->
        </table>
    </apex:repeat><!--end goal-->
    </apex:outputPanel><!-- end goals wrapper -->
    </td></tr></table><!-- end full wrapper -->
    </apex:outputPanel><!-- end ap children warpper -->
    <apex:commandButton style="float:right" action="{!addGoal}" rendered="{!editMode}" value="Add {!GoalAlias}" reRender="myFrm" status="myStatus"  oncomplete="gotoend('planend');"/>        
    
<div id="planend" ></div>
</apex:pageBlockSection> 
    
    
    
    
     <!--Added for Goal Ends-->
    
    
    <apex:pageblock >
        <apex:pageBlockSection title="System Information" columns="2">
        <apex:outputField value="{!Progress_Note__c.CreatedById}" />
        <apex:outputField value="{!Progress_Note__c.LastModifiedById}"/>
        <apex:outputField value="{!Progress_Note__c.CreatedDate}" />
        <apex:outputField value="{!Progress_Note__c.Locked__c}"/>
      </apex:pageBlockSection>
    
    
    </apex:pageblock>
    
        
        <apex:pageBlock title="Approval Information">
            <apex:pageBlockSection >
                <apex:outputField value="{!Progress_Note__c.Approval_Status__c}"/>
                <apex:outputField value="{!Progress_Note__c.No_Approval_Needed__c}"/>
                <apex:outputField value="{!Progress_Note__c.Approval_Status_Date__c}"/>
            </apex:pageBlockSection> 
            <br/>
         </apex:pageBlock>
    </apex:outputpanel>
    <apex:outputPanel id="tstpopup">
    
    
    
        <apex:outputPanel styleClass="popupBackground" layout="block" rendered="{!displayPopUp}"/>
        <apex:outputPanel styleClass="custPopup" layout="block" rendered="{!displayPopUp}">
            <apex:pageMessage rendered="{!hasOverlap}" severity="warning" title="Overlapping Notes Detected" strength="3" detail="Before submitting this note, please consider these other Progress Notes listed below whose times overlap the start and end date of this note." />
            <apex:pageBlock rendered="{!hasOverlap}" title="Overlapping Progress Notes">
                <apex:pageBlockTable styleclass="pbBody-list"  value="{!pnOverlap}" var="item">
                    <apex:column >
                        <apex:outputLink value="/{!item.id}">{!item.name}</apex:outputLink>
                     </apex:column>
                     <apex:column value="{!item.Owner.Name}"/>
                     <apex:column value="{!item.Start_Time__c}"/>
                     <apex:column value="{!item.End_Time__c}"/>
                     <apex:column value="{!item.Status__c}"/>
                </apex:pageBlockTable>
            </apex:pageBlock>
            <apex:pageBlock id="block" >
                <apex:pageBlockButtons >
                    <apex:commandButton value="Submit for Approval" action="{!SubmitForApp}"  rendered="{!!thePN.No_Approval_Needed__c}"/>
                    <apex:commandButton value="Mark Final" action="{!myFinal}" rendered="{!thePN.No_Approval_Needed__c}"/>
                    <apex:commandButton value="Cancel" action="{!closePopup}" rerender="tstpopup"/>
                    <!-- <apex:commandButton value="E-Sign"  action="{!closePopup}" oncomplete="authenticate(); return false;" rerender="tstpopup"/>  -->
                </apex:pageBlockButtons>
                <apex:pageBlockSection columns="1" >
                    <apex:pageMessages ></apex:pageMessages>
                    <apex:inputField value="{!thePN.Next_Approver__c}">
                        <!--<apex:actionSupport event="onclick" reRender="block"/> -->               
                    </apex:inputField><br></br>
                    <apex:outputPanel layout="block" style="font-size: 14px; font-weight: bold; color: #4A4A56; " rendered="{!!thePN.No_Approval_Needed__c}" >
                        <center>Once you submit this record for approval,
                        <br/> you might not be able to edit it or recall it from the approval process depending on your settings.</center>
                    </apex:outputPanel>
                </apex:pageBlockSection>
            </apex:pageBlock> 
            <br/><br/>
            <!--<apex:commandButton value="Cancel" action="{!closePopup}" rerender="tstpopup"/>-->
        </apex:outputPanel>
    </apex:outputPanel>
    <apex:outputPanel id="EsignComponent">
        <apex:outputPanel styleClass="popupBackground" layout="block" rendered="{!displayPopUpcomp}"/>
        <apex:outputPanel styleClass="custPopup" layout="block" rendered="{!displayPopUpcomp}">
            <br/><br/><br/>
        </apex:outputPanel>
    </apex:outputPanel>
              
</apex:form>


        <div id="blue-card-vertical">         
             <c:PersonalRecord_Vertical pbsId="{!pbsname}" servAssignId="{!theServAssignId }" parentPage="Notes_ProgressNote_AZ_OPT" servAssignNew="true" admId="{!admissionId}"/>
        </div>




    <apex:outputpanel rendered="{!!NewBlock}">
        <div id="Taks">
        <apex:relatedList list="OpenActivities"  subject="{!$CurrentPage.parameters.id}" />
        </div>
    
    
        <div id="History">
        <apex:relatedList list="ActivityHistories"  subject="{!$CurrentPage.parameters.id}" />
        </div>
        
        <div id="Attachments">
        <apex:relatedList list="CombinedAttachments"  subject="{!$CurrentPage.parameters.id}" />
        </div>
    </apex:outputpanel>
    <apex:outputpanel rendered="{!!NewBlock}">
        <div id="Approvals">
        <apex:relatedList list="ProcessSteps"/>
        </div>
    </apex:outputpanel>
    </apex:pageBlock>
    <apex:actionStatus id="myStatus" >
        <apex:facet name="start">
        <div  class="thinking">
        <div class="thinkingwheel">
            <span><img class="waitingImage" src="/img/loading.gif" title="Please Wait..." />&nbsp;Processing...</span>
        </div>
        </div>
        </apex:facet>  
            <apex:facet name="stop">
        </apex:facet> 
    </apex:actionStatus> 
    
    <script>
    
         //j$("#createNew").append(j$("#blue-card-vertical"));
         
        /* Add the blue card to the Default Salesforce Sidebar */ 
        j$("#sidebarDiv").append(j$("#blue-card-vertical"));
    
    
         /* If the Salesforce Sidebar is Closed Open it */
         j$(window).load(function() {
            if (document.getElementById('handlebarContainer') && document.getElementById('handlebarContainer').title.indexOf('Close Sidebar') < 0)
                document.getElementById('handlebarContainer').click();
         });
    </script>   
</apex:page>